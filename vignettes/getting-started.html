<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Get Started with PNADCperiods</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Get Started with PNADCperiods</h1>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The <code>PNADCperiods</code> package converts Brazil’s quarterly
PNADC (Pesquisa Nacional por Amostra de Domicilios Continua) survey data
into sub-quarterly time series. It identifies which specific
<strong>month</strong>, <strong>fortnight</strong> (quinzena), or
<strong>week</strong> each survey observation refers to, achieving a
<strong>97% determination rate</strong> for months on stacked
multi-quarter data.</p>
<p><strong>Why does this matter?</strong> PNADC quarterly statistics are
actually moving averages of three months, which obscures:</p>
<ul>
<li>The true timing of economic shocks (when did unemployment
peak?)</li>
<li>The actual magnitude of changes (how high was the peak?)</li>
<li>Turning points in trends (when did recovery begin?)</li>
</ul>
<p>PNADCperiods recovers the specific reference period, enabling true
monthly (or finer) labor market analysis.</p>
<p>For a detailed explanation of the algorithm, see the <a href="how-it-works.html">How PNADCperiods Works</a> vignette.</p>
<hr />
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Install from GitHub</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;antrologos/mensalizePNADC&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Load the package</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">library</span>(PNADCperiods)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code></pre></div>
<p><strong>Dependencies:</strong></p>
<ul>
<li><strong>Required</strong>: <code>data.table</code>,
<code>checkmate</code></li>
<li><strong>For weight calibration</strong>: <code>sidrar</code>
(fetches population data from IBGE’s SIDRA API)</li>
</ul>
<hr />
</div>
<div id="two-step-workflow" class="section level2">
<h2>Two-Step Workflow</h2>
<p>The package uses a <strong>two-function workflow</strong>:</p>
<ol style="list-style-type: decimal">
<li><strong><code>pnadc_identify_periods()</code></strong> - Builds a
universal crosswalk with reference periods</li>
<li><strong><code>pnadc_apply_periods()</code></strong> - Applies
crosswalk to data and optionally calibrates weights</li>
</ol>
<p>This separation allows you to: - Build the crosswalk once from
stacked data - Apply it to any quarterly or annual dataset - Choose your
calibration approach flexibly</p>
<hr />
</div>
<div id="your-first-analysis" class="section level2">
<h2>Your First Analysis</h2>
<div id="required-input-columns" class="section level3">
<h3>Required Input Columns</h3>
<p>The algorithm needs these columns from your PNADC data:</p>
<table>
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Ano</code></td>
<td>Survey year</td>
</tr>
<tr class="even">
<td><code>Trimestre</code></td>
<td>Quarter (1-4)</td>
</tr>
<tr class="odd">
<td><code>UPA</code></td>
<td>Primary Sampling Unit</td>
</tr>
<tr class="even">
<td><code>V1008</code></td>
<td>Household identifier</td>
</tr>
<tr class="odd">
<td><code>V1014</code></td>
<td>Panel identifier (rotation group 1-8)</td>
</tr>
<tr class="even">
<td><code>V2003</code></td>
<td>Person identifier</td>
</tr>
<tr class="odd">
<td><code>V2008</code></td>
<td>Birth day (1-31, or 99 for unknown)</td>
</tr>
<tr class="even">
<td><code>V20081</code></td>
<td>Birth month (1-12, or 99 for unknown)</td>
</tr>
<tr class="odd">
<td><code>V20082</code></td>
<td>Birth year (or 9999 for unknown)</td>
</tr>
<tr class="even">
<td><code>V2009</code></td>
<td>Age</td>
</tr>
</tbody>
</table>
</div>
<div id="step-1-load-your-data" class="section level3">
<h3>Step 1: Load Your Data</h3>
<p>If you don’t have stacked PNADC data yet, see <a href="download-and-prepare.html">Download and Prepare Data</a> for a
complete workflow.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Load your stacked quarterly PNADC data</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>pnadc <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">&quot;pnadc_stacked.csv&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># Check data dimensions</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Rows:&quot;</span>, <span class="fu">nrow</span>(pnadc), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Quarters:&quot;</span>, <span class="fu">uniqueN</span>(pnadc[, .(Ano, Trimestre)]), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<p><strong>Important:</strong> The algorithm works best with
<strong>stacked multi-quarter data</strong>. Processing a single quarter
yields only ~65-75% determination rate, while stacking 2+ years achieves
~97%.</p>
</div>
<div id="step-2-build-the-crosswalk" class="section level3">
<h3>Step 2: Build the Crosswalk</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Identify reference periods (month, fortnight, week)</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>crosswalk <span class="ot">&lt;-</span> <span class="fu">pnadc_identify_periods</span>(pnadc, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Output (from real PNADC 2020-2024 data):</p>
<pre><code>Building reference period crosswalk...
  Preprocessing data (shared computation)...
  Converting date bounds to period positions...
  Aggregating constraints and determining periods...
  Applying exception rules...
  Assigning reference periods...
  Building crosswalk...

Crosswalk complete:
  - 3,159,265 unique household-quarter observations
  - Month determination: 94.2%
  - Fortnight determination: 2.8%
  - Week determination: 0.9%</code></pre>
</div>
<div id="step-3-understand-the-crosswalk" class="section level3">
<h3>Step 3: Understand the Crosswalk</h3>
<p>The crosswalk contains one row per <strong>household-quarter</strong>
combination (keyed by <code>Ano</code>, <code>Trimestre</code>,
<code>UPA</code>, <code>V1008</code>, <code>V1014</code>) with three
granularity levels:</p>
<table>
<colgroup>
<col width="44%" />
<col width="17%" />
<col width="38%" />
</colgroup>
<thead>
<tr class="header">
<th>Output Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Keys</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>Ano</code></td>
<td>Integer</td>
<td>Survey year</td>
</tr>
<tr class="odd">
<td><code>Trimestre</code></td>
<td>Integer</td>
<td>Quarter (1-4)</td>
</tr>
<tr class="even">
<td><code>UPA</code></td>
<td>Integer</td>
<td>Primary sampling unit</td>
</tr>
<tr class="odd">
<td><code>V1008</code></td>
<td>Integer</td>
<td>Household identifier</td>
</tr>
<tr class="even">
<td><code>V1014</code></td>
<td>Integer</td>
<td>Panel group (1-8)</td>
</tr>
<tr class="odd">
<td><strong>Month</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>ref_month</code></td>
<td>Date</td>
<td>Reference month as Date (e.g., “2023-01-01”)</td>
</tr>
<tr class="odd">
<td><code>ref_month_in_quarter</code></td>
<td>Integer</td>
<td>Position in quarter: 1, 2, 3, or NA</td>
</tr>
<tr class="even">
<td><code>ref_month_yyyymm</code></td>
<td>Integer</td>
<td>YYYYMM format (e.g., 202301)</td>
</tr>
<tr class="odd">
<td><code>determined_month</code></td>
<td>Logical</td>
<td>TRUE if month was determined</td>
</tr>
<tr class="even">
<td><strong>Fortnight</strong></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>ref_fortnight</code></td>
<td>Date</td>
<td>Reference fortnight (1st or 16th of month)</td>
</tr>
<tr class="even">
<td><code>ref_fortnight_in_quarter</code></td>
<td>Integer</td>
<td>Position 1-6, or NA</td>
</tr>
<tr class="odd">
<td><code>ref_fortnight_yyyyff</code></td>
<td>Integer</td>
<td>YYYYFF format (1-24 per year)</td>
</tr>
<tr class="even">
<td><code>determined_fortnight</code></td>
<td>Logical</td>
<td>TRUE if fortnight was determined</td>
</tr>
<tr class="odd">
<td><strong>Week</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>ref_week</code></td>
<td>Date</td>
<td>Reference week (Monday of week)</td>
</tr>
<tr class="odd">
<td><code>ref_week_in_quarter</code></td>
<td>Integer</td>
<td>Position 1-14, or NA</td>
</tr>
<tr class="even">
<td><code>ref_week_yyyyww</code></td>
<td>Integer</td>
<td>ISO YYYYWW format</td>
</tr>
<tr class="odd">
<td><code>determined_week</code></td>
<td>Logical</td>
<td>TRUE if week was determined</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># View the crosswalk</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="fu">head</span>(crosswalk)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Check determination rates (stored as attribute)</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="fu">attr</span>(crosswalk, <span class="st">&quot;determination_rates&quot;</span>)</span></code></pre></div>
<p>The determination rates attribute returns a list with rates for each
period type. See the “Understanding Determination Rates” section below
for expected values.</p>
</div>
<div id="step-4-apply-to-your-data" class="section level3">
<h3>Step 4: Apply to Your Data</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Apply crosswalk to a specific quarterly dataset</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co"># For quarterly data, use anchor = &quot;quarter&quot; and weight_var = &quot;V1028&quot;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">pnadc_apply_periods</span>(</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  pnadc_2023q1,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  crosswalk,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="at">weight_var =</span> <span class="st">&quot;V1028&quot;</span>,</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="at">anchor =</span> <span class="st">&quot;quarter&quot;</span>,</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>  <span class="at">calibrate =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>  <span class="at">calibration_unit =</span> <span class="st">&quot;month&quot;</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>)</span></code></pre></div>
<p>The result includes all original columns plus reference periods and
calibrated weights.</p>
<div id="understanding-the-key-arguments" class="section level4">
<h4>Understanding the Key Arguments</h4>
<p><strong><code>weight_var</code></strong> (required): The name of the
original PNADC weight variable to use as the starting point for
calibration.</p>
<table>
<thead>
<tr class="header">
<th>Value</th>
<th>Use When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&quot;V1028&quot;</code></td>
<td>Quarterly PNADC data (trimestral)</td>
</tr>
<tr class="even">
<td><code>&quot;V1032&quot;</code></td>
<td>Annual PNADC data (anual)</td>
</tr>
</tbody>
</table>
<p>These weights come from IBGE’s original calibration and reflect the
survey design. The package uses them as input for the sub-quarterly
calibration process.</p>
<p><strong><code>anchor</code></strong> (required): Specifies whether
the data contains all rotation groups for a quarter or a year.</p>
<table>
<colgroup>
<col width="26%" />
<col width="38%" />
<col width="34%" />
</colgroup>
<thead>
<tr class="header">
<th>Value</th>
<th>Use When</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&quot;quarter&quot;</code></td>
<td>Quarterly PNADC releases</td>
<td>Each quarter contains all 8 rotation groups interviewed during that
quarter</td>
</tr>
<tr class="even">
<td><code>&quot;year&quot;</code></td>
<td>Annual PNADC releases</td>
<td>Each year contains specific visits (e.g., visit 1 or visit 5) from
households across rotation groups</td>
</tr>
</tbody>
</table>
<p>This affects how the calibration targets are computed: quarterly data
calibrates within each quarter, while annual data calibrates within each
year.</p>
<p><strong><code>calibration_unit</code></strong>: The time period
granularity for weight calibration.</p>
<table>
<colgroup>
<col width="21%" />
<col width="46%" />
<col width="31%" />
</colgroup>
<thead>
<tr class="header">
<th>Value</th>
<th>Calibrates to</th>
<th>Best for</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&quot;month&quot;</code> (default)</td>
<td>Monthly population totals</td>
<td>Most analyses; highest determination rate (~97%)</td>
</tr>
<tr class="even">
<td><code>&quot;fortnight&quot;</code></td>
<td>Fortnightly totals</td>
<td>When you need bi-weekly precision (low determination ~2-5%)</td>
</tr>
<tr class="odd">
<td><code>&quot;week&quot;</code></td>
<td>Weekly totals</td>
<td>Fine-grained analysis (very low determination ~1-2%)</td>
</tr>
</tbody>
</table>
<p><strong>What is calibration?</strong> Weight calibration adjusts the
survey weights so that weighted totals match known population benchmarks
(from IBGE’s SIDRA API). This ensures your monthly estimates sum to the
correct population totals. Without calibration, sub-quarterly estimates
may not properly aggregate to known quarterly totals.</p>
<hr />
</div>
</div>
</div>
<div id="understanding-the-workflow" class="section level2">
<h2>Understanding the Workflow</h2>
<div id="building-vs.-applying" class="section level3">
<h3>Building vs. Applying</h3>
<p><strong>Build the crosswalk once</strong> from stacked data (2+ years
recommended):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Stack multiple years of quarterly data</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>pnadc_stacked <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(pnadc_2020, pnadc_2021, pnadc_2022, pnadc_2023))</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co"># Build crosswalk (only needs the identification columns)</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>crosswalk <span class="ot">&lt;-</span> <span class="fu">pnadc_identify_periods</span>(pnadc_stacked)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co"># Save for reuse</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="fu">saveRDS</span>(crosswalk, <span class="st">&quot;crosswalk_2020_2023.rds&quot;</span>)</span></code></pre></div>
<p><strong>Apply to any dataset</strong> as needed:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Load saved crosswalk</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>crosswalk <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;crosswalk_2020_2023.rds&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># Apply to quarterly data</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>monthly_q1 <span class="ot">&lt;-</span> <span class="fu">pnadc_apply_periods</span>(pnadc_2023q1, crosswalk,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>                                   <span class="at">weight_var =</span> <span class="st">&quot;V1028&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>                                   <span class="at">anchor =</span> <span class="st">&quot;quarter&quot;</span>)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co"># Apply to annual data (with V1032 weights)</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>monthly_annual <span class="ot">&lt;-</span> <span class="fu">pnadc_apply_periods</span>(pnadc_annual_2023, crosswalk,</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>                                       <span class="at">weight_var =</span> <span class="st">&quot;V1032&quot;</span>,</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>                                       <span class="at">anchor =</span> <span class="st">&quot;year&quot;</span>)</span></code></pre></div>
</div>
<div id="calibration-options" class="section level3">
<h3>Calibration Options</h3>
<p>The <code>calibration_unit</code> parameter controls the granularity
of weight calibration:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Monthly calibration (default)</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>result_month <span class="ot">&lt;-</span> <span class="fu">pnadc_apply_periods</span>(pnadc, crosswalk,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>                                     <span class="at">weight_var =</span> <span class="st">&quot;V1028&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>                                     <span class="at">anchor =</span> <span class="st">&quot;quarter&quot;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>                                     <span class="at">calibration_unit =</span> <span class="st">&quot;month&quot;</span>)</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co"># -&gt; Adds weight_monthly column</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co"># Fortnight calibration</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>result_fortnight <span class="ot">&lt;-</span> <span class="fu">pnadc_apply_periods</span>(pnadc, crosswalk,</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>                                         <span class="at">weight_var =</span> <span class="st">&quot;V1028&quot;</span>,</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>                                         <span class="at">anchor =</span> <span class="st">&quot;quarter&quot;</span>,</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>                                         <span class="at">calibration_unit =</span> <span class="st">&quot;fortnight&quot;</span>)</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co"># -&gt; Adds weight_fortnight column</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co"># Weekly calibration</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>result_week <span class="ot">&lt;-</span> <span class="fu">pnadc_apply_periods</span>(pnadc, crosswalk,</span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>                                    <span class="at">weight_var =</span> <span class="st">&quot;V1028&quot;</span>,</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>                                    <span class="at">anchor =</span> <span class="st">&quot;quarter&quot;</span>,</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>                                    <span class="at">calibration_unit =</span> <span class="st">&quot;week&quot;</span>)</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co"># -&gt; Adds weight_weekly column</span></span></code></pre></div>
</div>
<div id="no-calibration-option" class="section level3">
<h3>No Calibration Option</h3>
<p>If you only need reference periods without calibrated weights:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">pnadc_apply_periods</span>(pnadc, crosswalk,</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>                               <span class="at">weight_var =</span> <span class="st">&quot;V1028&quot;</span>,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>                               <span class="at">anchor =</span> <span class="st">&quot;quarter&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>                               <span class="at">calibrate =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co"># Result has ref_month, ref_fortnight, ref_week but no weight_monthly</span></span></code></pre></div>
<hr />
</div>
</div>
<div id="using-for-monthly-analysis" class="section level2">
<h2>Using for Monthly Analysis</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Compute monthly unemployment rate</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>monthly_unemployment <span class="ot">&lt;-</span> result[determined_month <span class="sc">==</span> <span class="cn">TRUE</span>, .(</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">unemployment_rate =</span> <span class="fu">sum</span>((VD4002 <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">*</span> weight_monthly, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>                      <span class="fu">sum</span>((VD4001 <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">*</span> weight_monthly, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>), by <span class="ot">=</span> ref_month_yyyymm]</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co"># Compute monthly population</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>monthly_pop <span class="ot">&lt;-</span> result[, .(</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  <span class="at">population =</span> <span class="fu">sum</span>(weight_monthly, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>), by <span class="ot">=</span> ref_month_yyyymm]</span></code></pre></div>
<p><strong>Note:</strong> Use <code>determined_month == TRUE</code> to
filter to observations with determined months.</p>
<hr />
</div>
<div id="understanding-determination-rates" class="section level2">
<h2>Understanding Determination Rates</h2>
<div id="why-stack-multiple-quarters" class="section level3">
<h3>Why Stack Multiple Quarters?</h3>
<p>PNADC uses a <strong>rotating panel</strong> where each household
(identified by UPA + V1014) is interviewed in 5 consecutive quarters.
The same household is always interviewed in the <strong>same relative
month position</strong> within each quarter.</p>
<p>This means birthday constraints from <strong>any</strong> quarter can
determine the month for <strong>all</strong> quarters:</p>
<pre><code>UPA=123456, V1014=1 appears in 5 quarters:

  2023-Q1: could be Jan or Feb (ambiguous)
  2023-Q2: could be Apr, May, or Jun (ambiguous)
  2023-Q3: must be August (birthday constraint pins it down!)
  2023-Q4: could be Oct or Nov (ambiguous)
  2024-Q1: could be Feb or Mar (ambiguous)

Cross-quarter aggregation:
  Since 2023-Q3 must be month 2, ALL quarters must be month 2.
  Result: ALL 5 quarters are determined!</code></pre>
<table>
<thead>
<tr class="header">
<th>Processing Mode</th>
<th>Month Rate</th>
<th>Fortnight Rate</th>
<th>Week Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Single quarter</td>
<td>65-75%</td>
<td>~2-5%</td>
<td>~1-2%</td>
</tr>
<tr class="even">
<td>Stacked (2+ years)</td>
<td><strong>~97%</strong></td>
<td>~2-5%</td>
<td>~1-2%</td>
</tr>
</tbody>
</table>
<p><strong>Important:</strong> Fortnight and week determination rates
remain low (~2-5% and ~1-2%) regardless of stacking because their
constraints cannot aggregate across quarters—each quarter’s interview
timing is independent at the sub-monthly level. Only month determination
benefits from cross-quarter aggregation through the rotating panel
design.</p>
</div>
<div id="what-makes-observations-indeterminate" class="section level3">
<h3>What Makes Observations Indeterminate?</h3>
<p>About 3% of observations remain indeterminate for months because:</p>
<ul>
<li><strong>Incomplete panel coverage</strong>: First/last quarters in
your data have fewer panel visits</li>
<li><strong>Missing birth dates</strong>: Some respondents don’t report
birth date (V2008=99, etc.)</li>
<li><strong>Small households</strong>: Fewer people means fewer birthday
constraints</li>
<li><strong>Unit non-response</strong>: Some households don’t respond in
all quarters</li>
</ul>
<p>For the full algorithm explanation, see <a href="how-it-works.html">How PNADCperiods Works</a>.</p>
<hr />
</div>
</div>
<div id="next-steps" class="section level2">
<h2>Next Steps</h2>
<ul>
<li><p><strong>Download PNADC data</strong>: See <a href="download-and-prepare.html">Download and Prepare Data</a> for a
complete workflow to download and stack quarterly microdata from
IBGE.</p></li>
<li><p><strong>Analysis examples</strong>: See <a href="applied-examples.html">Applied Examples</a> for real-world labor
market analysis comparing monthly vs quarterly data, including COVID
unemployment and minimum wage validation.</p></li>
<li><p><strong>Annual PNADC data</strong>: Working with annual income
data? See <a href="annual-poverty-analysis.html">Monthly Poverty
Analysis with Annual PNADC Data</a> for the workflow using annual
data.</p></li>
<li><p><strong>Function reference</strong>: Browse the <a href="../reference/index.html">Reference</a> for documentation of all
exported functions.</p></li>
</ul>
<hr />
</div>
<div id="quick-reference" class="section level2">
<h2>Quick Reference</h2>
<div id="main-functions" class="section level3">
<h3>Main Functions</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Step 1: Build crosswalk from stacked data</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">pnadc_identify_periods</span>(</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  data,              <span class="co"># Stacked PNADC data</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>     <span class="co"># Show progress?</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co"># Step 2: Apply crosswalk and optionally calibrate weights</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="fu">pnadc_apply_periods</span>(</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>  data,              <span class="co"># PNADC data to augment</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>  crosswalk,         <span class="co"># Crosswalk from pnadc_identify_periods()</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  weight_var,        <span class="co"># REQUIRED: &quot;V1028&quot; (quarterly) or &quot;V1032&quot; (annual)</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  anchor,            <span class="co"># REQUIRED: &quot;quarter&quot; or &quot;year&quot;</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>  <span class="at">calibrate =</span> <span class="cn">TRUE</span>,  <span class="co"># Calibrate weights to SIDRA population?</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>  <span class="at">calibration_unit =</span> <span class="st">&quot;month&quot;</span>,  <span class="co"># &quot;month&quot;, &quot;fortnight&quot;, or &quot;week&quot;</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>  <span class="at">target_totals =</span> <span class="cn">NULL</span>,        <span class="co"># Custom targets (NULL = auto-fetch)</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>  <span class="at">smooth =</span> <span class="cn">TRUE</span>,     <span class="co"># Apply smoothing to weights?</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>  <span class="at">keep_all =</span> <span class="cn">TRUE</span>,   <span class="co"># Return all rows (including undetermined)?</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>     <span class="co"># Show progress?</span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="performance" class="section level3">
<h3>Performance</h3>
<table>
<thead>
<tr class="header">
<th>Metric</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Month determination rate</td>
<td><strong>~97%</strong> (on stacked data)</td>
</tr>
<tr class="even">
<td>Fortnight determination rate</td>
<td>~2-5%</td>
</tr>
<tr class="odd">
<td>Week determination rate</td>
<td>~1-2%</td>
</tr>
<tr class="even">
<td>Processing time (identification)</td>
<td>~1 minute for 28M rows</td>
</tr>
<tr class="odd">
<td>Processing time (with calibration)</td>
<td>~5 minutes for 28M rows</td>
</tr>
</tbody>
</table>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
