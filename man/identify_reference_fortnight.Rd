% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/identify-reference-fortnight.R
\name{identify_reference_fortnight}
\alias{identify_reference_fortnight}
\title{Identify Reference Fortnight in PNADC Data}
\usage{
identify_reference_fortnight(data, verbose = TRUE, .pb = NULL, .pb_offset = 0L)
}
\arguments{
\item{data}{A data.frame or data.table with PNADC microdata. Required columns:
\itemize{
\item \code{Ano}: Survey year
\item \code{Trimestre}: Quarter (1-4)
\item \code{UPA}: Primary Sampling Unit
\item \code{V1008}: Household sequence within UPA
\item \code{V1014}: Panel identifier
\item \code{V2008}: Birth day (1-31)
\item \code{V20081}: Birth month (1-12)
\item \code{V20082}: Birth year
\item \code{V2009}: Age
}}

\item{verbose}{Logical. If TRUE (default), display progress information.}

\item{.pb}{Optional progress bar object.}

\item{.pb_offset}{Integer. Offset for progress bar updates.}
}
\value{
A data.table with the original key columns plus:
\itemize{
\item \code{ref_fortnight}: Reference fortnight as Date (1st or 16th of month)
\item \code{ref_fortnight_in_quarter}: Position in quarter (1-6) or NA
\item \code{ref_fortnight_yyyyff}: Integer YYYYFF format (1-24 per year)
}
}
\description{
PNADC is a quarterly survey where each interview occurs during a specific
fortnight within the quarter. This function identifies which fortnight (1-6
per quarter, 1-24 per year) that observation belongs to, enabling bi-weekly
time series analysis.

The algorithm uses:
\itemize{
\item IBGE's reference week timing rules (first Saturday with sufficient days in month)
\item Respondent birthdates to constrain possible interview dates
\item UPA-panel level aggregation (everyone in same sampling unit interviewed together)
\item Dynamic exception detection (identifies quarters needing relaxed rules)
}
}
\details{
Determines which fortnight (quinzena - 15-day period) within each quarter
corresponds to each survey observation based on IBGE's interview timing rules.
\subsection{Fortnight Definition}{

Each year has 24 fortnights (2 per month):
\itemize{
\item Fortnight 01: Jan 1-15
\item Fortnight 02: Jan 16-31
\item Fortnight 03: Feb 1-15
\item Fortnight 04: Feb 16-28/29
\item ... and so on through fortnight 24 (Dec 16-31)
}

Each quarter has 6 fortnights (e.g., Q1 = fortnights 01-06).
}

\subsection{Expected Determination Rate}{

Fortnight determination rate is typically low (~2-5\%) because:
\itemize{
\item Unlike months, fortnights cannot aggregate across quarters
\item Birthday constraints typically narrow the date range by only a few weeks
\item A 15-day fortnight window is difficult to pinpoint without cross-quarter data
}

The algorithm determines fortnight when the interview date range falls
entirely within a single 15-day period.

\strong{Note}: The month algorithm achieves ~97\% determination by aggregating
at UPA-V1014 level across ALL quarters (leveraging the panel design where
the same units are interviewed in consistent relative positions). Fortnights
and weeks cannot use this cross-quarter aggregation because their positions
are not consistent across panel visits.
}
}
\examples{
\dontrun{
# Identify reference fortnights
result <- identify_reference_fortnight(pnadc_data)

# Check determination rate by quarter
result[, .(
  total = .N,
  determined = sum(!is.na(ref_fortnight_in_quarter)),
  rate = mean(!is.na(ref_fortnight_in_quarter))
), by = .(Ano, Trimestre)]

# Note: Fortnight determination rate is typically low (~2-5\%)
# because fortnights cannot aggregate across quarters like months can.
}

}
\seealso{
\code{\link{pnadc_identify_periods}} for the main function that
builds a complete crosswalk including months, fortnights, and weeks.
\code{\link{identify_reference_month}} for month-only identification.
\code{\link{identify_reference_week}} for week-only identification.
}
