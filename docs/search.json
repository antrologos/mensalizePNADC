[{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":null,"dir":"","previous_headings":"","what":"PNADCperiods - Architecture Documentation","title":"PNADCperiods - Architecture Documentation","text":"document describes implemented architecture PNADCperiods package (v2.0.0).","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":"package-overview","dir":"","previous_headings":"","what":"Package Overview","title":"PNADCperiods - Architecture Documentation","text":"Package name: PNADCperiods Purpose: Identify reference periods (months, fortnights, weeks) Brazil’s PNADC survey data optionally calibrate weights sub-quarterly analysis.","code":""},{"path":[]},{"path":[]},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":"crosswalk-structure","dir":"","previous_headings":"","what":"Crosswalk Structure","title":"PNADCperiods - Architecture Documentation","text":"crosswalk data.table household-quarter level: Join keys: Ano, Trimestre, UPA, V1008, V1014","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":"determination-rates","dir":"","previous_headings":"","what":"Determination Rates","title":"PNADCperiods - Architecture Documentation","text":"Key insight: month identification benefits stacking data across quarters. Fortnights weeks determined solely birthday constraints within single quarter.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":"file-structure","dir":"","previous_headings":"","what":"File Structure","title":"PNADCperiods - Architecture Documentation","text":"","code":"R/ ├── pnadc-identify-periods.R      # Main: pnadc_identify_periods() ├── pnadc-apply-periods.R         # Main: pnadc_apply_periods() ├── identify-reference-month.R    # Core month algorithm ├── identify-reference-fortnight.R # Core fortnight algorithm ├── identify-reference-week.R     # Core week algorithm ├── calibrate-weights.R           # Legacy calibration ├── fetch-sidra-population.R      # SIDRA API for population ├── smooth-aggregates.R           # Smoothing algorithm ├── utils-dates.R                 # Fast date utilities ├── utils-validation.R            # Input validation └── PNADCperiods-package.R        # Package docs + globalVariables"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":"month-identification-high-rate","dir":"","previous_headings":"Algorithm Summary","what":"Month Identification (High Rate)","title":"PNADCperiods - Architecture Documentation","text":"Calculate valid interview Saturdays using IBGE timing rules Apply birthday constraints narrow date range per person Convert dates month positions (1, 2, 3 quarter) Aggregate UPA-V1014 level ACROSS QUARTERS (key optimization) Dynamic exception detection edge cases Determine: min_position == max_position → determined","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":"fortnightweek-identification-low-rate","dir":"","previous_headings":"Algorithm Summary","what":"Fortnight/Week Identification (Low Rate)","title":"PNADCperiods - Architecture Documentation","text":"steps 1-3 month Aggregate household level WITHIN QUARTER cross-quarter aggregation (positions consistent across visits) Determine: min_position == max_position → determined","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":"calibration-pipeline","dir":"","previous_headings":"","what":"Calibration Pipeline","title":"PNADCperiods - Architecture Documentation","text":"pnadc_apply_periods(..., calibrate = TRUE): Join data crosswalk Fetch population targets SIDRA (use provided targets) Create hierarchical calibration cells (4 levels) Iterative reweighting within anchor period (quarter year) Calibrate external population totals Smooth weights (optional) Anchor types: - anchor = \"quarter\": Preserve quarterly totals, redistribute sub-periods - anchor = \"year\": Preserve annual totals (annual PNADC data)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":"dependencies","dir":"","previous_headings":"","what":"Dependencies","title":"PNADCperiods - Architecture Documentation","text":"Required: - data.table (>= 1.14.0) - Core data manipulation - checkmate (>= 2.0.0) - Input validation Suggested: - sidrar - SIDRA API access population data - testthat - Testing - knitr, rmarkdown - Vignettes - pkgdown - Website","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":"standard-monthly-analysis","dir":"","previous_headings":"Workflow Examples","what":"Standard Monthly Analysis","title":"PNADCperiods - Architecture Documentation","text":"","code":"crosswalk <- pnadc_identify_periods(pnadc_stacked) result <- pnadc_apply_periods(pnadc_2023, crosswalk,                               weight_var = \"V1028\",                               anchor = \"quarter\")"},{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":"annual-data","dir":"","previous_headings":"Workflow Examples","what":"Annual Data","title":"PNADCperiods - Architecture Documentation","text":"","code":"result <- pnadc_apply_periods(pnadc_annual, crosswalk,                               weight_var = \"V1032\",                               anchor = \"year\")"},{"path":"https://antrologos.github.io/mensalizePNADC/ARCHITECTURE_PLAN.html","id":"crosswalk-only-no-calibration","dir":"","previous_headings":"Workflow Examples","what":"Crosswalk Only (No Calibration)","title":"PNADCperiods - Architecture Documentation","text":"","code":"result <- pnadc_apply_periods(pnadc_2023, crosswalk,                               calibrate = FALSE)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"prerequisites","dir":"Articles","previous_headings":"","what":"Prerequisites","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"vignette requires following packages: also need: Quarterly PNADC data (2015-2024) .fst format creating mensalization crosswalk Annual PNADC data (2015-2024) .fst format income supplement variables Deflator file IBGE documentation (deflator_pnadc_2024.xls)","code":"# Core packages library(PNADCperiods) library(data.table) library(fst)  # For deflation library(readxl)      # Read deflator Excel files library(deflateBR)   # INPC deflator  # For survey analysis library(survey)  # For visualization library(ggplot2) library(scales) library(patchwork)   # Combine plots library(Hmisc)       # wtd.mean"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"exactly poverty spike COVID-19? Official annual statistics tell us 2020 difficult year—can’t tell us whether crisis peaked April, May, June. can’t reveal whether Auxílio Emergencial (emergency cash transfers) reduced poverty immediately upon implementation delay. can’t show us month--month path recovery. Monthly data can. vignette demonstrates powerful technique: combining mensalization algorithm annual PNADC data produce monthly poverty statistics. annual PNADC releases contain comprehensive household income measures aren’t available quarterly releases. merging mensalization crosswalk (quarterly data) annual income data, get best worlds: monthly temporal precision comprehensive income measurement.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"why-this-works","dir":"Articles","previous_headings":"Introduction","what":"Why This Works","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"IBGE’s PNADC uses rotating panel design. households interviewed quarterly annual data collection. means can: Identify reference month observation belongs (using quarterly data) Merge information annual income data (using household/person identifiers) Analyze detailed income poverty measures monthly frequency","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"what-youll-learn","dir":"Articles","previous_headings":"Introduction","what":"What You’ll Learn","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"create mensalization crosswalk quarterly data merge crosswalk annual PNADC income data construct per capita household income poverty measures analyze monthly poverty dynamics 2015-2024 period","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"quick-start","dir":"Articles","previous_headings":"","what":"Quick Start","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"want see end result diving methodology, ’s monthly poverty analysis reveals: rest vignette explains produce estimates raw PNADC data.","code":"# Load pre-computed monthly poverty estimates monthly_poverty <- fst::read_fst(\"monthly_poverty_aggregates.fst\",                                   as.data.table = TRUE)  # Monthly poverty rate for March 2020 (COVID onset) monthly_poverty[ref_month_yyyymm == 202003, poverty_rate] #> [1] 0.25  # ~25% below USD 8.30/day poverty line  # Compare to December 2020 (after Auxílio Emergencial) monthly_poverty[ref_month_yyyymm == 202012, poverty_rate] #> [1] 0.19  # Reduced due to emergency transfers"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"the-crosswalk-concept","dir":"Articles","previous_headings":"Data Strategy","what":"The Crosswalk Concept","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"mensalization algorithm determines specific month interview refers analyzing birthday constraints IBGE’s interview scheduling rules. However, algorithm requires quarterly data format—specifically, variables like V2008 (birth day), V20081 (birth month), V20082 (birth year) aren’t always available annual releases. solution crosswalk: run mensalization quarterly data get reference months, merge results annual data using household person identifiers.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"join-keys","dir":"Articles","previous_headings":"Data Strategy","what":"Join Keys","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"quarterly annual PNADC releases share sampling units can linked using six key variables:","code":"# Join keys between quarterly and annual PNADC # Note: Variable names are converted to lowercase during processing join_keys <- c(\"ano\", \"trimestre\", \"upa\", \"v1008\", \"v1014\", \"v2003\")  # ano:       Survey year # trimestre: Quarter (1-4) # upa:       Primary Sampling Unit (census tract) # v1008:     Household selection number within UPA # v1014:     Panel group (1-8, identifies rotation cohort) # v2003:     Person order within household"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"match-rate-and-missing-observations","dir":"Articles","previous_headings":"Data Strategy","what":"Match Rate and Missing Observations","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"merging crosswalk annual data, expect approximately 97% observations determined reference month. remaining ~3% occur : observations fall edge cases mensalization algorithm determine unique month Minor inconsistencies quarterly annual data collection poverty analysis, recommend dropping observations without determined reference months. cleanest approach introduces minimal bias since undetermined cases essentially random across income distribution.","code":""},{"path":[]},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"from-annual-data-for-poverty-analysis","dir":"Articles","previous_headings":"Required Variables","what":"From Annual Data (for poverty analysis)","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"VD5008? IBGE pre-calculates variable include income sources (labor, transfers, pensions, ) divides household size. Using VD5008 directly ensures consistency official IBGE statistics simplifies workflow.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"step-1-create-mensalization-crosswalk","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 1: Create Mensalization Crosswalk","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"First, load stacked quarterly PNADC data run mensalization algorithm:","code":"library(PNADCperiods) library(data.table) library(fst)  # Define paths pnad_quarterly_dir <- \"path/to/quarterly/data\"  # List quarterly files (2015-2024) quarterly_files <- list.files(   path = pnad_quarterly_dir,   pattern = \"PNADC_.*\\\\.fst$\",   full.names = TRUE )  # Variables needed for mensalization quarterly_vars <- c(   \"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\", \"V2003\",   \"V2008\", \"V20081\", \"V20082\", \"V2009\",   \"V1028\", \"UF\", \"posest\", \"posest_sxi\", \"Estrato\" )  # Load and stack quarterly data quarterly_data <- rbindlist(   lapply(quarterly_files, function(f) {     read_fst(f, as.data.table = TRUE, columns = quarterly_vars)   }),   fill = TRUE )  # Build the crosswalk (identifies reference periods) crosswalk <- pnadc_identify_periods(   quarterly_data,   verbose = TRUE )  # Check determination rate mean(!is.na(crosswalk$ref_month_in_quarter)) #> [1] 0.97  # ~97% of observations have determined reference months"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"step-2-load-annual-pnadc-data","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 2: Load Annual PNADC Data","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Annual PNADC files follow specific naming convention. Note 2020-2021 use visit 5 (due COVID-related field disruptions), years use visit 1: Visit 5 2020-2021? COVID-19, IBGE suspended -person data collection. Visit 1 interviews 2020-2021 significant quality issues unavailable entirely. Visit 5 interviews conducted later improved conditions standard choice COVID-era income poverty analysis. follows IBGE’s recommendations annual income analysis period.","code":"pnad_annual_dir <- \"path/to/annual/data\"  # Define which visit to use for each year visit_selection <- data.table(   ano = 2015:2024,   visita = c(1, 1, 1, 1, 1, 5, 5, 1, 1, 1)  # 2020-2021 use visit 5 ) # Build file paths annual_files <- visit_selection[, .(   file = file.path(pnad_annual_dir, sprintf(\"pnadc_%d_visita%d.fst\", ano, visita)) ), by = ano]  # Variables to load annual_vars <- c(   # Join keys   \"ano\", \"trimestre\", \"upa\", \"v1008\", \"v1014\", \"v2003\",   # Demographics   \"v2005\", \"v2007\", \"v2009\", \"v2010\", \"uf\", \"estrato\",   # Weights and calibration   \"v1032\", \"posest\", \"posest_sxi\",   # Household per capita income (IBGE pre-calculated)   \"vd5008\" )  # Load and stack annual data annual_data <- rbindlist(   lapply(annual_files[file.exists(file), file], function(f) {     dt <- read_fst(f, as.data.table = TRUE)     setnames(dt, tolower(names(dt)))     cols_present <- intersect(annual_vars, names(dt))     dt[, ..cols_present]   }),   fill = TRUE )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"step-3-merge-crosswalk-with-annual-data-and-calibrate-weights","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 3: Merge Crosswalk with Annual Data and Calibrate Weights","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Now merge mensalization results annual income data calibrate weights: use pnadc_apply_periods(..., anchor = \"year\") instead manual merge? quarterly crosswalk produces weight_monthly calibrating quarterly weight V1028, assumes 5 rotation groups present quarter (~20% observations panel visit). Annual data contains one visit per household (e.g., visit 1 visit 5), using V1028-based weights severely misrepresent population—observation weighted represents 1/5 demographic cell. pnadc_apply_periods() anchor = \"year\" properly calibrates annual weight V1032 monthly SIDRA population totals using hierarchical rake weighting. ensures : Weights sum correct monthly population totals Demographic cells balanced within year Results comparable official IBGE statistics technical details annual weight calibration differs quarterly, see Works vignette.","code":"# Apply crosswalk to annual data and calibrate V1032 weights d <- pnadc_apply_periods(   annual_data,   crosswalk,   weight_var = \"V1032\",   anchor = \"year\",   calibrate = TRUE,   verbose = TRUE ) #> Applying crosswalk... #> Match rate: 97.0% #> Calibrating weights... #>   Fetching monthly population from SIDRA... #>   Calibrated 28,456,123 observations  # Check match rate mean(!is.na(d$ref_month_in_quarter)) #> [1] 0.97"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"step-4-construct-per-capita-income","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 4: Construct Per Capita Income","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Use IBGE’s pre-calculated household per capita income variable:","code":"# Filter to household members only d <- d[v2005 <= 14 | v2005 == 16]  # Create household ID d[, id_dom := paste(upa, v1008, v1014, sep = \"_\")]  # Use IBGE's pre-calculated per capita household income # VD5008 already accounts for all income sources and household size d[, hhinc_pc_nominal := fifelse(is.na(vd5008), 0, vd5008)]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"step-5-apply-deflation","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 5: Apply Deflation","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Convert nominal income real values using IBGE deflators:","code":"# Load deflator data (from IBGE documentation) deflator <- readxl::read_excel(\"path/to/deflator_pnadc_2024.xls\") setDT(deflator) deflator <- deflator[, .(ano, trimestre = trim, uf, CO2, CO2e, CO3)]  # Merge deflators with data setkeyv(deflator, c(\"ano\", \"trimestre\", \"uf\")) setkeyv(d, c(\"ano\", \"trimestre\", \"uf\")) d <- deflator[d]  # INPC adjustment factor to reference date (December 2025) inpc_factor <- deflateBR::inpc(1,                                nominal_dates = as.Date(\"2024-07-01\"),                                real_date = \"12/2025\")  # Apply deflation d[, hhinc_pc := hhinc_pc_nominal * CO2 * inpc_factor]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"step-6-define-poverty-line","dir":"Articles","previous_headings":"Complete Workflow","what":"Step 6: Define Poverty Line","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Calculate World Bank PPP-based poverty threshold: USD 8.30/day? World Bank’s upper-middle income poverty threshold, appropriate Brazil. use 2021 PPP conversion factor (2.45 BRL per USD) recent available.","code":"# World Bank poverty line: USD 8.30 PPP per day (upper-middle income threshold) poverty_line_830_ppp_daily <- 8.30  # 2021 PPP conversion factor (World Bank) # https://data.worldbank.org/indicator/PA.NUS.PRVT.PP?year=2021 usd_to_brl_ppp <- 2.45 days_to_month <- 365/12  # Monthly value in 2021 BRL poverty_line_830_brl_monthly_2021 <- poverty_line_830_ppp_daily *                                      usd_to_brl_ppp * days_to_month  # Deflate to December 2025 reference poverty_line_830_brl_monthly_2025 <- deflateBR::inpc(   poverty_line_830_brl_monthly_2021,   nominal_dates = as.Date(\"2021-07-01\"),   real_date = \"12/2025\" )  d[, poverty_line := poverty_line_830_brl_monthly_2025]"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"helper-functions","dir":"Articles","previous_headings":"Analysis Examples","what":"Helper Functions","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"computing poverty measures, define FGT family poverty indices:","code":"# FGT poverty measure family (Foster-Greer-Thorbecke) # alpha = 0: Headcount ratio (share below line) # alpha = 1: Poverty gap (average shortfall) # alpha = 2: Squared poverty gap (sensitive to inequality among poor) fgt <- function(x, z, w = NULL, alpha = 0) {   if (is.null(w)) w <- rep(1, length(x))   if (length(z) == 1) z <- rep(z, length(x))    idx <- complete.cases(x, z, w)   x <- x[idx]; z <- z[idx]; w <- w[idx]    g <- pmax(0, (z - x) / z)   fgt_val <- ifelse(x < z, g^alpha, 0)    sum(w * fgt_val) / sum(w) }"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"example-1-monthly-fgt-poverty-measures","dir":"Articles","previous_headings":"Analysis Examples","what":"Example 1: Monthly FGT Poverty Measures","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Calculate monthly poverty rates using FGT family: figure reveals several key dynamics: Pre-COVID baseline: Poverty rates gradually declining 2015-2019, recovering 2015-2016 recession. COVID-19 spike (March-April 2020): poverty rate shows sharp increase early 2020. Auxílio Emergencial effect (May-December 2020): Emergency cash transfers dramatically reduced poverty pre-pandemic levels. Post-Auxílio adjustment (2021): emergency aid reduced, poverty rates partially rebounded.","code":"# Filter to determined observations d_monthly <- d[!is.na(ref_month_yyyymm)]  # Use calibrated monthly weight (from mensalize_annual_pnadc()) d_monthly[, peso := weight_monthly]  # Compute monthly poverty statistics monthly_poverty <- d_monthly[, .(   # FGT-0 (Headcount ratio)   poverty_rate = fgt(hhinc_pc, poverty_line, peso, alpha = 0),    # FGT-1 (Poverty gap)   poverty_gap = fgt(hhinc_pc, poverty_line, peso, alpha = 1),    # Mean income   mean_income = wtd.mean(hhinc_pc, peso),    # Sample size   n_obs = .N  ), by = ref_month_yyyymm]  # Add date for plotting monthly_poverty[, period := as.Date(paste0(   ref_month_yyyymm %/% 100, \"-\",   ref_month_yyyymm %% 100, \"-15\" ))]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"example-2-survey-design-brief","dir":"Articles","previous_headings":"Analysis Examples","what":"Example 2: Survey Design (Brief)","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"proper inference, use complex survey design monthly weights: detailed guidance variance estimation monthly weights, including replication weights approach, see Complex Survey Design vignette.","code":"library(survey)  # Create survey design for one month (e.g., March 2020) march_2020 <- d_monthly[ref_month_yyyymm == 202003]  design <- svydesign(   ids = ~upa,   strata = ~estrato,   weights = ~peso,   data = march_2020,   nest = TRUE )  # Poverty rate with confidence interval poverty_estimate <- svymean(   ~I(hhinc_pc < poverty_line),   design,   na.rm = TRUE )  confint(poverty_estimate)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"example-3-post-hoc-smoothing-of-aggregates","dir":"Articles","previous_headings":"Analysis Examples","what":"Example 3: Post-hoc Smoothing of Aggregates","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"raw monthly series may show quarterly artifacts IBGE’s rotating panel design. artifacts persist weight calibration (applies smoothing default), can apply additional post-hoc smoothing aggregated estimates: Caution: Smoothing removes noise may also mask real month--month dynamics. Use smoothing trend visualization, report raw estimates specific months interest.","code":"# Three-month centered rolling average (using data.table::frollmean) monthly_poverty[, poverty_rate_smoothed :=                   frollmean(poverty_rate, 3, align = \"center\")]"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"when-to-use-this-approach","dir":"Articles","previous_headings":"Summary","what":"When to Use This Approach","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Event studies: Analyzing policy changes economic shocks precise timing Policy evaluation: Measuring immediate effects interventions (e.g., cash transfers) Seasonal analysis: Identifying within-year patterns poverty Nowcasting: Producing timely poverty estimates","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"limitations","dir":"Articles","previous_headings":"Summary","what":"Limitations","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Sample loss: ~3% observations undetermined reference months Data lag: Annual PNADC released 18+ month delay Variable changes: Pre-2015 annual data uses different variable names Confidence intervals: Monthly estimates wider uncertainty annual","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"further-reading","dir":"Articles","previous_headings":"","what":"Further Reading","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"Get Started - Basic mensalization workflow Works - Algorithm details Complex Survey Design - Variance estimation Applied Examples - Unemployment minimum wage examples","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/annual-poverty-analysis.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Monthly Poverty Analysis with Annual PNADC Data","text":"IBGE. Pesquisa Nacional por Amostra de Domicílios Contínua (PNADC). https://www.ibge.gov.br/estatisticas/sociais/trabalho/ World Bank. Poverty Shared Prosperity Reports. Various years. Foster, J., Greer, J., & Thorbecke, E. (1984). class decomposable poverty measures. Econometrica, 52(3), 761-766.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Brazil’s Continuous National Household Sample Survey (PNADC) one important sources labor market data Latin America. Regularly, IBGE (Brazil’s statistics agency) publishes quarterly annual microdata used calculation official labor market statistics: unemployment rates, employment levels, key indicators. However, many users don’t realize quarterly (annual) statistics actually average three-month phenomena. official IBGE website indicators extration (SIDRA) indeed monthly information. However, monthly series snapshot particular month, instead rolling average interviews conducted three months. averaging three important consequences: Timing errors: quarterly peak unemployment may coincide actual monthly peak. crisis peaked April might show “Q2” phenomenon, obscuring shock actually hit. Magnitude errors: true size peak trough variable diluted averaging adjacent months. unemployment spiked 16% one month 12% surrounding months, quarterly average show something like 13-14%—understating severity shock. Turning point detection: precise month trend reversed direction becomes blurred. economy start recovering May June? Quarterly data can’t tell . PNADCperiods package solves problem identifying specific month interview refers , using birthday information IBGE’s interview scheduling rules. stacked data spanning multiple quarters, algorithm achieves 97% determination rate—meaning can assign specific reference months nearly observations. vignette demonstrates three compelling cases monthly data reveals dynamics quarterly data hides, culminating powerful validation using minimum wage transitions. Working poverty income data? vignette focuses labor market indicators using quarterly PNADC data. poverty income analysis using annual PNADC data (includes comprehensive household income variables), see Monthly Poverty Analysis Annual PNADC Data.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"prerequisites","dir":"Articles","previous_headings":"","what":"Prerequisites","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"reproduce analyses, need stacked PNADC microdata spanning multiple quarters. code assumes already loaded processed data. See Download Prepare Data data preparation, Get Started basic usage.","code":"# Load required packages library(PNADCperiods) library(data.table) library(ggplot2) library(scales)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"preparing-the-data","dir":"Articles","previous_headings":"","what":"Preparing the Data","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"section shows create aggregate time series used examples .","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"step-1-load-and-mensalize-your-data","dir":"Articles","previous_headings":"Preparing the Data","what":"Step 1: Load and Mensalize Your Data","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"","code":"# Load your stacked PNADC data (see download-and-prepare vignette) library(fst) pnadc <- read_fst(\"path/to/your/pnadc_stacked.fst\", as.data.table = TRUE)  # Build crosswalk (identify reference periods) crosswalk <- pnadc_identify_periods(pnadc, verbose = TRUE)  # Apply crosswalk with weight calibration pnadc <- pnadc_apply_periods(   pnadc,   crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibrate = TRUE )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"step-2-create-labor-market-variables","dir":"Articles","previous_headings":"Preparing the Data","what":"Step 2: Create Labor Market Variables","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"","code":"# Filter to working-age population (14+) pnadc <- pnadc[V2009 >= 14]  # Create labor market indicators pnadc[, `:=`(   # PEA: Economically Active Population (VD4001 == 1)   pea = fifelse(VD4001 == 1, 1L, 0L),    # Employed (VD4002 == 1)   employed = fifelse(VD4002 == 1, 1L, 0L),    # Unemployed (in labor force but not employed)   unemployed = fifelse(VD4002 == 2, 1L, 0L) )]  # Formality indicator (among employed) # Formal: positions 1,3,5,7 OR positions 8,9 with social security contribution pnadc[, formal := fifelse(   VD4009 %in% c(1L, 3L, 5L, 7L), 1L,   fifelse(VD4009 %in% c(8L, 9L) & VD4012 == 1L, 1L, 0L) )] pnadc[VD4002 != 1, formal := NA_integer_]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"step-3-create-quarterly-series","dir":"Articles","previous_headings":"Preparing the Data","what":"Step 3: Create Quarterly Series","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Quarterly aggregates use original IBGE weight (V1028):","code":"quarterly_total <- pnadc[, .(   unemployment_rate = sum(unemployed * V1028, na.rm = TRUE) /                       sum(pea * V1028, na.rm = TRUE),   participation_rate = sum(pea * V1028, na.rm = TRUE) /                        sum(V1028, na.rm = TRUE),   formalization_rate = sum(formal * V1028, na.rm = TRUE) /                        sum(employed * V1028, na.rm = TRUE) ), by = .(Ano, Trimestre)]  # Add period column for plotting (mid-quarter date) quarterly_total[, period := as.Date(paste0(Ano, \"-\", (Trimestre - 1) * 3 + 2, \"-15\"))]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"step-4-create-monthly-series","dir":"Articles","previous_headings":"Preparing the Data","what":"Step 4: Create Monthly Series","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Monthly aggregates use weight_monthly PNADCperiods: objects created, can now run examples .","code":"# Filter to observations with determined reference month pnadc_monthly <- pnadc[!is.na(weight_monthly)]  monthly_total <- pnadc_monthly[, .(   unemployment_rate = sum(unemployed * weight_monthly, na.rm = TRUE) /                       sum(pea * weight_monthly, na.rm = TRUE),   participation_rate = sum(pea * weight_monthly, na.rm = TRUE) /                        sum(weight_monthly, na.rm = TRUE),   formalization_rate = sum(formal * weight_monthly, na.rm = TRUE) /                        sum(employed * weight_monthly, na.rm = TRUE) ), by = ref_month_yyyymm]  # Add period column for plotting (mid-month date) monthly_total[, period := as.Date(paste0(   ref_month_yyyymm %/% 100, \"-\",   ref_month_yyyymm %% 100, \"-15\" ))]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"covid-19-unemployment-the-true-peak","dir":"Articles","previous_headings":"","what":"1. COVID-19 Unemployment: The True Peak","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"COVID-19 pandemic caused sharpest labor market shock Brazilian history. Within weeks, millions workers lost jobs exited labor force entirely. Policymakers scrambled respond, quarterly data relied couldn’t tell exactly crisis peaked severe truly . matters emergency policy responses—unemployment benefits, business support, public health measures—need calibrated actual severity shock. quarterly data says unemployment peaked 14.4% true monthly peak 16.1%, policymakers might underestimate resources needed relief programs. Similarly, knowing peak occurred specific month rather generic “quarter” helps researchers connect labor market outcomes specific policy interventions public health events. Let’s compare quarterly monthly unemployment series COVID period: monthly series reveals unemployment peaked roughly 2 percentage points higher quarterly data suggests, timing peak precisely identified. difference represents millions additional unemployed workers whose situation masked quarterly averaging.","code":"# Filter to COVID period (Oct 2019 - Jan 2022) covid_quarterly <- quarterly_total[period >= \"2019-10-01\" & period <= \"2022-01-01\"] covid_monthly <- monthly_total[period >= \"2019-10-01\" & period <= \"2022-01-01\"]  # Find the unemployment peaks peak_quarterly <- covid_quarterly[which.max(unemployment_rate)] peak_monthly <- covid_monthly[which.max(unemployment_rate)]  # Create the comparison plot ggplot() +   # Quarterly as step function (emphasizes moving-average nature)   geom_step(data = covid_quarterly,             aes(x = period, y = unemployment_rate),             color = \"steelblue\", linewidth = 1.2, direction = \"mid\") +   geom_point(data = covid_quarterly,              aes(x = period, y = unemployment_rate),              color = \"steelblue\", size = 3) +    # Monthly as line   geom_line(data = covid_monthly,             aes(x = period, y = unemployment_rate),             color = \"darkred\", linewidth = 0.9) +   geom_point(data = covid_monthly,              aes(x = period, y = unemployment_rate),              color = \"darkred\", size = 1.5) +    # Annotate monthly peak   annotate(\"segment\",            x = peak_monthly$period, xend = peak_monthly$period,            y = peak_monthly$unemployment_rate + 0.005,            yend = peak_monthly$unemployment_rate + 0.02,            arrow = arrow(length = unit(0.2, \"cm\")), color = \"darkred\") +   annotate(\"text\",            x = peak_monthly$period,            y = peak_monthly$unemployment_rate + 0.022,            label = paste0(\"Monthly peak: \", format(peak_monthly$period, \"%b %Y\"), \"\\n\",                          sprintf(\"%.1f%%\", peak_monthly$unemployment_rate * 100)),            size = 3.2, color = \"darkred\", hjust = 0.5) +    # Annotate quarterly peak   annotate(\"segment\",            x = peak_quarterly$period + 30, xend = peak_quarterly$period + 30,            y = peak_quarterly$unemployment_rate - 0.005,            yend = peak_quarterly$unemployment_rate - 0.02,            arrow = arrow(length = unit(0.2, \"cm\")), color = \"steelblue\") +   annotate(\"text\",            x = peak_quarterly$period + 30,            y = peak_quarterly$unemployment_rate - 0.025,            label = paste0(\"Quarterly peak: \", format(peak_quarterly$period, \"%b %Y\"), \"\\n\",                          sprintf(\"%.1f%%\", peak_quarterly$unemployment_rate * 100)),            size = 3.2, color = \"steelblue\", hjust = 0.5) +    # Scales and labels   scale_y_continuous(labels = percent_format(accuracy = 0.1),                      limits = c(0.10, 0.17)) +   scale_x_date(date_breaks = \"3 months\", date_labels = \"%b\\n%Y\") +   labs(     title = \"COVID-19 Unemployment Spike: Monthly vs Quarterly\",     subtitle = \"Monthly data (red) shows the true peak; quarterly (blue) averages it away\",     x = NULL, y = \"Unemployment Rate\",     caption = \"Source: PNADC/IBGE. Quarterly shown as step function to emphasize moving-average nature.\"   ) +   theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     panel.grid.minor = element_blank()   )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"the-2014-2017-recession-tracking-month-by-month-deterioration","dir":"Articles","previous_headings":"","what":"2. The 2014-2017 Recession: Tracking Month-by-Month Deterioration","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Brazil’s 2014-2017 recession one deepest country’s history. Unemployment rose around 6% 13%, catastrophic deterioration affecting tens millions families. deterioration unfold? unemployment rise gradually, sudden jumps? monthly data tells reveals recession unfolded fits starts, several months showing unemployment increases exceeding 1 percentage point—sudden shocks invisible averaged quarterly figures. distinction matters understanding political economy recessions. Sudden jumps unemployment create different social political pressures gradual deterioration. may trigger policy responses, protests, social reactions. yellow circles mark months unemployment jumped 1 percentage point: sudden deteriorations completely invisible smooth quarterly trend. moments likely correspond specific economic policy events researchers can now investigate.","code":"# Filter to recession period (Jun 2014 - Jun 2017) recession_quarterly <- quarterly_total[period >= \"2014-06-01\" & period <= \"2017-06-01\"] recession_monthly <- monthly_total[period >= \"2014-06-01\" & period <= \"2017-06-01\"]  # Find the peak peak_recession <- recession_monthly[which.max(unemployment_rate)]  # Calculate month-over-month changes setorder(recession_monthly, period) recession_monthly[, change := unemployment_rate - shift(unemployment_rate)]  # Identify months with large jumps (> 1 percentage point) big_jumps <- recession_monthly[!is.na(change) & change > 0.01]  # Create the plot ggplot() +   # Quarterly   geom_step(data = recession_quarterly,             aes(x = period, y = unemployment_rate),             color = \"steelblue\", linewidth = 1, direction = \"mid\", alpha = 0.7) +   geom_point(data = recession_quarterly,              aes(x = period, y = unemployment_rate),              color = \"steelblue\", size = 2.5) +    # Monthly   geom_line(data = recession_monthly,             aes(x = period, y = unemployment_rate),             color = \"darkred\", linewidth = 0.8) +   geom_point(data = recession_monthly,              aes(x = period, y = unemployment_rate),              color = \"darkred\", size = 1.2) +    # Highlight big monthly jumps   geom_point(data = big_jumps,              aes(x = period, y = unemployment_rate),              color = \"darkred\", size = 3, shape = 21, fill = \"yellow\", stroke = 1.5) +    # Mark the peak   annotate(\"point\", x = peak_recession$period, y = peak_recession$unemployment_rate,            color = \"darkred\", size = 4, shape = 18) +   annotate(\"text\",            x = peak_recession$period + 45, y = peak_recession$unemployment_rate,            label = paste0(\"Peak: \", format(peak_recession$period, \"%b %Y\"), \"\\n\",                          sprintf(\"%.1f%%\", peak_recession$unemployment_rate * 100)),            size = 3, hjust = 0, color = \"darkred\") +    # Scales and labels   scale_y_continuous(labels = percent_format(accuracy = 1),                      breaks = seq(0.06, 0.14, 0.02)) +   scale_x_date(date_breaks = \"6 months\", date_labels = \"%b\\n%Y\") +   labs(     title = \"2014-2017 Recession: Month-by-Month Unemployment Rise\",     subtitle = \"Yellow circles: months with >1 p.p. unemployment increase. Monthly data (red) vs quarterly (blue).\",     x = NULL, y = \"Unemployment Rate\",     caption = \"Source: PNADC/IBGE. Monthly data reveals sudden jumps hidden in quarterly averages.\"   ) +   theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     panel.grid.minor = element_blank()   )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"minimum-wage-adjustments-validating-mensalization","dir":"Articles","previous_headings":"","what":"3. Minimum Wage Adjustments: Validating Mensalization","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Perhaps compelling validation mensalization methodology comes tracking minimum wage adjustments. PNADC collects two income measures: Habitual income (VD4016): worker usually earns—refers current reference month Effective income (VD4017): worker actually received—refers previous month distinction creates almost natural experiment. minimum wage increases (typically January), workers earning minimum wage show new value habitual income immediately, effective income still show old value (since refers previous month). following month, effective income catches . one-month lag prediction mensalization methodology. reference month identification correct, see pattern clearly. ’s wrong, pattern blurred absent.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"methodology","dir":"Articles","previous_headings":"3. Minimum Wage Adjustments: Validating Mensalization","what":"Methodology","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"focus formal private sector employees (VD4009 == 1) aged 18 older, tracking share earning exactly historical minimum wage value. precise measurement (“around minimum wage” “exactly R$ 622” “exactly R$ 678”) makes transition patterns especially clear.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"preparing-the-minimum-wage-data","dir":"Articles","previous_headings":"3. Minimum Wage Adjustments: Validating Mensalization","what":"Preparing the Minimum Wage Data","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"analysis requires pre-computed objects: monthly_mw_exact (monthly aggregates MW value) mw_adjustment_months (dates MW changed). ’s create :","code":"# Historical minimum wage values (R$) # Note: 2020 had two adjustments (Jan and Feb), 2023 had mid-year adjustment (May) mw_history <- data.table(   start_yyyymm = c(201201, 201301, 201401, 201501, 201601, 201701, 201801,                    201901, 202001, 202002, 202101, 202201, 202301, 202305,                    202401, 202501),   mw_value = c(622, 678, 724, 788, 880, 937, 954, 998, 1039, 1045, 1100,                1212, 1302, 1320, 1412, 1518) ) mw_adjustment_months <- mw_history$start_yyyymm  # For each formal private sector employee, identify which MW they earn pnadc_formal <- pnadc[VD4009 == 1 & V2009 >= 18 & !is.na(weight_monthly)]  # Match exact habitual/effective incomes to MW values pnadc_formal[, habitual_mw := mw_history[start_yyyymm <= ref_month_yyyymm][.N, mw_value], by = ref_month_yyyymm] pnadc_formal[, at_habitual_mw := as.integer(VD4016 == habitual_mw)] pnadc_formal[, at_effective_mw := as.integer(VD4017 == habitual_mw)]  # Aggregate by month and MW value monthly_mw_exact <- pnadc_formal[, .(   n_workers = sum(weight_monthly),   pct_habitual = sum(at_habitual_mw * weight_monthly) / sum(weight_monthly),   pct_effective = sum(at_effective_mw * weight_monthly) / sum(weight_monthly) ), by = .(ref_month_yyyymm, mw_value = habitual_mw)]  monthly_mw_exact[, period := as.Date(paste0(ref_month_yyyymm %/% 100, \"-\",                                              ref_month_yyyymm %% 100, \"-15\"))]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"the-smoking-gun-january-2013-transition","dir":"Articles","previous_headings":"3. Minimum Wage Adjustments: Validating Mensalization","what":"The Smoking Gun: January 2013 Transition","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"clearest test methodology comes examining single, clean transition. January 2013, minimum wage increased R$ 622 R$ 678: smoking gun. left panel (habitual income), workers shift R$ 622 R$ 678 January. right panel (effective income), shift happens February—exactly one-month lag predicted temporal reference variable.","code":"# Create long format for plotting (needed for all MW examples) mw_long <- melt(monthly_mw_exact,                 id.vars = c(\"ref_month_yyyymm\", \"period\", \"mw_value\", \"n_workers\"),                 measure.vars = c(\"pct_habitual\", \"pct_effective\"),                 variable.name = \"income_type\",                 value.name = \"pct_at_mw\")  # Add readable labels mw_long[, income_label := fifelse(income_type == \"pct_habitual\",                                    \"Habitual Income (current month)\",                                    \"Effective Income (previous month)\")]  # Get adjustment dates for reference lines adj_dates <- as.Date(paste0(mw_adjustment_months %/% 100, \"-\",                              mw_adjustment_months %% 100, \"-15\"))  # Filter to the first transition period (Oct 2012 - Apr 2013) mw_2013 <- mw_long[period >= \"2012-10-15\" & period <= \"2013-04-15\" &                    mw_value %in% c(622, 678)]  # Create the plot ggplot(mw_2013,        aes(x = period, y = pct_at_mw, color = factor(mw_value), linetype = factor(mw_value))) +   geom_line(linewidth = 1.2) +   geom_point(size = 2.5) +    # Mark the adjustment date (January 2013)   geom_vline(xintercept = as.Date(\"2013-01-15\"),              linetype = \"dashed\", linewidth = 0.8, color = \"gray40\") +    # Facet by income type   facet_wrap(~ income_label, ncol = 2) +    # Scales and labels   scale_y_continuous(labels = percent_format(accuracy = 0.1)) +   scale_x_date(date_breaks = \"1 month\", date_labels = \"%b\\n%Y\") +   scale_color_manual(values = c(\"622\" = \"#b2182b\", \"678\" = \"#2166ac\"),                      labels = c(\"622\" = \"R$ 622 (old)\", \"678\" = \"R$ 678 (new)\"),                      name = \"MW Value\") +   scale_linetype_manual(values = c(\"622\" = \"solid\", \"678\" = \"solid\"), guide = \"none\") +   labs(     title = \"MW Transition: January 2013 (R$ 622 -> R$ 678)\",     subtitle = \"Habitual income shows transition in January; Effective income shows same pattern in February\",     x = NULL, y = \"Share Earning Exact MW\",     caption = \"Vertical line = MW adjustment. Habitual income refers to current month; effective to previous month.\"   ) +   theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     legend.position = \"bottom\",     panel.grid.minor = element_blank(),     strip.text = element_text(face = \"bold\")   )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"a-harder-test-the-2020-double-adjustment","dir":"Articles","previous_headings":"3. Minimum Wage Adjustments: Validating Mensalization","what":"A Harder Test: The 2020 Double Adjustment","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"January 2013 transition demonstrates one-month lag perfect clarity. happens things get complicated? year 2020 provides unusually demanding test. unusual sequence, Brazil adjusted minimum wage twice consecutive months: January 2020: R$ 998 → R$ 1,039 (annual adjustment) February 2020: R$ 1,039 → R$ 1,045 (correction) creates situation R$ 1,039 official minimum wage one month. reference month identification imprecise, rapid transitions blur together. Instead: pattern remains crisp even demanding test. habitual income: January shows R$ 1,039 replacing R$ 998 February shows R$ 1,045 replacing R$ 1,039 effective income, transition appears exactly one month later. short-lived R$ 1,039 value creates distinctive spike visible panels, offset precisely one month.","code":"# Filter to 2020 double adjustment period (Jul 2019 - Jul 2020) mw_2020 <- mw_long[period >= \"2019-07-15\" & period <= \"2020-07-15\" &                    mw_value %in% c(998, 1039, 1045)]  # Get adjustment dates in this period adj_2020 <- adj_dates[adj_dates >= \"2019-07-15\" & adj_dates <= \"2020-07-15\"]  # Create the plot ggplot(mw_2020,        aes(x = period, y = pct_at_mw, color = factor(mw_value), linetype = factor(mw_value))) +   geom_line(linewidth = 1.1) +   geom_point(size = 2.5) +    # Mark adjustment months   geom_vline(xintercept = adj_2020, linetype = \"dashed\", linewidth = 0.8, color = \"gray40\") +    # Facet by income type   facet_wrap(~ income_label, ncol = 2) +    # Scales and labels   scale_y_continuous(labels = percent_format(accuracy = 0.1)) +   scale_x_date(date_breaks = \"1 month\", date_labels = \"%b\\n%Y\") +   scale_color_manual(values = c(\"998\" = \"#b2182b\", \"1039\" = \"#7b3294\", \"1045\" = \"#2166ac\"),                      labels = c(\"998\" = \"R$ 998 (2019)\", \"1039\" = \"R$ 1,039 (Jan 2020)\",                                \"1045\" = \"R$ 1,045 (Feb 2020+)\"),                      name = \"MW Value\") +   scale_linetype_manual(values = c(\"998\" = \"solid\", \"1039\" = \"solid\", \"1045\" = \"solid\"),                         guide = \"none\") +   labs(     title = \"The 2020 Double Adjustment: A Demanding Test\",     subtitle = \"R$ 998 -> R$ 1,039 (Jan) -> R$ 1,045 (Feb). Three values, two transitions, one-month lag preserved.\",     x = NULL, y = \"Share Earning Exact MW\",     caption = \"Vertical lines = MW adjustments. The short-lived R$ 1,039 value (one month only) creates a sharp test.\"   ) +   theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     legend.position = \"bottom\",     panel.grid.minor = element_blank(),     strip.text = element_text(face = \"bold\")   )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"the-full-picture-2012-2024","dir":"Articles","previous_headings":"3. Minimum Wage Adjustments: Validating Mensalization","what":"The Full Picture: 2012-2024","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Even consecutive monthly adjustments creating overlapping transitions, one-month lag remains crisp. pattern hold across entire series? figure shows minimum wage values tracked full period. vertical line marks MW adjustment. Notice pattern top panel (habitual income) shifted one month earlier bottom panel (effective income)—exactly predicted, consistently across twelve years dozen minimum wage values. provides strong validation mensalization algorithm correctly identifies reference months.","code":"# Create color palette (blue to red gradient) mw_vals <- sort(unique(monthly_mw_exact$mw_value)) n_mw <- length(mw_vals) palette_fn <- colorRampPalette(c(\"#2166ac\", \"#67a9cf\", \"#d1e5f0\",                                   \"#fddbc7\", \"#ef8a62\", \"#b2182b\")) mw_colors <- palette_fn(n_mw) names(mw_colors) <- as.character(mw_vals)  # Filter to MW values with meaningful presence (>0.1% at some point) mw_long[, max_pct := max(pct_at_mw), by = mw_value] mw_long_filtered <- mw_long[max_pct > 0.001]  # Create the plot ggplot(mw_long_filtered,        aes(x = period, y = pct_at_mw, color = factor(mw_value), group = mw_value)) +   geom_line(linewidth = 0.6, alpha = 0.8) +    # Mark MW adjustment months   geom_vline(xintercept = adj_dates, linetype = \"dashed\", alpha = 0.3, color = \"gray40\") +    # Facet by income type   facet_wrap(~ income_label, ncol = 1) +    # Scales and labels   scale_y_continuous(labels = percent_format(accuracy = 0.1)) +   scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +   scale_color_manual(values = mw_colors, name = \"MW Value (R$)\") +   labs(     title = \"Share of Formal Workers Earning Each Exact MW Value\",     subtitle = \"Each line = one MW value. Vertical lines = MW adjustments. Pattern shifted 1 month between panels.\",     x = NULL, y = \"Share of Workers\",     caption = \"Source: PNADC/IBGE. Formal private sector employees age 18+. All calculations use weight_monthly.\"   ) +   theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     legend.position = \"right\",     legend.key.size = unit(0.4, \"cm\"),     panel.grid.minor = element_blank(),     strip.text = element_text(face = \"bold\", size = 11)   ) +   guides(color = guide_legend(ncol = 2))"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"summary-what-monthly-data-reveals","dir":"Articles","previous_headings":"","what":"Summary: What Monthly Data Reveals","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Monthly data PNADCperiods enables: Precise timing economic turning points True magnitudes shocks (moving averages) Exact dating policy-relevant changes Validation known temporal patterns","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"beyond-monthly-fortnightly-and-weekly-analysis","dir":"Articles","previous_headings":"","what":"4. Beyond Monthly: Fortnightly and Weekly Analysis","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"examples demonstrate power monthly disaggregation. PNADCperiods can go even finer: package also identifies fortnightly (quinzenal, 15-day periods) weekly reference periods observation.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"when-does-finer-granularity-matter","dir":"Articles","previous_headings":"4. Beyond Monthly: Fortnightly and Weekly Analysis","what":"When Does Finer Granularity Matter?","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"phenomena unfold faster monthly cycles: Rapid policy shocks: COVID-19 lockdowns began mid-March 2020—monthly average blends pre- post-lockdown Holiday effects: Carnival, Christmas, New Year distinctive within-month labor market patterns Transition timing: Knowing exactly fortnight week change occurred can matter event studies However, finer granularity comes cost: smaller samples.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"the-sample-size-trade-off","dir":"Articles","previous_headings":"4. Beyond Monthly: Fortnightly and Weekly Analysis","what":"The Sample Size Trade-Off","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"low rates fortnights weeks? Unlike months, aggregate constraints across multiple quarterly visits (leveraging panel design), fortnights weeks can use information within single quarter. birthday constraints rarely narrow interview window single 15-day 7-day period.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"example-covid-19-lockdown-at-fortnightly-resolution","dir":"Articles","previous_headings":"4. Beyond Monthly: Fortnightly and Weekly Analysis","what":"Example: COVID-19 Lockdown at Fortnightly Resolution","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"COVID-19 pandemic provides compelling test case. Brazilian lockdowns began around March 16, 2020—almost perfectly aligned fortnight boundary. Monthly data March averages pre-lockdown first half post-lockdown second half. Fortnightly data can separate . examine labor force participation, dropped sharply workers exited labor market entirely (just becoming unemployed, stopping job search): fortnightly data shows sharper discontinuity around March 16—participation rate second fortnight March (Mar-2) dropped steeply monthly average suggests. demonstrates fortnightly resolution can capture transition timing precisely.","code":"# For fortnightly analysis, we need observations with determined fortnights pnadc_fortnight <- result[!is.na(weight_fortnight) & Ano == 2020 & Trimestre %in% 1:2]  # Compute participation rate by fortnight fortnight_covid <- pnadc_fortnight[, .(   participation_rate = sum(pea * weight_fortnight, na.rm = TRUE) /                        sum(weight_fortnight, na.rm = TRUE),   unemployment_rate = sum(unemployed * weight_fortnight, na.rm = TRUE) /                       sum(pea * weight_fortnight, na.rm = TRUE),   n_obs = .N ), by = .(Ano, Trimestre, ref_fortnight_in_quarter, ref_fortnight_yyyyff)]  # Add period Date column (1st or 16th of month) fortnight_covid[, `:=`(   month = ((ref_fortnight_yyyyff %% 100) - 1L) %/% 2L + 1L,   day = fifelse(ref_fortnight_yyyyff %% 2L == 1L, 1L, 16L),   year = ref_fortnight_yyyyff %/% 100L )] fortnight_covid[, period := as.Date(paste(year, month, day, sep = \"-\"))]  # Create plot comparing monthly vs fortnightly ggplot() +   # Monthly as reference   geom_line(data = covid_monthly_participation,             aes(x = period, y = participation_rate),             color = \"darkred\", linewidth = 1, alpha = 0.7) +   geom_point(data = covid_monthly_participation,              aes(x = period, y = participation_rate),              color = \"darkred\", size = 3) +    # Fortnightly   geom_line(data = covid_fortnight_participation,             aes(x = period, y = participation_rate),             color = \"#ff7f0e\", linewidth = 0.8, linetype = \"dashed\") +   geom_point(data = covid_fortnight_participation,              aes(x = period, y = participation_rate),              color = \"#ff7f0e\", size = 2) +    # Mark lockdown transition   geom_vline(xintercept = as.Date(\"2020-03-16\"),              linetype = \"dotted\", color = \"gray40\") +    scale_y_continuous(labels = percent_format(accuracy = 0.1)) +   scale_x_date(date_breaks = \"1 month\", date_labels = \"%b\\n%Y\") +   labs(     title = \"COVID-19 Labor Force Participation: Monthly vs Fortnightly\",     subtitle = \"Fortnightly data (orange) reveals sharper discontinuity at lockdown onset\",     x = NULL, y = \"Labor Force Participation Rate\",     caption = \"Monthly (red): ~65,000 obs/month | Fortnightly (orange): ~3,000 obs/fortnight\"   ) +   theme_minimal(base_size = 11)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"example-carnival-week-labor-market-effects","dir":"Articles","previous_headings":"4. Beyond Monthly: Fortnightly and Weekly Analysis","what":"Example: Carnival Week Labor Market Effects","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Carnival Brazil’s largest cultural event, concentrated specific states (Bahia, Rio de Janeiro, Pernambuco) occurring specific week year. workers reduce hours Carnival week? challenging analysis due ~1% weekly determination rate. increase sample size, pool multiple years (2019, 2022-2024, excluding COVID years) compare Carnival states states. use average hours worked (VD4035) indicator, show clear drop Carnival: comparison shows workers Carnival-intensive states (BA/RJ/PE) reduce average hours worked Carnival week (34.8h) compared weeks (36.9h)—drop 2 hours. pattern provides evidence Carnival’s labor market impact, though small weekly sample sizes mean estimates considerable uncertainty.","code":"# Filter to Q1 of Carnival years (2019, 2022-2024) # Use observations with determined weeks (among employed with valid hours) carnival_years <- c(2019L, 2022L, 2023L, 2024L) pnadc_weekly <- pnadc[   !is.na(ref_week_in_quarter) & Trimestre == 1L & Ano %in% carnival_years &   employed == 1L & !is.na(VD4035) ]  # Define Carnival weeks (ISO week of Carnival Tuesday varies by year) # 2019: Week 10 | 2022: Week 9 | 2023: Week 8 | 2024: Week 7 carnival_weeks <- data.table(   Ano = carnival_years,   carnival_iso_week = c(10L, 9L, 8L, 7L) )  # Extract ISO week and merge pnadc_weekly[, iso_week := ref_week_yyyyww %% 100L] pnadc_weekly <- merge(pnadc_weekly, carnival_weeks, by = \"Ano\", all.x = TRUE) pnadc_weekly[, is_carnival_week := (iso_week == carnival_iso_week)]  # Flag Carnival-intensive states (BA=29, RJ=33, PE=26) pnadc_weekly[, is_carnival_state := UF %in% c(29L, 33L, 26L)]  # Aggregate: Average hours worked by Carnival vs non-Carnival weeks × region weekly_carnival <- pnadc_weekly[, .(   avg_hours_worked = sum(VD4035 * V1028, na.rm = TRUE) /                      sum(V1028, na.rm = TRUE),   n_obs = .N ), by = .(is_carnival_week, is_carnival_state)]  # Create difference-in-differences plot ggplot(weekly_carnival,        aes(x = fifelse(is_carnival_week, \"Carnival Week\", \"Other Weeks\"),            y = avg_hours_worked,            fill = fifelse(is_carnival_state, \"Carnival States (BA/RJ/PE)\", \"Other States\"))) +   geom_col(position = position_dodge(width = 0.8), width = 0.7) +   scale_y_continuous(limits = c(0, 45)) +   scale_fill_manual(values = c(\"Carnival States (BA/RJ/PE)\" = \"#ff7f0e\",                                \"Other States\" = \"#1f77b4\")) +   labs(     title = \"Average Hours Worked by Week Type and Region\",     subtitle = \"Pooled data from Q1 2019, 2022-2024\",     x = NULL, y = \"Average Hours Worked (per week)\",     fill = \"Region\",     caption = \"Weekly determination rate: ~1%. Data pooled across 4 years.\"   ) +   theme_minimal(base_size = 11)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"practical-guidelines-for-sub-monthly-analysis","dir":"Articles","previous_headings":"4. Beyond Monthly: Fortnightly and Weekly Analysis","what":"Practical Guidelines for Sub-Monthly Analysis","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Key takeaways: Monthly analysis handles use cases high determination rates robust samples Fortnightly analysis works detecting transition timing fortnight boundary aligns event interest (e.g., mid-month policy changes) Weekly analysis requires pooling multiple years focusing aggregate patterns; subgroup analysis rarely feasible","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"reproducing-these-results","dir":"Articles","previous_headings":"","what":"Reproducing These Results","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"reproduce analyses vignette: Download PNADC quarterly microdata IBGE Stack multiple quarters (recommend least 2 years) Apply mensalization: See Get Started complete documentation package functions.","code":"library(PNADCperiods) library(data.table)  # Load your stacked PNADC data pnadc <- fread(\"your_pnadc_stacked.csv\")  # Build crosswalk and apply with weight calibration crosswalk <- pnadc_identify_periods(pnadc) result <- pnadc_apply_periods(pnadc, crosswalk,                                weight_var = \"V1028\",                                anchor = \"quarter\",                                calibrate = TRUE)  # Compute monthly series monthly_total <- result[!is.na(weight_monthly), .(   unemployment_rate = sum((VD4001 == 1 & VD4002 == 2) * weight_monthly) /                       sum((VD4001 == 1) * weight_monthly),   participation_rate = sum((VD4001 == 1) * weight_monthly) /                        sum(weight_monthly) ), by = ref_month_yyyymm]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"see-also","dir":"Articles","previous_headings":"","what":"See Also","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"Get Started - Basic mensalization workflow Works - Algorithm details technical explanation Annual Poverty Analysis - Monthly poverty analysis annual income data Download Prepare Data - Data download workflow","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/applied-examples.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Applied Examples: Monthly vs Quarterly Labor Market Analysis","text":"IBGE. Pesquisa Nacional por Amostra de Domicilios Continua (PNADC). https://www.ibge.gov.br/estatisticas/sociais/trabalho/ Hecksher, M. (2024). Mensalizacao da PNADC. Working paper.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Complex Survey Design with Monthly Weights","text":"compute statistic survey data—say, unemployment rate 7.2%—number alone doesn’t tell much. 7.2% meaningfully different last month’s 7.0%? true rate plausibly 6.5% 8.0%? Without standard errors confidence intervals, can’t answer questions. ’re flying blind. matters especially tracking changes time. Monthly data mensalizePNADC reveals dynamics hidden quarterly averages, sharp month--month movements real economic changes just sampling variability. Standard errors let distinguish signal noise. challenge PNADC uses complex sample design. ’s simple random sample standard formulas apply. Instead, PNADC uses: Stratification: Households grouped strata (Estrato) sampling Clustering: Within strata, census tracts (UPA) sampled, eligible households selected tracts interviewed Unequal probabilities: groups oversampled better precision Ignoring design typically underestimates standard errors, sometimes dramatically. naive analysis might claim statistically significant changes actually within margin error. vignette shows two strategies proper variance estimation monthly weights mensalizePNADC: Linearization approach: Using design variables directly—simple fast Replication weights approach: Adjusting IBGE’s 200 bootstrap weights—computationally intensive exact ’ll demonstrate using compelling example: gender gap labor force participation, widened dramatically COVID-19.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"why-standard-errors-matter-a-visual-motivation","dir":"Articles","previous_headings":"","what":"Why Standard Errors Matter: A Visual Motivation","title":"Complex Survey Design with Monthly Weights","text":"diving methodology, let’s see matters. figure shows labor force participation men women COVID-19 period. shaded bands show 95% confidence intervals proper complex survey analysis. Notice several things: Women’s participation dropped sharply men’s—confidence bands help us assess whether difference statistically meaningful month--month changes look dramatic might within sampling error. Without confidence intervals, ’d tempted -interpret random fluctuations recovery path shows persistent gaps confidence bands confirm real, noise need standard errors: transform raw numbers actionable knowledge.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"required-packages","dir":"Articles","previous_headings":"Prerequisites","what":"Required Packages","title":"Complex Survey Design with Monthly Weights","text":"","code":"# Core packages library(PNADCperiods) library(data.table)  # Survey analysis library(survey)       # For svydesign and linearization-based variance library(srvyr)        # Tidyverse-friendly wrapper for survey  # Visualization library(ggplot2) library(scales)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"required-variables","dir":"Articles","previous_headings":"Prerequisites","what":"Required Variables","title":"Complex Survey Design with Monthly Weights","text":"implement complex survey analysis, PNADC data needs specific design variables included minimal stacked data used basic mensalization. need full quarterly microdata:","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"loading-and-preparing-data","dir":"Articles","previous_headings":"Prerequisites","what":"Loading and Preparing Data","title":"Complex Survey Design with Monthly Weights","text":"","code":"# Load stacked PNADC data with ALL required variables # This needs: Ano, Trimestre, UPA, V1008, V1014, V2003, V2008, V20081, V20082, V2009 #             V1028, UF, posest, posest_sxi (for weight calibration) #             Estrato (for Strategy 1) #             V1028001-V1028200 (for Strategy 2) #             Plus any analysis variables (VD4001, VD4002, V2007, etc.)  pnadc <- fread(\"path/to/your/pnadc_full_stacked.csv\")  # Step 1: Build crosswalk (identify reference periods) crosswalk <- pnadc_identify_periods(pnadc)  # Step 2: Apply crosswalk and calibrate weights pnadc <- pnadc_apply_periods(pnadc, crosswalk,                               weight_var = \"V1028\",                               anchor = \"quarter\",                               calibrate = TRUE)  # Filter to determined observations (those with monthly weights) pnadc_monthly <- pnadc[!is.na(weight_monthly)]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"strategy-1-linearization-with-strata-and-psu","dir":"Articles","previous_headings":"","what":"Strategy 1: Linearization with Strata and PSU","title":"Complex Survey Design with Monthly Weights","text":"approach uses Taylor series linearization estimate variances. ’s standard method implemented survey software, fast compute, works well means, proportions, totals, ratios.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"understanding-the-survey-design","dir":"Articles","previous_headings":"Strategy 1: Linearization with Strata and PSU","what":"Understanding the Survey Design","title":"Complex Survey Design with Monthly Weights","text":"PNADC uses two-stage stratified cluster sample: Stage 1: Within stratum (Estrato), Primary Sampling Units (census tracts, UPA) selected probability proportional size Stage 2: Within selected UPAs, households systematically selected stratification improves precision ensuring representation across geographic demographic groups. clustering introduces correlation among observations within UPA, typically increases variance compared simple random sampling.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"setting-up-the-survey-design","dir":"Articles","previous_headings":"Strategy 1: Linearization with Strata and PSU","what":"Setting Up the Survey Design","title":"Complex Survey Design with Monthly Weights","text":"nest = TRUE argument important: tells survey package UPA codes unique within strata, across entire dataset.","code":"# Create survey design object for a specific month # Let's analyze January 2020 (ref_month_yyyymm = 202001)  pnadc_jan2020 <- pnadc_monthly[ref_month_yyyymm == 202001]  # Set up the survey design design_jan2020 <- svydesign(   ids = ~UPA,                    # PSU/cluster identifier   strata = ~Estrato,             # Stratification variable   weights = ~weight_monthly,     # Monthly-adjusted weight   data = pnadc_jan2020,   nest = TRUE                    # UPAs are nested within strata )  # Check the design summary(design_jan2020)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"computing-estimates-with-standard-errors","dir":"Articles","previous_headings":"Strategy 1: Linearization with Strata and PSU","what":"Computing Estimates with Standard Errors","title":"Complex Survey Design with Monthly Weights","text":"","code":"# Labor force participation rate (VD4001 == 1 means in labor force) # Filter to working-age population (14+) first design_14plus <- subset(design_jan2020, V2009 >= 14)  participation <- svymean(~I(VD4001 == 1), design_14plus, na.rm = TRUE) print(participation)  # Get confidence interval confint(participation, level = 0.95)  # Participation by sex (V2007: 1 = Male, 2 = Female) participation_by_sex <- svyby(   ~I(VD4001 == 1),   by = ~V2007,   design = design_14plus,   FUN = svymean,   na.rm = TRUE ) print(participation_by_sex)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"monthly-time-series-with-confidence-intervals","dir":"Articles","previous_headings":"Strategy 1: Linearization with Strata and PSU","what":"Monthly Time Series with Confidence Intervals","title":"Complex Survey Design with Monthly Weights","text":"create full monthly series, loop months collect results:","code":"# Function to compute participation rate for one month compute_participation <- function(month_yyyymm, data) {    month_data <- data[ref_month_yyyymm == month_yyyymm & V2009 >= 14]    if (nrow(month_data) == 0) return(NULL)    # Create survey design   design <- svydesign(     ids = ~UPA,     strata = ~Estrato,     weights = ~weight_monthly,     data = month_data,     nest = TRUE   )    # Compute overall participation   result <- svymean(~I(VD4001 == 1), design, na.rm = TRUE)    data.table(     ref_month_yyyymm = month_yyyymm,     participation = as.numeric(result),     se = as.numeric(SE(result))   ) }  # Get all unique months months <- sort(unique(pnadc_monthly$ref_month_yyyymm))  # Compute for all months (this may take a few minutes) results_list <- lapply(months, compute_participation, data = pnadc_monthly) monthly_participation <- rbindlist(results_list)  # Add confidence intervals monthly_participation[, `:=`(   ci_lower = participation - 1.96 * se,   ci_upper = participation + 1.96 * se,   period = as.Date(paste0(ref_month_yyyymm %/% 100, \"-\",                           ref_month_yyyymm %% 100, \"-15\")) )]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"strategy-2-adjusted-replication-weights","dir":"Articles","previous_headings":"","what":"Strategy 2: Adjusted Replication Weights","title":"Complex Survey Design with Monthly Weights","text":"IBGE provides 200 bootstrap replication weights (V1028001 V1028200) quarterly release. weights generated resampling original sample design recalculating weights, capturing full complexity survey design. approach computationally intensive (compute statistic 201 times: main weights, 200 times replication weights), handles complex statistics like quantiles, Gini coefficients, regression coefficients without requiring special variance formulas.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"the-adjustment-logic","dir":"Articles","previous_headings":"Strategy 2: Adjusted Replication Weights","what":"The Adjustment Logic","title":"Complex Survey Design with Monthly Weights","text":"key insight weight_monthly product original weight V1028 adjustment factors mensalization calibration. apply ratio replication weight: V1028kmonthly=V1028k×weight_monthlyV1028 \\text{V1028}_k^{\\text{monthly}} = \\text{V1028}_k \\times \\frac{\\text{weight\\_monthly}}{\\text{V1028}} k=001,002,…,200k = 001, 002, \\ldots, 200 indexes replication weights. preserves variance properties replication weights incorporating mensalization adjustments.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"creating-adjusted-replication-weights","dir":"Articles","previous_headings":"Strategy 2: Adjusted Replication Weights","what":"Creating Adjusted Replication Weights","title":"Complex Survey Design with Monthly Weights","text":"","code":"# Calculate the adjustment ratio pnadc_monthly[, weight_ratio := weight_monthly / V1028]  # Get names of replication weight columns rep_weight_cols <- paste0(\"V1028\", sprintf(\"%03d\", 1:200))  # Create adjusted replication weight columns for (col in rep_weight_cols) {   new_col <- paste0(col, \"_monthly\")   pnadc_monthly[, (new_col) := get(col) * weight_ratio] }  # Verify the adjustment (the ratio should be constant within each observation) cat(\"Ratio range:\", range(pnadc_monthly$weight_ratio, na.rm = TRUE), \"\\n\")"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"setting-up-the-replicate-design","dir":"Articles","previous_headings":"Strategy 2: Adjusted Replication Weights","what":"Setting Up the Replicate Design","title":"Complex Survey Design with Monthly Weights","text":"","code":"# Create survey design with replication weights for January 2020 pnadc_jan2020_rep <- pnadc_monthly[ref_month_yyyymm == 202001]  # Get adjusted replication weight column names rep_weight_cols_monthly <- paste0(\"V1028\", sprintf(\"%03d\", 1:200), \"_monthly\")  # Create replicate weights design # type = \"bootstrap\" matches IBGE's methodology design_rep_jan2020 <- svrepdesign(   data = pnadc_jan2020_rep,   weights = ~weight_monthly,   repweights = rep_weight_cols_monthly,   type = \"bootstrap\",   combined.weights = TRUE     # The replication weights already include the base weight )  summary(design_rep_jan2020)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"computing-estimates-with-replication-variance","dir":"Articles","previous_headings":"Strategy 2: Adjusted Replication Weights","what":"Computing Estimates with Replication Variance","title":"Complex Survey Design with Monthly Weights","text":"","code":"# Labor force participation rate design_rep_14plus <- subset(design_rep_jan2020, V2009 >= 14)  participation_rep <- svymean(~I(VD4001 == 1), design_rep_14plus, na.rm = TRUE) print(participation_rep)  # Compare with linearization estimate cat(\"\\nLinearization SE:\", as.numeric(SE(participation)), \"\\n\") cat(\"Replication SE:\", as.numeric(SE(participation_rep)), \"\\n\")  # Participation by sex participation_by_sex_rep <- svyby(   ~I(VD4001 == 1),   by = ~V2007,   design = design_rep_14plus,   FUN = svymean,   na.rm = TRUE ) print(participation_by_sex_rep)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"practical-example-gender-gap-in-labor-force-participation","dir":"Articles","previous_headings":"","what":"Practical Example: Gender Gap in Labor Force Participation","title":"Complex Survey Design with Monthly Weights","text":"Brazil one largest gender gaps labor force participation among major economies. 73% working-age men participate labor force, 53% women —gap roughly 20 percentage points persisted decades. gap represents millions potential workers labor market, profound implications economic growth, household income inequality, women’s economic autonomy. Understanding gap evolves—whether changes statistically significant—crucial policy evaluation. COVID-19 pandemic provides natural experiment. School closures increased caregiving demands fell disproportionately women. widen participation gap? Monthly data lets us track dynamics precisely.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"computing-monthly-series-by-sex","dir":"Articles","previous_headings":"Practical Example: Gender Gap in Labor Force Participation","what":"Computing Monthly Series by Sex","title":"Complex Survey Design with Monthly Weights","text":"","code":"# Prepare analysis data pnadc_analysis <- pnadc_monthly[V2009 >= 14] pnadc_analysis[, in_labor_force := fifelse(VD4001 == 1, 1L, 0L)] pnadc_analysis[, sex := fifelse(V2007 == 1, \"Men\", \"Women\")]  # Function to compute participation by sex for one month compute_participation_by_sex <- function(month_yyyymm, data) {    month_data <- data[ref_month_yyyymm == month_yyyymm]    if (nrow(month_data) == 0) return(NULL)    # Create survey design   design <- svydesign(     ids = ~UPA,     strata = ~Estrato,     weights = ~weight_monthly,     data = month_data,     nest = TRUE   )    # Compute participation by sex   result <- svyby(     ~in_labor_force,     by = ~sex,     design = design,     FUN = svymean,     na.rm = TRUE,     vartype = c(\"se\", \"ci\")   )    setDT(result)   result[, ref_month_yyyymm := month_yyyymm]    result }  # Compute for all months months <- sort(unique(pnadc_analysis$ref_month_yyyymm)) results_by_sex <- rbindlist(lapply(months, compute_participation_by_sex, data = pnadc_analysis))  # Rename columns for clarity setnames(results_by_sex,          c(\"in_labor_force\", \"se\", \"ci_l\", \"ci_u\"),          c(\"participation\", \"se\", \"ci_lower\", \"ci_upper\"))  # Add date column for plotting results_by_sex[, period := as.Date(paste0(   ref_month_yyyymm %/% 100, \"-\",   ref_month_yyyymm %% 100, \"-15\" ))]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"visualizing-the-gender-gap-with-confidence-bands","dir":"Articles","previous_headings":"Practical Example: Gender Gap in Labor Force Participation","what":"Visualizing the Gender Gap with Confidence Bands","title":"Complex Survey Design with Monthly Weights","text":"figure reveals several important patterns: gender gap persistent large: Men’s participation hovers around 73%, women’s around 53%—20 percentage-point gap COVID-19 hit women harder: Women’s participation dropped ~53% 47% pandemic, men’s dropped ~73% ~66% confidence bands confirm real differences: bands men women never overlap, meaning gender gap statistically significant every single month Recovery uneven: series recovered late 2021, examining gap tells nuanced story","code":"# Create the plot ggplot(results_by_sex, aes(x = period, y = participation, color = sex, fill = sex)) +    # Confidence bands   geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper), alpha = 0.2, color = NA) +    # Point estimates   geom_line(linewidth = 0.8) +    # Highlight COVID period   annotate(\"rect\",            xmin = as.Date(\"2020-03-01\"), xmax = as.Date(\"2021-12-31\"),            ymin = -Inf, ymax = Inf,            fill = \"gray80\", alpha = 0.3) +   annotate(\"text\",            x = as.Date(\"2021-01-01\"), y = 0.85,            label = \"COVID-19\", fontface = \"italic\", size = 3, color = \"gray40\") +    # Scales and labels   scale_y_continuous(     labels = percent_format(accuracy = 1),     limits = c(0.45, 0.85),     breaks = seq(0.45, 0.85, 0.05)   ) +   scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +   scale_color_manual(values = c(\"Men\" = \"#0074D9\", \"Women\" = \"#FF4136\")) +   scale_fill_manual(values = c(\"Men\" = \"#0074D9\", \"Women\" = \"#FF4136\")) +    labs(     title = \"Labor Force Participation by Sex: Monthly Series with 95% Confidence Intervals\",     subtitle = \"Brazil, 2012-2024. Shaded regions show 95% confidence bands from complex survey design.\",     x = NULL,     y = \"Labor Force Participation Rate\",     color = \"Sex\",     fill = \"Sex\",     caption = \"Source: PNADC/IBGE. Monthly weights from mensalizePNADC. Variance estimated via Taylor linearization.\"   ) +    theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     legend.position = \"bottom\",     panel.grid.minor = element_blank()   )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"computing-the-gender-gap-with-standard-errors","dir":"Articles","previous_headings":"Practical Example: Gender Gap in Labor Force Participation","what":"Computing the Gender Gap with Standard Errors","title":"Complex Survey Design with Monthly Weights","text":"gender gap derived statistic: difference two survey estimates. need standard error difference:","code":"# Function to compute the gender gap for one month compute_gender_gap <- function(month_yyyymm, data) {    month_data <- data[ref_month_yyyymm == month_yyyymm]    if (nrow(month_data) == 0) return(NULL)    design <- svydesign(     ids = ~UPA,     strata = ~Estrato,     weights = ~weight_monthly,     data = month_data,     nest = TRUE   )    # Compute participation by sex   by_sex <- svyby(~in_labor_force, ~sex, design, svymean, na.rm = TRUE)    # Extract values   men_rate <- coef(by_sex)[\"Men\"]   women_rate <- coef(by_sex)[\"Women\"]    # The variance of (Men - Women) = Var(Men) + Var(Women) - 2*Cov(Men, Women)   # For independent samples, Cov ≈ 0, so SE(gap) ≈ sqrt(SE_men^2 + SE_women^2)   se_men <- SE(by_sex)[\"Men\"]   se_women <- SE(by_sex)[\"Women\"]   se_gap <- sqrt(se_men^2 + se_women^2)    data.table(     ref_month_yyyymm = month_yyyymm,     gap = men_rate - women_rate,     se = se_gap,     men_rate = men_rate,     women_rate = women_rate   ) }  # Compute for all months gap_results <- rbindlist(lapply(months, compute_gender_gap, data = pnadc_analysis))  # Add confidence intervals and date gap_results[, `:=`(   ci_lower = gap - 1.96 * se,   ci_upper = gap + 1.96 * se,   period = as.Date(paste0(ref_month_yyyymm %/% 100, \"-\", ref_month_yyyymm %% 100, \"-15\")) )]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"visualizing-the-gender-gap-over-time","dir":"Articles","previous_headings":"Practical Example: Gender Gap in Labor Force Participation","what":"Visualizing the Gender Gap Over Time","title":"Complex Survey Design with Monthly Weights","text":"figure tells clear story: Pre-COVID: gap stable around 20 percentage points (dashed line) COVID: gap widened significantly 22-23 percentage points—confidence bands confirm widening statistically significant, sampling noise Post-COVID: gap returned approximately pre-pandemic levels 2022 confidence bands crucial . Without , might dismiss 2-3 percentage point increase COVID noise. , can confidently say pandemic disproportionately pushed women labor force.","code":"ggplot(gap_results, aes(x = period, y = gap)) +    # Confidence band   geom_ribbon(aes(ymin = ci_lower, ymax = ci_upper),               fill = \"#7b3294\", alpha = 0.3) +    # Point estimate   geom_line(color = \"#7b3294\", linewidth = 0.9) +    # Reference line at pre-COVID average   geom_hline(     yintercept = gap_results[period < \"2020-03-01\", mean(gap)],     linetype = \"dashed\", color = \"gray50\"   ) +    # Highlight COVID period   annotate(\"rect\",            xmin = as.Date(\"2020-03-01\"), xmax = as.Date(\"2021-12-31\"),            ymin = -Inf, ymax = Inf,            fill = \"gray80\", alpha = 0.3) +    # Scales and labels   scale_y_continuous(     labels = percent_format(accuracy = 1),     breaks = seq(0.15, 0.30, 0.025)   ) +   scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +    labs(     title = \"Gender Gap in Labor Force Participation (Men - Women)\",     subtitle = \"Monthly series with 95% CI. Dashed line = pre-COVID average. Gap widened during pandemic.\",     x = NULL,     y = \"Participation Gap (percentage points)\",     caption = \"Source: PNADC/IBGE. Monthly weights from mensalizePNADC.\"   ) +    theme_minimal(base_size = 11) +   theme(     plot.title = element_text(face = \"bold\"),     panel.grid.minor = element_blank()   )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"comparing-the-two-strategies","dir":"Articles","previous_headings":"","what":"Comparing the Two Strategies","title":"Complex Survey Design with Monthly Weights","text":"strategies produce similar standard error estimates simple statistics like means proportions. ’s use : Recommendation: Use Strategy 1 exploratory analysis routine work. Use Strategy 2 : need exact consistency IBGE’s official standard errors ’re computing complex statistics (quantiles, Gini, regression coefficients) ’re preparing results publication official reports","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"design-effects-and-effective-sample-size","dir":"Articles","previous_headings":"Important Considerations","what":"Design Effects and Effective Sample Size","title":"Complex Survey Design with Monthly Weights","text":"complex sample design affects precision. can examine design effect (deff), measures much larger variance compared simple random sample: PNADC, design effects typically range 1.5 3.0 national estimates, meaning ’d need 1.5-3x many observations simple random sample achieve precision.","code":"# Compute design effect for participation rate deff(svymean(~I(VD4001 == 1), design_14plus, na.rm = TRUE, deff = TRUE))  # Design effect > 1 means clustering/stratification increased variance # Design effect < 1 means stratification improved precision"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"handling-singleton-strata","dir":"Articles","previous_headings":"Important Considerations","what":"Handling Singleton Strata","title":"Complex Survey Design with Monthly Weights","text":"months may strata one PSU (singleton strata), causes problems variance estimation. survey package handles several options: \"adjust\" option recommended provides conservative (larger) standard errors.","code":"# Set option for handling singleton strata options(survey.lonely.psu = \"adjust\")  # Recommended: conservative adjustment  # Other options: # \"remove\" - drop singleton strata from variance calculation # \"average\" - use average variance contribution # \"certainty\" - treat as certainty selections (SE = 0)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"subpopulation-analysis","dir":"Articles","previous_headings":"Important Considerations","what":"Subpopulation Analysis","title":"Complex Survey Design with Monthly Weights","text":"analyzing subgroups, always subset design object, raw data: Subsetting data creating design object loses information full sample structure, leading incorrect variance estimates.","code":"# CORRECT: Subset the design design_women <- subset(design_14plus, V2007 == 2) svymean(~I(VD4001 == 1), design_women, na.rm = TRUE)  # INCORRECT: Don't do this - loses design information # bad_design <- svydesign(..., data = pnadc[V2007 == 2])"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"using-srvyr-for-tidyverse-style-analysis","dir":"Articles","previous_headings":"","what":"Using srvyr for Tidyverse-Style Analysis","title":"Complex Survey Design with Monthly Weights","text":"prefer tidyverse syntax, srvyr package wraps survey package dplyr verbs:","code":"library(srvyr)  # Convert to srvyr design design_srvyr <- pnadc_jan2020 %>%   filter(V2009 >= 14) %>%   as_survey_design(     ids = UPA,     strata = Estrato,     weights = weight_monthly,     nest = TRUE   )  # Compute participation by sex using dplyr verbs participation_srvyr <- design_srvyr %>%   mutate(sex = if_else(V2007 == 1, \"Men\", \"Women\"),          in_lf = VD4001 == 1) %>%   group_by(sex) %>%   summarise(     participation = survey_mean(in_lf, na.rm = TRUE, vartype = \"ci\")   )  print(participation_srvyr)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"summary","dir":"Articles","previous_headings":"","what":"Summary","title":"Complex Survey Design with Monthly Weights","text":"vignette demonstrated two approaches computing standard errors monthly PNADC weights PNADCperiods: Strategy 1 (Linearization): Use Estrato strata, UPA PSU, weight_monthly weight standard survey design. Fast, simple, works statistics. Strategy 2 (Replication): Multiply 200 bootstrap replication weights weight_monthly / V1028 create adjusted replication weights. intensive exact. practical example demonstrated gender gap labor force participation widened significantly COVID-19—finding impossible assess properly without standard errors. confidence bands transformed claim like “gap looks bigger” “gap increased 2-3 percentage points, ’re 95% confident ’s real.” Monthly data without standard errors like dashboard warning lights burned . can see numbers, can’t tell changes matter.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/complex-survey-design.html","id":"further-reading","dir":"Articles","previous_headings":"","what":"Further Reading","title":"Complex Survey Design with Monthly Weights","text":"Get Started - Basic mensalization workflow Works - Algorithm details weight calibration methodology Applied Examples - applications monthly data Thomas Lumley (2010). Complex Surveys: Guide Analysis Using R. Wiley. IBGE. Notas Metodologicas da PNAD Continua.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"executive-summary","dir":"Articles","previous_headings":"","what":"Executive Summary","title":"Determination Rates Benchmark Report","text":"document presents comprehensive benchmark results PNADCperiods package, tested complete PNADC quarterly data 2012 2025 (55 quarters, 28.4 million individual observations, 9.6 million unique household-quarter combinations).","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"experimental-strategies-summary","dir":"Articles","previous_headings":"Executive Summary","what":"Experimental Strategies Summary","title":"Determination Rates Benchmark Report","text":"Key finding: UPA homogeneity rate = 100% fortnights weeks.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"source","dir":"Articles","previous_headings":"Data Description","what":"Source","title":"Determination Rates Benchmark Report","text":"Dataset: PNADC (Pesquisa Nacional por Amostra de Domicilios Continua) Source: IBGE (Brazilian Institute Geography Statistics) Type: Quarterly household survey microdata Format: FST files (fast serialization)","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"variables-used","dir":"Articles","previous_headings":"Data Description","what":"Variables Used","title":"Determination Rates Benchmark Report","text":"following variables required period identification:","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"pnadc_identify_periods","dir":"Articles","previous_headings":"Functions Tested","what":"pnadc_identify_periods()","title":"Determination Rates Benchmark Report","text":"main function building reference period crosswalk.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"function-signature","dir":"Articles","previous_headings":"Functions Tested > pnadc_identify_periods()","what":"Function Signature","title":"Determination Rates Benchmark Report","text":"","code":"pnadc_identify_periods(   data,   verbose = TRUE )"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"return-value","dir":"Articles","previous_headings":"Functions Tested > pnadc_identify_periods()","what":"Return Value","title":"Determination Rates Benchmark Report","text":"data.table crosswalk following columns:","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"algorithm-overview","dir":"Articles","previous_headings":"Functions Tested > pnadc_identify_periods()","what":"Algorithm Overview","title":"Determination Rates Benchmark Report","text":"Preprocessing: Convert input data.table, handle special codes (99, 9999) Saturday calculation: Compute first valid interview Saturday month Birthday constraints: Narrow interview date range based respondent birthdates Period position conversion: Convert date bounds month/fortnight/week positions Cross-quarter aggregation (months ): Aggregate constraints UPA-V1014 level across quarters Within-quarter aggregation (fortnight/week): Aggregate household level within quarter Exception detection: Identify quarters requiring relaxed rules Final determination: min position == max position, period determined","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"pnadc_experimental_periods","dir":"Articles","previous_headings":"Functions Tested","what":"pnadc_experimental_periods()","title":"Determination Rates Benchmark Report","text":"Experimental function providing probabilistic period assignment narrow ranges.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"function-signature-1","dir":"Articles","previous_headings":"Functions Tested > pnadc_experimental_periods()","what":"Function Signature","title":"Determination Rates Benchmark Report","text":"","code":"pnadc_experimental_periods(   crosswalk,   data = NULL,   strategy = c(\"none\", \"probabilistic\", \"upa_aggregation\", \"both\"),   upa_homogeneity_threshold = 0.80,   verbose = TRUE )"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"strategies","dir":"Articles","previous_headings":"Functions Tested > pnadc_experimental_periods()","what":"Strategies","title":"Determination Rates Benchmark Report","text":"probabilistic: undetermined cases date range spans exactly 2 periods, calculates probability-weighted best guess based date midpoint position. upa_aggregation: Aggregates constraints UPA level. UPA strictly determined households fortnight/week, propagates assignment undetermined households UPA. : Applies strategies sequentially (probabilistic first, UPA aggregation).","code":""},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"upa-homogeneity-analysis","dir":"Articles","previous_headings":"Experimental Results","what":"UPA Homogeneity Analysis","title":"Determination Rates Benchmark Report","text":"Key finding: Whenever fortnight week strictly determined household UPA, strictly determined households UPA fortnight/week.","code":""},{"path":[]},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/determination-rates-benchmark.html","id":"session-info","dir":"Articles","previous_headings":"","what":"Session Info","title":"Determination Rates Benchmark Report","text":"Report generated: 2026-01-20 08:03:49.065213 Package version: PNADCperiods 2.0.0","code":"#> R version 4.5.0 (2025-04-11 ucrt) #> Platform: x86_64-w64-mingw32/x64 #> Running under: Windows 11 x64 (build 26100) #>  #> Matrix products: default #>   LAPACK version 3.12.1 #>  #> locale: #> [1] LC_COLLATE=Portuguese_Brazil.utf8  LC_CTYPE=Portuguese_Brazil.utf8    #> [3] LC_MONETARY=Portuguese_Brazil.utf8 LC_NUMERIC=C                       #> [5] LC_TIME=Portuguese_Brazil.utf8     #>  #> time zone: America/Sao_Paulo #> tzcode source: internal #>  #> attached base packages: #> [1] stats     graphics  grDevices utils     datasets  methods   base      #>  #> loaded via a namespace (and not attached): #>  [1] digest_0.6.37     desc_1.4.3        R6_2.6.1          fastmap_1.2.0     #>  [5] xfun_0.52         cachem_1.1.0      knitr_1.50        htmltools_0.5.8.1 #>  [9] rmarkdown_2.29    lifecycle_1.0.4   cli_3.6.5         sass_0.4.10       #> [13] pkgdown_2.1.3     textshaping_1.0.1 jquerylib_0.1.4   systemfonts_1.2.3 #> [17] compiler_4.5.0    tools_4.5.0       ragg_1.4.0        evaluate_1.0.3    #> [21] bslib_0.9.0       yaml_2.3.10       jsonlite_2.0.0    rlang_1.1.6       #> [25] fs_1.6.6          htmlwidgets_1.6.4"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"Download and Prepare PNADC Data","text":"vignette provides complete, step--step workflow downloading Brazil’s quarterly PNADC (Pesquisa Nacional por Amostra de Domicilios Continua) survey data preparing mensalization. end, monthly reference months identified survey observation optionally computed monthly survey weights. workflow covers three main tasks: Downloading quarterly PNADC microdata IBGE using PNADcIBGE package Stacking multiple quarters single dataset (critical high determination rates) Applying mensalization using PNADCperiods package already PNADC data want learn package API first, see Get Started. algorithm details, see PNADCperiods Works.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"required-packages","dir":"Articles","previous_headings":"Prerequisites","what":"Required Packages","title":"Download and Prepare PNADC Data","text":"","code":"# Install packages if needed install.packages(c(\"PNADcIBGE\", \"tidyverse\", \"fst\"))  # Install mensalizePNADC from GitHub # install.packages(\"remotes\") # remotes::install_github(\"antrologos/mensalizePNADC\")  # Load packages library(PNADcIBGE) library(tidyverse) library(fst) library(PNADCperiods)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"system-requirements","dir":"Articles","previous_headings":"Prerequisites","what":"System Requirements","title":"Download and Prepare PNADC Data","text":"Disk space: ~5 GB 2020-2024 data, ~15 GB full history (2012-present) RAM: least 8 GB recommended; 16 GB comfortable processing Time: 2-3 hours downloading (depends internet speed), ~5 minutes processing Internet: Required downloading data SIDRA API access (weight calibration)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"understanding-pnadc-data","dir":"Articles","previous_headings":"","what":"Understanding PNADC Data","title":"Download and Prepare PNADC Data","text":"PNADC Brazil’s primary household survey labor market statistics, conducted IBGE. survey uses rotating panel design household interviewed five times 15 months. quarterly release contains approximately 500,000 observations. stack multiple quarters? mensalization algorithm identifies reference months tracking households across panel interviews. single quarter, determination rate ~73%. stacking multiple quarters, algorithm can leverage rotating panel structure achieve 97% determination rate. applications, recommend stacking least 2 years (8 quarters) data. detailed explanation determination rates improve stacking, including figure computed real data, see PNADCperiods Works vignette.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"step-1-set-up-your-environment","dir":"Articles","previous_headings":"","what":"Step 1: Set Up Your Environment","title":"Download and Prepare PNADC Data","text":"First, create directory store downloaded data:","code":"# Set your data directory (adjust path as needed) data_dir <- \"path/to/your/pnadc_data/\"  # Create directory if it doesn't exist dir.create(data_dir, recursive = TRUE, showWarnings = FALSE)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"step-2-define-which-quarters-to-download","dir":"Articles","previous_headings":"","what":"Step 2: Define Which Quarters to Download","title":"Download and Prepare PNADC Data","text":"Create grid year-quarter combinations download. example uses 2020-2024, provides good balance data size determination rate: creates grid 19 quarters. Adjust filter recent available quarter.","code":"# Define quarters to download (2020-2024 example) editions <- expand.grid(   year = 2020:2024,   quarter = 1:4 ) |>   # Remove quarters not yet available   filter(!(year == 2024 & quarter > 3))  # View the grid editions"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"step-3-download-the-data","dir":"Articles","previous_headings":"","what":"Step 3: Download the Data","title":"Download and Prepare PNADC Data","text":"download loop fetches quarter IBGE saves FST format fast loading later: Important: Always use labels = FALSE downloading. mensalization algorithm requires numeric codes birthday variables (V2008, V20081, V20082). Using labeled factors cause errors. loop take 2-3 hours depending internet connection. quarter approximately 300-400 MB saved FST.","code":"# Download and save each quarter for (i in 1:nrow(editions)) {   year_i <- editions$year[i]   quarter_i <- editions$quarter[i]    filename <- paste0(\"pnadc_\", year_i, \"-\", quarter_i, \"q.fst\")    cat(\"Downloading:\", year_i, \"Q\", quarter_i, \"\\n\")    # Download from IBGE   pnadc_quarter <- get_pnadc(     year = year_i,     quarter = quarter_i,     labels = FALSE,    # IMPORTANT: Use numeric codes, not labels     deflator = FALSE,     design = FALSE,     savedir = data_dir   )    # Save as FST format (fast serialization)   write_fst(pnadc_quarter, file.path(data_dir, filename))    # Clean up temporary files created by PNADcIBGE   temp_files <- list.files(data_dir,                            pattern = \"\\\\.(zip|sas|txt)$\",                            full.names = TRUE)   file.remove(temp_files)    # Free memory   rm(pnadc_quarter)   gc() }"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"step-4-stack-the-quarterly-files","dir":"Articles","previous_headings":"","what":"Step 4: Stack the Quarterly Files","title":"Download and Prepare PNADC Data","text":"Now stack quarterly files single dataset. save memory, load columns needed mensalization: Output (real PNADC 2020-2024 data):","code":"# Columns needed for mensalization cols_needed <- c(   # Time and identifiers   \"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\", \"V2003\",   # Birthday variables (for reference period algorithm)   \"V2008\", \"V20081\", \"V20082\", \"V2009\",   # Weight and stratification (for weight calibration)   \"V1028\", \"UF\", \"posest\", \"posest_sxi\" )  # Stack all quarters pnadc_stacked <- NULL  for (i in 1:nrow(editions)) {   year_i <- editions$year[i]   quarter_i <- editions$quarter[i]    filename <- paste0(\"pnadc_\", year_i, \"-\", quarter_i, \"q.fst\")   cat(\"Loading:\", filename, \"\\n\")    # Read only the columns we need (saves memory)   quarter_data <- read_fst(     file.path(data_dir, filename),     columns = cols_needed   )    pnadc_stacked <- bind_rows(pnadc_stacked, quarter_data)   rm(quarter_data)   gc() }  cat(\"Total observations:\", format(nrow(pnadc_stacked), big.mark = \",\"), \"\\n\") Loading: pnadc_2020-1q.fst Loading: pnadc_2020-2q.fst ... Loading: pnadc_2024-4q.fst Total observations: 8,868,247"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"step-5-apply-mensalization","dir":"Articles","previous_headings":"","what":"Step 5: Apply Mensalization","title":"Download and Prepare PNADC Data","text":"Now apply period identification algorithm optionally compute calibrated weights: Output (real PNADC 2020-2024 data): determination rate tells percentage observations reference period identified. 20 quarters stacked (2020-2024), achieve 94.2% months.","code":"# Step 1: Build crosswalk (identify reference periods) crosswalk <- pnadc_identify_periods(pnadc_stacked, verbose = TRUE)  # Check the determination rate cat(\"Determination rate:\",     sprintf(\"%.1f%%\", attr(crosswalk, \"determination_rates\")$month * 100), \"\\n\")  # Step 2: Apply crosswalk and calibrate weights result <- pnadc_apply_periods(   data = pnadc_stacked,   crosswalk = crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibrate = TRUE,   verbose = TRUE ) Building reference period crosswalk...   Preprocessing data (shared computation)...   Converting date bounds to period positions...   Aggregating constraints and determining periods...   Applying exception rules...   Assigning reference periods...   Building crosswalk...  Crosswalk complete:   - 3,159,265 unique household-quarter observations   - Month determination: 94.2%   - Fortnight determination: 2.8%   - Week determination: 0.9%"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"step-6-explore-the-results","dir":"Articles","previous_headings":"","what":"Step 6: Explore the Results","title":"Download and Prepare PNADC Data","text":"result data.table several new columns: Output (real PNADC 2020-2024 data): distribution approximately equal across months 1, 2, 3 (around 31-32%), 5.8% NA indeterminate cases (higher ~3% seen full 2012-2025 data boundary quarters lower determination rates). output columns include: Observations ref_month_in_quarter = NA indeterminate reference months excluded monthly analyses.","code":"# View the result structure glimpse(result)  # Summary of reference month distribution result |>   count(ref_month_in_quarter) |>   mutate(pct = n / sum(n) * 100) ref_month_in_quarter       N   pct 1:                    1 1020409  32.3 2:                    2  965613  30.6 3:                    3  990865  31.4 4:                   NA  182378   5.8"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"step-7-save-and-use-the-results","dir":"Articles","previous_headings":"","what":"Step 7: Save and Use the Results","title":"Download and Prepare PNADC Data","text":"Save mensalized data future use: use results analysis, join mensalization crosswalk full PNADC data:","code":"# Save the mensalized crosswalk write_fst(result, file.path(data_dir, \"pnadc_mensalized.fst\")) # Load a quarterly file with all variables full_data <- read_fst(file.path(data_dir, \"pnadc_2023-1q.fst\"))  # Join with mensalization results (crosswalk is at household-quarter level) analysis_data <- full_data |>   left_join(     result |> select(Ano, Trimestre, UPA, V1008, V1014,                      ref_month, ref_month_in_quarter, weight_monthly),     by = c(\"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\")   )  # Now you can aggregate by month using weight_monthly monthly_unemployment <- analysis_data |>   filter(!is.na(ref_month_in_quarter)) |>   group_by(ref_month) |>   summarize(     unemployment_rate = sum((VD4002 == 2) * weight_monthly, na.rm = TRUE) /                         sum((VD4001 == 1) * weight_monthly, na.rm = TRUE)   )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"memory-and-performance-tips","dir":"Articles","previous_headings":"","what":"Memory and Performance Tips","title":"Download and Prepare PNADC Data","text":"Working PNADC microdata can memory-intensive. tips: Selective column loading: load columns need read_fst(..., columns = ...). dramatically reduces memory usage. Process batches: large analyses, process one year time combine results. Use FST format: FST much faster CSV RDS large datasets. typical quarter loads seconds rather minutes. Clean regularly: Use rm() gc() free memory processing quarter.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"extending-to-full-history","dir":"Articles","previous_headings":"","what":"Extending to Full History","title":"Download and Prepare PNADC Data","text":"best determination rate longitudinal analysis, download available quarters: full history provides approximately 28 million observations achieves highest possible determination rate.","code":"# Download all available data (2012-present) editions_full <- expand.grid(   year = 2012:2025,   quarter = 1:4 ) |>   filter(!(year == 2025 & quarter > 3))  # Adjust for latest available  # Use the same download and stacking loops as above"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"common-issues","dir":"Articles","previous_headings":"Troubleshooting","what":"Common Issues","title":"Download and Prepare PNADC Data","text":"“Column found” errors: Ensure used labels = FALSE downloading. algorithm requires numeric codes. Download failures: IBGE servers can slow unavailable. PNADcIBGE package retry automatically, may need restart interrupted downloads. Memory errors: Try processing fewer quarters time, use machine RAM. SIDRA API errors: weight calibration requires internet access SIDRA API. fails, try later use calibrate = FALSE just reference period identification without weight calibration.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/download-and-prepare.html","id":"next-steps","dir":"Articles","previous_headings":"","what":"Next Steps","title":"Download and Prepare PNADC Data","text":"Now mensalized PNADC data, can: Follow usage patterns Get Started real data See analysis examples Applied Examples Learn algorithm PNADCperiods Works Visit package website resources Working annual PNADC data? Annual data (visit-specific microdata comprehensive income variables) requires different workflow. See Monthly Poverty Analysis Annual PNADC Data details using pnadc_apply_periods() anchor = \"year\". questions issues, please open issue GitHub.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"Get Started with PNADCperiods","text":"PNADCperiods package converts Brazil’s quarterly PNADC (Pesquisa Nacional por Amostra de Domicilios Continua) survey data sub-quarterly time series. identifies specific month, fortnight (quinzena), week survey observation refers , achieving 97% determination rate months stacked multi-quarter data. matter? PNADC quarterly statistics actually moving averages three months, obscures: true timing economic shocks (unemployment peak?) actual magnitude changes (high peak?) Turning points trends (recovery begin?) PNADCperiods recovers specific reference period, enabling true monthly (finer) labor market analysis. detailed explanation algorithm, see PNADCperiods Works vignette.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"installation","dir":"Articles","previous_headings":"","what":"Installation","title":"Get Started with PNADCperiods","text":"Dependencies: Required: data.table, checkmate weight calibration: sidrar (fetches population data IBGE’s SIDRA API)","code":"# Install from GitHub devtools::install_github(\"antrologos/mensalizePNADC\") # Load the package library(PNADCperiods) library(data.table)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"two-step-workflow","dir":"Articles","previous_headings":"","what":"Two-Step Workflow","title":"Get Started with PNADCperiods","text":"package uses two-function workflow: pnadc_identify_periods() - Builds universal crosswalk reference periods pnadc_apply_periods() - Applies crosswalk data optionally calibrates weights separation allows : - Build crosswalk stacked data - Apply quarterly annual dataset - Choose calibration approach flexibly","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"required-input-columns","dir":"Articles","previous_headings":"Your First Analysis","what":"Required Input Columns","title":"Get Started with PNADCperiods","text":"algorithm needs columns PNADC data:","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"step-1-load-your-data","dir":"Articles","previous_headings":"Your First Analysis","what":"Step 1: Load Your Data","title":"Get Started with PNADCperiods","text":"don’t stacked PNADC data yet, see Download Prepare Data complete workflow. Important: algorithm works best stacked multi-quarter data. Processing single quarter yields ~65-75% determination rate, stacking 2+ years achieves ~97%.","code":"# Load your stacked quarterly PNADC data pnadc <- fread(\"pnadc_stacked.csv\")  # Check data dimensions cat(\"Rows:\", nrow(pnadc), \"\\n\") cat(\"Quarters:\", uniqueN(pnadc[, .(Ano, Trimestre)]), \"\\n\")"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"step-2-build-the-crosswalk","dir":"Articles","previous_headings":"Your First Analysis","what":"Step 2: Build the Crosswalk","title":"Get Started with PNADCperiods","text":"Output (real PNADC 2020-2024 data):","code":"# Identify reference periods (month, fortnight, week) crosswalk <- pnadc_identify_periods(pnadc, verbose = TRUE) Building reference period crosswalk...   Preprocessing data (shared computation)...   Converting date bounds to period positions...   Aggregating constraints and determining periods...   Applying exception rules...   Assigning reference periods...   Building crosswalk...  Crosswalk complete:   - 3,159,265 unique household-quarter observations   - Month determination: 94.2%   - Fortnight determination: 2.8%   - Week determination: 0.9%"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"step-3-understand-the-crosswalk","dir":"Articles","previous_headings":"Your First Analysis","what":"Step 3: Understand the Crosswalk","title":"Get Started with PNADCperiods","text":"crosswalk contains one row per household-quarter combination (keyed Ano, Trimestre, UPA, V1008, V1014) three granularity levels: determination rates attribute returns list rates period type. See “Understanding Determination Rates” section expected values.","code":"# View the crosswalk head(crosswalk)  # Check determination rates (stored as attribute) attr(crosswalk, \"determination_rates\")"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"step-4-apply-to-your-data","dir":"Articles","previous_headings":"Your First Analysis","what":"Step 4: Apply to Your Data","title":"Get Started with PNADCperiods","text":"result includes original columns plus reference periods calibrated weights.","code":"# Apply crosswalk to a specific quarterly dataset # For quarterly data, use anchor = \"quarter\" and weight_var = \"V1028\" result <- pnadc_apply_periods(   pnadc_2023q1,   crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibrate = TRUE,   calibration_unit = \"month\" )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"understanding-the-key-arguments","dir":"Articles","previous_headings":"Your First Analysis > Step 4: Apply to Your Data","what":"Understanding the Key Arguments","title":"Get Started with PNADCperiods","text":"weight_var (required): name original PNADC weight variable use starting point calibration. weights come IBGE’s original calibration reflect survey design. package uses input sub-quarterly calibration process. anchor (required): Specifies whether data contains rotation groups quarter year. affects calibration targets computed: quarterly data calibrates within quarter, annual data calibrates within year. calibration_unit: time period granularity weight calibration. calibration? Weight calibration adjusts survey weights weighted totals match known population benchmarks (IBGE’s SIDRA API). ensures monthly estimates sum correct population totals. Without calibration, sub-quarterly estimates may properly aggregate known quarterly totals.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"building-vs--applying","dir":"Articles","previous_headings":"Understanding the Workflow","what":"Building vs. Applying","title":"Get Started with PNADCperiods","text":"Build crosswalk stacked data (2+ years recommended): Apply dataset needed:","code":"# Stack multiple years of quarterly data pnadc_stacked <- rbindlist(list(pnadc_2020, pnadc_2021, pnadc_2022, pnadc_2023))  # Build crosswalk (only needs the identification columns) crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Save for reuse saveRDS(crosswalk, \"crosswalk_2020_2023.rds\") # Load saved crosswalk crosswalk <- readRDS(\"crosswalk_2020_2023.rds\")  # Apply to quarterly data monthly_q1 <- pnadc_apply_periods(pnadc_2023q1, crosswalk,                                    weight_var = \"V1028\",                                    anchor = \"quarter\")  # Apply to annual data (with V1032 weights) monthly_annual <- pnadc_apply_periods(pnadc_annual_2023, crosswalk,                                        weight_var = \"V1032\",                                        anchor = \"year\")"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"calibration-options","dir":"Articles","previous_headings":"Understanding the Workflow","what":"Calibration Options","title":"Get Started with PNADCperiods","text":"calibration_unit parameter controls granularity weight calibration:","code":"# Monthly calibration (default) result_month <- pnadc_apply_periods(pnadc, crosswalk,                                      weight_var = \"V1028\",                                      anchor = \"quarter\",                                      calibration_unit = \"month\") # -> Adds weight_monthly column  # Fortnight calibration result_fortnight <- pnadc_apply_periods(pnadc, crosswalk,                                          weight_var = \"V1028\",                                          anchor = \"quarter\",                                          calibration_unit = \"fortnight\") # -> Adds weight_fortnight column  # Weekly calibration result_week <- pnadc_apply_periods(pnadc, crosswalk,                                     weight_var = \"V1028\",                                     anchor = \"quarter\",                                     calibration_unit = \"week\") # -> Adds weight_weekly column"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"no-calibration-option","dir":"Articles","previous_headings":"Understanding the Workflow","what":"No Calibration Option","title":"Get Started with PNADCperiods","text":"need reference periods without calibrated weights:","code":"result <- pnadc_apply_periods(pnadc, crosswalk,                                weight_var = \"V1028\",                                anchor = \"quarter\",                                calibrate = FALSE) # Result has ref_month, ref_fortnight, ref_week but no weight_monthly"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"using-for-monthly-analysis","dir":"Articles","previous_headings":"","what":"Using for Monthly Analysis","title":"Get Started with PNADCperiods","text":"Note: Use determined_month == TRUE filter observations determined months.","code":"# Compute monthly unemployment rate monthly_unemployment <- result[determined_month == TRUE, .(   unemployment_rate = sum((VD4002 == 2) * weight_monthly, na.rm = TRUE) /                       sum((VD4001 == 1) * weight_monthly, na.rm = TRUE) ), by = ref_month_yyyymm]  # Compute monthly population monthly_pop <- result[, .(   population = sum(weight_monthly, na.rm = TRUE) ), by = ref_month_yyyymm]"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"why-stack-multiple-quarters","dir":"Articles","previous_headings":"Understanding Determination Rates","what":"Why Stack Multiple Quarters?","title":"Get Started with PNADCperiods","text":"PNADC uses rotating panel household (identified UPA + V1014) interviewed 5 consecutive quarters. household always interviewed relative month position within quarter. means birthday constraints quarter can determine month quarters: Important: Strict fortnight week determination rates remain low (~8% ~2%) regardless stacking constraints aggregate across quarters—quarter’s interview timing independent sub-monthly level. month determination benefits cross-quarter aggregation rotating panel design. Experimental strategies: pnadc_experimental_periods() function can boost fortnight rates ~58% week rates ~14% using UPA aggregation. See Benchmark Report details.","code":"UPA=123456, V1014=1 appears in 5 quarters:    2023-Q1: could be Jan or Feb (ambiguous)   2023-Q2: could be Apr, May, or Jun (ambiguous)   2023-Q3: must be August (birthday constraint pins it down!)   2023-Q4: could be Oct or Nov (ambiguous)   2024-Q1: could be Feb or Mar (ambiguous)  Cross-quarter aggregation:   Since 2023-Q3 must be month 2, ALL quarters must be month 2.   Result: ALL 5 quarters are determined!"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"what-makes-observations-indeterminate","dir":"Articles","previous_headings":"Understanding Determination Rates","what":"What Makes Observations Indeterminate?","title":"Get Started with PNADCperiods","text":"3% observations remain indeterminate months : Incomplete panel coverage: First/last quarters data fewer panel visits Missing birth dates: respondents don’t report birth date (V2008=99, etc.) Small households: Fewer people means fewer birthday constraints Unit non-response: households don’t respond quarters full algorithm explanation, see PNADCperiods Works.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"experimental-strategies-for-improved-rates","dir":"Articles","previous_headings":"","what":"Experimental Strategies for Improved Rates","title":"Get Started with PNADCperiods","text":"fortnight week analysis, experimental strategies can significantly improve determination rates: Key finding: UPA homogeneity rate = 100%. household UPA strictly determined period, households determined periods UPA period. See Benchmark Report detailed methodology results.","code":"# Build standard crosswalk first crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Apply experimental UPA aggregation strategy crosswalk_exp <- pnadc_experimental_periods(   crosswalk,   pnadc_stacked,   strategy = \"upa_aggregation\"  # or \"probabilistic\" or \"both\" )  # Check improvement crosswalk_exp[, .(   fortnight_strict = mean(determined_fortnight),   fortnight_upa = mean(determined_fortnight | !is.na(ref_fortnight_upa)),   week_strict = mean(determined_week),   week_upa = mean(determined_week | !is.na(ref_week_upa)) )]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"next-steps","dir":"Articles","previous_headings":"","what":"Next Steps","title":"Get Started with PNADCperiods","text":"Download PNADC data: See Download Prepare Data complete workflow download stack quarterly microdata IBGE. Analysis examples: See Applied Examples real-world labor market analysis comparing monthly vs quarterly data, including COVID unemployment minimum wage validation. Annual PNADC data: Working annual income data? See Monthly Poverty Analysis Annual PNADC Data workflow using annual data. Benchmark report: See Determination Rates Benchmark comprehensive benchmarks complete 2012-2025 PNADC data. Function reference: Browse Reference documentation exported functions.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"main-functions","dir":"Articles","previous_headings":"Quick Reference","what":"Main Functions","title":"Get Started with PNADCperiods","text":"","code":"# Step 1: Build crosswalk from stacked data pnadc_identify_periods(   data,              # Stacked PNADC data   verbose = TRUE     # Show progress? )  # Step 2: Apply crosswalk and optionally calibrate weights pnadc_apply_periods(   data,              # PNADC data to augment   crosswalk,         # Crosswalk from pnadc_identify_periods()   weight_var,        # REQUIRED: \"V1028\" (quarterly) or \"V1032\" (annual)   anchor,            # REQUIRED: \"quarter\" or \"year\"   calibrate = TRUE,  # Calibrate weights to SIDRA population?   calibration_unit = \"month\",  # \"month\", \"fortnight\", or \"week\"   target_totals = NULL,        # Custom targets (NULL = auto-fetch)   smooth = TRUE,     # Apply smoothing to weights?   keep_all = TRUE,   # Return all rows (including undetermined)?   verbose = TRUE     # Show progress? )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/getting-started.html","id":"performance","dir":"Articles","previous_headings":"Quick Reference","what":"Performance","title":"Get Started with PNADCperiods","text":"See Benchmark Report comprehensive benchmarks 2012-2025 data.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"How PNADCperiods Works","text":"vignette explains PNADCperiods algorithm works: methodology behind converting Brazil’s quarterly PNADC survey sub-quarterly time series calibrated weights. practical usage examples, see Get Started vignette.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"what-this-package-does","dir":"Articles","previous_headings":"Introduction","what":"What This Package Does","title":"How PNADCperiods Works","text":"PNADCperiods package transforms Brazil’s quarterly PNADC (Pesquisa Nacional por Amostra de Domicilios Continua) survey data finer-grained time series labor market, demographic, socioeconomic analysis. addresses fundamental challenge: PNADC reports quarterly aggregates, policy analysis often requires understanding happened within specific months, fortnights, weeks. Package capabilities: Monthly (~97% determination rate) - suitable analyses Fortnight (7.64% strict, 60% experimental strategies) - short-term analysis Weekly (1.54% strict, 15% experimental strategies) - high-frequency monitoring Calibrates official monthly population totals (SIDRA API) Adaptive hierarchical raking (4/2/1 cell levels depending sample size) Adaptive smoothing remove quarterly artifacts (3/7/none periods) Quarterly data (V1028 weights) - labor market variables, rotation groups Annual data (V1032 weights) - comprehensive income (VD5008), single visit","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"why-this-matters","dir":"Articles","previous_headings":"Introduction","what":"Why This Matters","title":"How PNADCperiods Works","text":"Policy questions often require sub-quarterly precision raw PNADC data provide: exactly unemployment spike COVID-19? (March 2020 vs. January 2020) quickly labor markets respond minimum wage changes? (month--month transitions) poverty December 2023 specifically? (just Q4 2023 average) algorithm exploits PNADC’s rotating panel design birthday information recover temporal precision. identifying household actually interviewed within quarter, can construct monthly time series 97% original sample retained.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"what-youll-learn","dir":"Articles","previous_headings":"Introduction","what":"What You’ll Learn","title":"How PNADCperiods Works","text":"vignette walks complete methodology: stacked multi-quarter data matters - cross-quarter aggregation improves determination ~70% ~97% Valid interview date calculation (IBGE timing rules) Birthday constraints narrow date ranges UPA-panel aggregation (households interviewed together) Cross-quarter constraint propagation Dynamic exception detection edge cases Probabilistic assignment narrow date ranges UPA aggregation leveraging 100% homogeneity finding Quarterly data: redistribute quarterly totals across 3 months Annual data: redistribute yearly totals across 12 months Fortnight/weekly data: simplified raking smaller samples Performance characteristics - Determination rates, processing speed, data quality Best practices - Input data requirements, handling indeterminate cases, validation","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"prerequisites","dir":"Articles","previous_headings":"Introduction","what":"Prerequisites","title":"How PNADCperiods Works","text":"vignette assumes ’re already familiar basic PNADC concepts (UPA, rotation groups, survey weights) seen package action via Get Started vignette. focus understanding methodology rather use functions. ’re looking applied examples real policy questions, see Applied Examples vignette. poverty analysis using annual PNADC data, see Annual Poverty Analysis.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"required-input-variables","dir":"Articles","previous_headings":"Quick Reference","what":"Required Input Variables","title":"How PNADCperiods Works","text":"Minimum (reference month identification): Additional (calibrate = TRUE pnadc_apply_periods()):","code":""},{"path":[]},{"path":[]},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"experimental-strategies-summary","dir":"Articles","previous_headings":"Quick Reference","what":"Experimental Strategies Summary","title":"How PNADCperiods Works","text":"package includes experimental strategies improve fortnight week determination sensitivity analysis. accessed via pnadc_experimental_periods(): See Experimental Strategies section details.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"why-stacked-data-matters","dir":"Articles","previous_headings":"","what":"Why Stacked Data Matters","title":"How PNADCperiods Works","text":"algorithm achieves 97% determination rate processing stacked multi-quarter data. process quarters individually, ’ll get ~73% determination. figure shows determination rate improves quarters stacked, computed real PNADC data (2012-2025): Empirical determination rates number quarters stacked (real PNADC 2012-2025 data): Note rate peaks around 32 quarters stabilizes. boundary quarters (first 4 last 4 series) inherently lower rates due incomplete panel coverage. stacking help? PNADC uses rotating panel household (UPA + V1014) interviewed 5 consecutive quarters. Crucially, household always interviewed relative month position (always month 1, always month 2, always month 3). means birthday constraints quarter can determine month quarters: Recommended: Stack least 2 years (8 quarters) data calling pnadc_identify_periods() achieve >96% determination.","code":"UPA=123456, V1014=1 appears in 5 quarters:    2023-Q1: month_min=1, month_max=2 (ambiguous: Jan or Feb)   2023-Q2: month_min=1, month_max=3 (ambiguous: Apr, May, or Jun)   2023-Q3: month_min=2, month_max=2 (DETERMINED: August)  ← Birthday constraint!   2023-Q4: month_min=1, month_max=2 (ambiguous: Oct or Nov)   2024-Q1: month_min=2, month_max=3 (ambiguous: Feb or Mar)  Cross-quarter aggregation:   upa_month_min = max(1, 1, 2, 1, 2) = 2   upa_month_max = min(2, 3, 2, 2, 3) = 2  Result: ALL 5 quarters → ref_month_in_quarter = 2"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"the-algorithm-explained","dir":"Articles","previous_headings":"","what":"The Algorithm Explained","title":"How PNADCperiods Works","text":"section details package identifies reference periods (months, fortnights, weeks) observation. algorithm shares initial computation steps across three period types, diverges based period’s aggregation scope.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"overview-diagram","dir":"Articles","previous_headings":"The Algorithm Explained","what":"Overview Diagram","title":"How PNADCperiods Works","text":"reference period identification follows pipeline shared initial steps period-specific aggregation: Key insight: critical difference months benefit cross-quarter aggregation (Step 5 month pipeline), fortnights weeks aggregate constraints across quarters. monthly determination rate (~97%) far exceeds fortnights (~3%) weeks (~1%).","code":"┌─────────────────────────────────────────────────────────────────────────────┐ │                    REFERENCE PERIOD IDENTIFICATION PIPELINE                 │ │                       (Months, Fortnights, and Weeks)                       │ └─────────────────────────────────────────────────────────────────────────────┘  INPUTS (per observation): ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │     Year     │  │    Quarter   │  │    Birthday  │  │      Age     │ │    (Ano)     │  │  (Trimestre) │  │  (V2008/1/2) │  │    (V2009)   │ └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘         │                │                  │                 │         └────────────────┴──────────────────┴─────────────────┘                                     │                                     ▼ ┌─────────────────────────────────────────────────────────────────────────────┐ │                        SHARED COMPUTATION (All Periods)                     │ ├─────────────────────────────────────────────────────────────────────────────┤ │                                                                             │ │  STEP 1: Calculate Valid Interview Saturdays (IBGE Rules)                   │ │          Output: date_min, date_max for each quarter                        │ │                                                                             │ │  STEP 2: Apply Birthday Constraints                                         │ │          Narrow date window using age vs birth year comparison              │ │                                                                             │ │  STEP 3: Convert Dates to Period Positions                                  │ │          Compute: month_min/max, fortnight_min/max, week_min/max            │ │                                                                             │ └─────────────────────────────────────────────────────────────────────────────┘                                     │             ┌───────────────────────┼───────────────────────┐             │                       │                       │             ▼                       ▼                       ▼ ┌───────────────────────┐ ┌───────────────────────┐ ┌───────────────────────┐ │   MONTH PIPELINE      │ │ FORTNIGHT PIPELINE    │ │   WEEK PIPELINE       │ │   (Steps 4-7)         │ │ (Steps 4-5)           │ │   (Steps 4-5)         │ ├───────────────────────┤ ├───────────────────────┤ ├───────────────────────┤ │                       │ │                       │ │                       │ │ Step 4: Aggregate at  │ │ Step 4: Aggregate at  │ │ Step 4: Aggregate at  │ │   (UPA, V1014) level  │ │   (Ano, Trim, UPA,    │ │   (Ano, Trim, UPA,    │ │                       │ │    V1008) level       │ │    V1008) level       │ │ Step 5: CROSS-QUARTER │ │                       │ │                       │ │   aggregation across  │ │ NO cross-quarter      │ │ NO cross-quarter      │ │   ALL quarters        │ │ aggregation possible  │ │ aggregation possible  │ │                       │ │                       │ │                       │ │ Step 6: Dynamic       │ │ Step 5: Final         │ │ Step 5: Final         │ │   exception detection │ │   assignment          │ │   assignment          │ │                       │ │                       │ │                       │ │ Step 7: Final         │ │                       │ │                       │ │   assignment          │ │                       │ │                       │ │                       │ │                       │ │                       │ └───────────────────────┘ └───────────────────────┘ └───────────────────────┘             │                       │                       │             ▼                       ▼                       ▼ ┌───────────────────────┐ ┌───────────────────────┐ ┌───────────────────────┐ │ Determination: ~97%   │ │ Determination: ~3%    │ │ Determination: ~1%    │ │                       │ │                       │ │                       │ │ OUTPUT:               │ │ OUTPUT:               │ │ OUTPUT:               │ │ - ref_month (Date)    │ │ - ref_fortnight       │ │ - ref_week (Date)     │ │ - ref_month_in_qtr    │ │ - ref_fortnight_in_q  │ │ - ref_week_in_qtr     │ │ - ref_month_yyyymm    │ │ - ref_fortnight_yyyyff│ │ - ref_week_yyyyww     │ └───────────────────────┘ └───────────────────────┘ └───────────────────────┘"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"shared-computation-steps-1-3","dir":"Articles","previous_headings":"The Algorithm Explained","what":"Shared Computation (Steps 1-3)","title":"How PNADCperiods Works","text":"following three steps computed shared across period types (months, fortnights, weeks).","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"step-1-valid-interview-saturdays-ibge-rules","dir":"Articles","previous_headings":"The Algorithm Explained > Shared Computation (Steps 1-3)","what":"Step 1: Valid Interview Saturdays (IBGE Rules)","title":"How PNADCperiods Works","text":"previously stated, IBGE defines reference week belongs month least 4 days within month. Since reference weeks end Saturdays, look Saturdays month determine valid interview dates. calculate first valid Saturday: Example Q1 2023: valid Saturday calculation defines possible interview date range quarter: - date_min = First valid Saturday Month 1 - date_max = First valid Saturday Month 3 + 21 days","code":"first_saturday_day = day of the first Saturday of the month if first_saturday_day >= 4:     use this Saturday (it has enough days in the month) else:     use the second Saturday (first_saturday_day + 7) JANUARY 2023:   Sun  Mon  Tue  Wed  Thu  Fri  SAT    1    2    3    4    5    6   [7]  <- First Saturday is day 7                                      7 >= 4? YES -> Valid! (7 days in January)  FEBRUARY 2023:   Wed  Thu  Fri  SAT  ...    1    2    3   [4]              <- First Saturday is day 4                                   4 >= 4? YES -> Valid! (4 days in February)  APRIL 2023:   SAT  Sun  Mon  Tue  ...   [1]   2    3    4              <- First Saturday is day 1                                   1 >= 4? NO -> Skip to second Saturday!   Fri  SAT  Sun  ...    7   [8]   9                   <- Use day 8 instead"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"step-2-birthday-constraints","dir":"Articles","previous_headings":"The Algorithm Explained","what":"Step 2: Birthday Constraints","title":"How PNADCperiods Works","text":"IBGE calculates age precisely using precise birthdate interview reference date (persons inform birthdates). words, IBGE calculates age Saturday ends reference week interview. , comparing calculated age birth year, can determine interview (.e. reference date) happened person’s birthday year. allows us narrow possible interview date window. Example: Interview birthday Example: Interview birthday Unknown birthdays: V2008=99, V20081=99, V20082=9999, person’s birthday constrain date. However, may still determined aggregation UPA-Panel level (Step 4) cross-quarter aggregation (Step 5).","code":"visit_before_birthday = (Survey_Year - Birth_Year) - Calculated_Age  If = 0: Interview was AFTER birthday (person already celebrated this year) If = 1: Interview was BEFORE birthday (birthday hasn't happened yet) Person: Born March 15, 1990 Survey Year and quarter: 2023 Q1 Calculated Age: 33  Check age: 2023 - 1990 = 33            33 - 33 = 0  -> Interview was AFTER March 15, 2023  Check first Saturday on or after birthday:            first_Saturday_on_or_after(March 15) = March 18, 2023  New date constraints:              date_min = max(date_min, first_Saturday_on_or_after(March 15))                                     date_min = max(Jan 7, March 18) = March 18  This person can only have been interviewed in MARCH (Month 3 of Q1). Person: Born February 17, 1990 Survey Year and quarter: 2023 Q1 Calculated Age: 32  Check age: 2023 - 1990 = 33            33 - 32 = 1  -> Interview was BEFORE February 17, 2023  Check first Saturday on or after birthday:            first_Saturday_on_or_after(February 17) = February 18, 2023 (Sat)            Saturday_before = February 18 - 7 = February 11, 2023  Constraint: date_max = min(date_max, Saturday_before(birthday))             date_max = min(March 25, February 11) = February 11  This person can only have been interviewed in JANUARY or early FEBRUARY."},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"step-3-date-to-period-position","dir":"Articles","previous_headings":"The Algorithm Explained","what":"Step 3: Date to Period Position","title":"How PNADCperiods Works","text":"Transform date window [date_min, date_max] period positions. step works similarly three granularities: Month positions (1, 2, 3): Boundary handling: Interviews days 1-3 month typically belong reference week started previous month. Fortnight positions (1-6): determining month position, fortnights calculated : Week positions (ISO week number): Weeks use ISO 8601 standard consistent numbering: ISO weeks: - Start Monday - Week 1 first week containing least 4 days new year - Can span year boundaries (e.g., December 30 might week 1 next year) resulting period positions feed Step 4 (aggregation), differs period type. See separate pipelines months, fortnights, weeks.","code":"For date_min: if day <= 3 AND not in first month of quarter:               subtract 1 from month position  For date_max: if day <= 3:               use the month of (date - 3 days) instead fortnight_pos = (month_pos - 1) * 2 + half_of_month   where half_of_month = 1 if day <= 15, else 2 week_yyyyww = YYYY * 100 + ISO_week_number"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"month-identification-pipeline-steps-4-7","dir":"Articles","previous_headings":"The Algorithm Explained","what":"Month Identification Pipeline (Steps 4-7)","title":"How PNADCperiods Works","text":"month identification pipeline uses cross-quarter aggregation achieve ~97% determination. powerful identification UPA-V1014 panel group always interviewed relative month across quarterly visits.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"step-4-upa-panel-aggregation","dir":"Articles","previous_headings":"The Algorithm Explained > Month Identification Pipeline (Steps 4-7)","what":"Step 4: UPA-Panel Aggregation","title":"How PNADCperiods Works","text":"people UPA + V1014 interviewed together reference month. Take intersection: Example: Note: Fortnights weeks use different aggregation key — see Fortnight Week Identification section .","code":"upa_month_min = MAX of all individual month_min_pos upa_month_max = MIN of all individual month_max_pos A household located at UPA=123456 and member of the Panel group V1014=1 has 3 members:  Person A: month_min=1, month_max=2 (could be Jan or Feb) Person B: month_min=1, month_max=3 (could be Jan, Feb, or Mar) Person C: month_min=2, month_max=3 (could be Feb or Mar)  Aggregation:   upa_month_min = max(1, 1, 2) = 2   upa_month_max = min(2, 3, 3) = 2  Result: min=2, max=2 -> Reference month is FEBRUARY!  Visual:               Jan    Feb    Mar Person A:     [=========] Person B:     [============] Person C:            [========] Intersection:        [==]      <- Only February satisfies all"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"step-5-cross-quarter-aggregation","dir":"Articles","previous_headings":"The Algorithm Explained > Month Identification Pipeline (Steps 4-7)","what":"Step 5: Cross-Quarter Aggregation","title":"How PNADCperiods Works","text":"Since relative month position constant across quarters, constraints quarter apply quarters: processing stacked data improves determination ~70% ~97%. Critical distinction: cross-quarter aggregation makes monthly determination effective (~97%), applied fortnights weeks. Even though household always interviewed relative month (e.g., always month 2), specific fortnight week within month varies quarter. Therefore, fortnight week constraints must evaluated within quarter independently, resulting much lower determination rates (~2-5% fortnights, ~1-2% weeks).","code":"For each (UPA, V1014) group across ALL quarters:   upa_month_min = MAX of all month_min_pos from all quarters   upa_month_max = MIN of all month_max_pos from all quarters"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"step-6-dynamic-exception-detection","dir":"Articles","previous_headings":"The Algorithm Explained > Month Identification Pipeline (Steps 4-7)","what":"Step 6: Dynamic Exception Detection","title":"How PNADCperiods Works","text":"quarters, standard rule (first reference week ≥4 days) may produce impossible results. instance, upa_month_min > upa_month_max. Quarters happens flagged needing exception. implement alternative rule: first reference week ≥3 days dynamic detection works: algorithm calculates month positions using rules simultaneously: Exceptions detected applied month level within quarter. example, 2016q3, month 3 (September) needs exception – months 1 2 use standard rule. ’s : standard rule, September’s first valid Saturday September 10th (since September 3rd 3 days month). UPA-V1014 groups constraints require September 3rd valid. exception rule (≥3 days instead ≥4) makes September 3rd valid groups, assigning week August 28th-September 3rd September’s reference month rather August’s. algorithm proceeds follows: Exception quarters detected automatically. Examples found 2012-2025 data: 2016q3, 2016q4, 2017q2, 2022q3, 2023q2, 2024q1. algorithm detect new exceptions future data.","code":"For each UPA-V1014:   1. Calculate upa_month_min/max using STANDARD rules   2. Also calculate alt_upa_month_min/max using ALTERNATIVE rules   3. Check if exception is needed. ALL conditions must be true:      a) Standard produces impossible result: upa_month_min > upa_month_max      b) Alternative would work: alt_upa_month_min <= alt_upa_month_max      c) Individual's constraint is the binding one that could be relaxed         (the individual's bound equals the UPA bound that would change)   4. Determine WHICH month within the quarter needs the exception:      - requires_exc_m1: Exception needed for month 1      - requires_exc_m2: Exception needed for month 2      - requires_exc_m3: Exception needed for month 3   5. PROPAGATE: If ANY UPA in the quarter needs exception for a month,      apply that exception to ALL observations in that quarter"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"step-7-final-assignment","dir":"Articles","previous_headings":"The Algorithm Explained > Month Identification Pipeline (Steps 4-7)","what":"Step 7: Final Assignment","title":"How PNADCperiods Works","text":"applying exceptions: upa_month_min == upa_month_max, reference month determined. Otherwise, remains NA. makes observations indeterminate (~3%)? occurs available birth date information (UPA, V1014) group insufficient narrow possibilities single month. Several factors contribute: Incomplete panel coverage: UPAs may fewer expected 5 visits dataset. first last 4 quarters consecutive series naturally UPAs incomplete visit histories due rotating panel design. Unit non-response: survey targets 14 households per UPA quarter, non-response reduces . Fewer responding households means fewer birthday constraints narrow month. Small household sizes: Households fewer members provide fewer birthday constraints. Missing birth dates: respondents report date birth. Higher item non-response reduces available constraints. Uninformative birthdays: reported birth dates don’t help distinguish months (e.g., birthdays outside quarter’s interview window). Indeterminate observations removed monthly analysis (keep_all = FALSE) assigned month = NA weight_monthly = NA (keep_all = TRUE).","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"fortnight-and-week-identification-pipeline-steps-4-5","dir":"Articles","previous_headings":"The Algorithm Explained","what":"Fortnight and Week Identification Pipeline (Steps 4-5)","title":"How PNADCperiods Works","text":"package also identifies fortnights (quinzenas) weeks within quarter. use shared computation (Steps 1-3) months, critical difference: aggregate across quarters, resulting much lower determination rates.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"why-lower-determination-rates","dir":"Articles","previous_headings":"The Algorithm Explained > Fortnight and Week Identification Pipeline (Steps 4-5)","what":"Why Lower Determination Rates?","title":"How PNADCperiods Works","text":"key difference: months benefit cross-quarter aggregation (Step 5), fortnights weeks . can’t fortnights/weeks aggregate across quarters? household’s relative month position constant: interviewed month 2 Q1, ’re always interviewed month 2 every quarter. specific fortnight week varies: even always month 2, might fortnight 3 Q1 fortnight 4 Q2. Therefore, fortnight/week constraints different quarters combined.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"fortnight-identification-algorithm","dir":"Articles","previous_headings":"The Algorithm Explained > Fortnight and Week Identification Pipeline (Steps 4-5)","what":"Fortnight Identification Algorithm","title":"How PNADCperiods Works","text":"Fortnights divide quarter 6 periods (2 per month): algorithm follows Steps 1-4 months, : Step 3 (Fortnight version): Convert dates fortnight positions (1-6) Step 4 (Fortnight version): Aggregate household level within quarter Step 5: Fortnights use cross-quarter aggregation. Output variables:","code":"Quarter structure: Month 1: Fortnight 1, Fortnight 2 Month 2: Fortnight 3, Fortnight 4 Month 3: Fortnight 5, Fortnight 6 For each date in the quarter:   1. Determine which month (1, 2, or 3)   2. Determine if first or second half of month:      - Days 1-15: First fortnight      - Days 16+: Second fortnight   3. Calculate position: (month - 1) * 2 + half For each (Ano, Trimestre, UPA, V1008) group:   hh_fortnight_min = max(all individual fortnight_min_pos)   hh_fortnight_max = min(all individual fortnight_max_pos)  If hh_fortnight_min == hh_fortnight_max -> DETERMINED"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"week-identification-algorithm","dir":"Articles","previous_headings":"The Algorithm Explained > Fortnight and Week Identification Pipeline (Steps 4-5)","what":"Week Identification Algorithm","title":"How PNADCperiods Works","text":"Weeks divide quarter approximately 13 periods: algorithm uses ISO week numbers consistency: Step 3 (Week version): Convert dates ISO week numbers Step 4 (Week version): Aggregate household level within quarter Output variables:","code":"Quarter structure (example): Month 1: Weeks 1-4 (or 5, depending on calendar) Month 2: Weeks 5-8 (or 4-8) Month 3: Weeks 9-13 (or 8-13) For each date:   ref_week_yyyyww = ISO week number (YYYYWW format)  ISO weeks start on Monday and can span year boundaries. For example, week 1 of 2024 might include days from late December 2023. For each (Ano, Trimestre, UPA, V1008) group:   hh_week_min = max(all individual week_min_yyyyww)   hh_week_max = min(all individual week_max_yyyyww)  If hh_week_min == hh_week_max -> DETERMINED"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"practical-implications","dir":"Articles","previous_headings":"The Algorithm Explained > Fortnight and Week Identification Pipeline (Steps 4-5)","what":"Practical Implications","title":"How PNADCperiods Works","text":"use granularity: Important considerations: Sample size decreases rapidly: strict determination , fortnight (~7.64%) week (~1.54%) provide small samples. However, experimental strategies can significantly increase rates. Experimental strategies available: pnadc_experimental_periods() function provides probabilistic assignment UPA aggregation strategies can increase fortnight determination ~60% week ~15%. See Experimental Strategies section. Weight calibration adapts: package automatically uses simplified raking (fewer cell levels) fortnights/weeks handle smaller samples.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"usage-example","dir":"Articles","previous_headings":"The Algorithm Explained > Fortnight and Week Identification Pipeline (Steps 4-5)","what":"Usage Example","title":"How PNADCperiods Works","text":"Output (real PNADC 2012-2025 data):","code":"# Build crosswalk with all period types crosswalk <- pnadc_identify_periods(pnadc_stacked, verbose = TRUE)  # Check determination rates crosswalk[, .(   n_obs = .N,   det_month = mean(determined_month, na.rm = TRUE),   det_fortnight = mean(determined_fortnight, na.rm = TRUE),   det_week = mean(determined_week, na.rm = TRUE) ), by = .(Ano, Trimestre)]  # For fortnight analysis, filter to determined observations fortnight_data <- crosswalk[determined_fortnight == TRUE] nrow(fortnight_data) / nrow(crosswalk)  # ~3%  # Apply crosswalk with fortnight calibration result <- pnadc_apply_periods(   pnadc_data, crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibration_unit = \"fortnight\" ) Building reference period crosswalk...   Preprocessing data (shared computation)...   Converting date bounds to period positions...   Aggregating constraints and determining periods...   Applying exception rules...   Assigning reference periods...   Building crosswalk...  Crosswalk complete:   - 9,598,723 unique household-quarter observations   - Month determination: 96.69%   - Fortnight determination: 7.64%   - Week determination: 1.54%  # Sample determination rates by quarter (2023):      Ano Trimestre   n_obs det_month det_fortnight det_week    <int>     <int>   <int>     <num>         <num>    <num> 1:  2023         1  169879     0.954         0.071    0.017 2:  2023         2  171776     0.960         0.071    0.006 3:  2023         3  175418     0.965         0.071    0.017 4:  2023         4  173676     0.968         0.071    0.017"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"experimental-strategies","dir":"Articles","previous_headings":"","what":"Experimental Strategies","title":"How PNADCperiods Works","text":"standard algorithm produces strict (definitive) determination rates ~7.64% fortnights ~1.54% weeks. applications requiring larger sub-monthly samples, package provides experimental strategies can increase rates substantially. Important: Experimental strategies produce “likely” assignments based additional assumptions. intended sensitivity analysis, robustness checks, research purposes—replacing strict determination rigorous analysis.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"overview-of-experimental-strategies","dir":"Articles","previous_headings":"Experimental Strategies","what":"Overview of Experimental Strategies","title":"How PNADCperiods Works","text":"pnadc_experimental_periods() function provides two strategies can used individually combined:","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"probabilistic-strategy","dir":"Articles","previous_headings":"Experimental Strategies","what":"Probabilistic Strategy","title":"How PNADCperiods Works","text":"interview date range spans exactly 2 fortnights 2 weeks, probabilistic strategy calculates period likely based position date range boundaries. works: Example: Confidence Score Distribution (2012-2025 benchmark): Mean confidence: 0.576 Median confidence: 0.548 Range: [0.516, 0.950] weeks, probabilistic assignments confidence ≈ 0.571 (fixed 2-week range). Interpretation: probabilistic assignments relatively low confidence (55-60%), meaning ’re slightly better coin flip. Use assignments caution consider filtering higher confidence values (≥0.7) reliable analysis. Code example:","code":"For each undetermined observation with date range [date_min, date_max]:   1. Check if range spans exactly 2 periods   2. Calculate the midpoint: date_midpoint = (date_min + date_max) / 2   3. Assign the period containing the midpoint   4. Calculate confidence: based on distance from period boundary      - Closer to boundary = lower confidence (~0.5)      - Closer to edges = higher confidence (up to ~0.95) Person with date range: March 10 - March 20 (within Q1 2023) Fortnight boundary: March 15/16  Days in fortnight 5 (Mar 1-15):  10, 11, 12, 13, 14, 15 = 6 days Days in fortnight 6 (Mar 16-31): 16, 17, 18, 19, 20     = 5 days  Date midpoint: March 15 → Falls in fortnight 5 Confidence: 6/11 ≈ 0.55 (55% probability of fortnight 5)  Result: ref_fortnight_likely = 5, ref_fortnight_confidence = 0.55 # Build standard crosswalk crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Apply probabilistic strategy crosswalk_prob <- pnadc_experimental_periods(   crosswalk,   data = pnadc_stacked,  # Required for date bounds   strategy = \"probabilistic\",   verbose = TRUE )  # Check results crosswalk_prob[, .(   strict = sum(determined_fortnight),   likely = sum(!is.na(ref_fortnight_likely)),   high_conf = sum(ref_fortnight_confidence >= 0.7, na.rm = TRUE) )]  # Filter to high-confidence assignments high_conf_fortnights <- crosswalk_prob[   determined_fortnight | ref_fortnight_confidence >= 0.7 ]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"upa-aggregation-strategy","dir":"Articles","previous_headings":"Experimental Strategies","what":"UPA Aggregation Strategy","title":"How PNADCperiods Works","text":"UPA aggregation strategy exploits remarkable empirical finding: 100% UPA homogeneity fortnights weeks. Key Finding: 100% UPA Homogeneity Across 55 quarters PNADC data (2012-2025, 9.6 million household-quarter observations), found whenever fortnight week strictly determined household UPA, strictly determined households UPA fortnight/week. 100% homogeneity rate provides strong empirical support UPA-level aggregation. works: IBGE’s interview scheduling creates natural clustering UPA level. IBGE officially state entire UPAs interviewed day, empirical evidence strongly suggests interviews within UPA temporally clustered within narrow windows. works: UPA Aggregation Concept: Results (2012-2025 benchmark): UPA aggregation strategy provides 7.5x improvement fortnights 9.3x improvement weeks. Code example:","code":"For each (Ano, Trimestre, UPA):   1. Find all households with strictly determined fortnight/week   2. Check if all determined households have the SAME period      (UPA homogeneity check - threshold default: 80%)   3. If homogeneous: propagate that period to ALL households in the UPA      (including those without strict determination) ┌─────────────────────────────────────────────────────────────────────┐ │                    UPA = 123456 (Q1 2023)                           │ ├─────────────────────────────────────────────────────────────────────┤ │                                                                     │ │  Household A: fortnight = 3 (DETERMINED via birthday constraints)   │ │  Household B: fortnight = 3 (DETERMINED via birthday constraints)   │ │  Household C: fortnight = NA (undetermined)                         │ │  Household D: fortnight = NA (undetermined)                         │ │  Household E: fortnight = NA (undetermined)                         │ │                                                                     │ │  UPA Homogeneity Check:                                             │ │    - Determined households: A, B                                    │ │    - All have fortnight = 3? YES (100% homogeneous)                 │ │                                                                     │ │  Result: Propagate fortnight = 3 to C, D, E                         │ │    → ref_fortnight_upa = 3 for all 5 households                     │ │                                                                     │ └─────────────────────────────────────────────────────────────────────┘ # Build standard crosswalk crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Apply UPA aggregation strategy crosswalk_upa <- pnadc_experimental_periods(   crosswalk,   strategy = \"upa_aggregation\",   upa_homogeneity_threshold = 0.80,  # Default: apply if homogeneity >= 80%   verbose = TRUE )  # Check UPA homogeneity and results # Output will show: #   UPA homogeneity (fortnight): 100.0% #   UPA homogeneity (week): 100.0% #   UPA-aggregated fortnight: 4,803,577 additional assignments (54.2% of undetermined)  # Use UPA-aggregated periods crosswalk_upa[, .(   strict_only = sum(determined_fortnight),   with_upa = sum(determined_fortnight | !is.na(ref_fortnight_upa)),   improvement = sum(!is.na(ref_fortnight_upa) & !determined_fortnight) )]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"combined-strategy-both","dir":"Articles","previous_headings":"Experimental Strategies","what":"Combined Strategy (“both”)","title":"How PNADCperiods Works","text":"maximum coverage, combine strategies. probabilistic strategy applied first, UPA aggregation: Combined Results (benchmark):","code":"# Apply both strategies crosswalk_both <- pnadc_experimental_periods(   crosswalk,   data = pnadc_stacked,   strategy = \"both\",   upa_homogeneity_threshold = 0.80,   verbose = TRUE )  # Combined results crosswalk_both[, .(   strict = sum(determined_fortnight),   probabilistic = sum(!is.na(ref_fortnight_likely) & !determined_fortnight),   upa_aggregated = sum(!is.na(ref_fortnight_upa) & !determined_fortnight),   total_coverage = mean(determined_fortnight |                         !is.na(ref_fortnight_likely) |                         !is.na(ref_fortnight_upa)) )]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"when-to-use-each-strategy","dir":"Articles","previous_headings":"Experimental Strategies","what":"When to Use Each Strategy","title":"How PNADCperiods Works","text":"Decision flowchart:","code":"Need fortnight/week analysis? ├── Strict sample (~7.64% / ~1.54%) sufficient? │   └── YES → Use pnadc_identify_periods() only │   └── NO  → Continue │ ├── Need definitive determinations only? │   └── YES → Use strict (accept smaller sample) │   └── NO  → Continue │ ├── Confidence scores important? │   └── YES → Use probabilistic strategy │            Filter to confidence >= 0.7 for reliability │   └── NO  → Continue │ └── Maximum coverage needed?     └── YES → Use UPA aggregation or both               (leverages 100% UPA homogeneity)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"caveats-and-limitations","dir":"Articles","previous_headings":"Experimental Strategies","what":"Caveats and Limitations","title":"How PNADCperiods Works","text":"Probabilistic assignments uncertain: Mean confidence ~0.58, meaning many assignments marginally better random. Consider filtering confidence ≥ 0.7 analysis. UPA aggregation assumes scheduling patterns persist: 100% homogeneity finding based 2012-2025 data. IBGE changes interview scheduling, assumption may weaken. Neither replaces strict determination: rigorous causal analysis official statistics, strict determination preferred despite smaller sample sizes. Combine caution: using “” strategies, aware different households may periods assigned via different mechanisms (strict, probabilistic, UPA). Validate specific use case: Run sensitivity analysis comparing strict-results experimental results ensure conclusions robust. Output columns pnadc_experimental_periods():","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"weight-calibration","dir":"Articles","previous_headings":"","what":"Weight Calibration","title":"How PNADCperiods Works","text":"sub-quarterly aggregate estimates, need appropriately calibrated survey weights. package supports calibration three period types: monthly, fortnightly, weekly.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"how-calibration-works-general-principles","dir":"Articles","previous_headings":"Weight Calibration","what":"How Calibration Works (General Principles)","title":"How PNADCperiods Works","text":"calibrate = TRUE pnadc_apply_periods(), package: 1. Fetches monthly population SIDRA API (table 6022) SIDRA provides moving-quarter population estimates, exact monthly values: package shifts values align center month. Boundary months (Jan 2012, latest month) extrapolated via quadratic regression. 2. Applies hierarchical rake weighting across nested calibration cells: number cell levels used depends calibration unit (see “Fortnight Weekly Calibration” ). level, weights adjusted period totals match anchor totals proportionally. 3. Calibrates monthly population totals Final scaling ensures monthly weighted totals match SIDRA population (~206 million average).","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"monthly-calibration","dir":"Articles","previous_headings":"Weight Calibration","what":"Monthly Calibration","title":"How PNADCperiods Works","text":"Monthly calibration uses full 4-level hierarchical raking high determination rate (~97%) provides sufficient sample size cell.","code":"# Apply crosswalk and calibrate monthly weights result <- pnadc_apply_periods(pnadc_stacked, crosswalk,                                weight_var = \"V1028\",                                anchor = \"quarter\",                                calibration_unit = \"month\",  # default                                calibrate = TRUE)  # Use weight_monthly for monthly estimates monthly_pop <- result[, .(   population = sum(weight_monthly, na.rm = TRUE) ), by = ref_month_yyyymm]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"fortnight-and-week-calibration","dir":"Articles","previous_headings":"Weight Calibration","what":"Fortnight and Week Calibration","title":"How PNADCperiods Works","text":"package also supports calibrating weights fortnight weekly analysis using calibration_unit = \"fortnight\" calibration_unit = \"week\". Population Targets time periods calibrated full Brazilian population SIDRA: means sum weight_fortnight given fortnight, weight_weekly given week, get total Brazilian population period (fraction ). Simplified Hierarchical Raking fortnights weeks much lower determination rates (~2-5% ~1-2% respectively), hierarchical raking automatically simplified avoid sparse cell issues: algorithm also checks minimum cell sizes (default: 10 observations) skips raking levels cells become sparse. Smoothing Behavior Smoothing remove quarterly artifacts also adapted: Weekly data skips smoothing entirely small sample sizes make cell-level smoothing unstable. Usage Example","code":"# Fortnight calibration result <- pnadc_apply_periods(pnadc_data, crosswalk,                                weight_var = \"V1028\",                                anchor = \"quarter\",                                calibration_unit = \"fortnight\")  # Weekly calibration result <- pnadc_apply_periods(pnadc_data, crosswalk,                                weight_var = \"V1028\",                                anchor = \"quarter\",                                calibration_unit = \"week\")"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"handling-indeterminate-observations","dir":"Articles","previous_headings":"Weight Calibration","what":"Handling Indeterminate Observations","title":"How PNADCperiods Works","text":"default (keep_all = TRUE), input rows returned, weight_monthly = NA indeterminate observations:","code":"# Build crosswalk and apply (returns all rows by default) crosswalk <- pnadc_identify_periods(pnadc_full) result <- pnadc_apply_periods(pnadc_full, crosswalk,                                weight_var = \"V1028\",                                anchor = \"quarter\")  nrow(result) == nrow(pnadc_full)  # TRUE - all rows returned sum(is.na(result$weight_monthly))  # ~3% of rows have NA weights  # Use na.rm = TRUE when aggregating monthly_pop <- result[, .(pop = sum(weight_monthly, na.rm = TRUE)), by = ref_month_yyyymm]  # Filter to determined rows for analysis result_determined <- result[!is.na(ref_month_in_quarter)] nrow(result_determined) < nrow(pnadc_full)  # TRUE (~97% of rows)"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"weight-smoothing","dir":"Articles","previous_headings":"","what":"Weight Smoothing","title":"How PNADCperiods Works","text":"weight calibration, package can optionally apply smoothing reduce artificial quarterly patterns calibrated weights. controlled smooth parameter pnadc_apply_periods() (default: TRUE).","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"why-weight-smoothing-helps","dir":"Articles","previous_headings":"Weight Smoothing","what":"Why Weight Smoothing Helps","title":"How PNADCperiods Works","text":"PNADC’s quarterly structure creates subtle artifacts monthly estimates: Rotation group composition varies month: quarter 5 rotation groups, distribution across months isn’t perfectly even. months may slightly observations groups different demographic compositions. Boundary effects: first last months quarter can different characteristics middle months due interviews scheduled around “Parada Tecnica” (technical breaks). Cell-level imbalances: Within demographic cells (age × region × stratum), month--month sample sizes can vary, creating artificial jumps even true population stable. Weight smoothing addresses issues applying rolling mean calibration adjustments cell level, reducing artificial volatility preserving genuine trends.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"how-weight-smoothing-works","dir":"Articles","previous_headings":"Weight Smoothing","what":"How Weight Smoothing Works","title":"How PNADCperiods Works","text":"calibration, package applies rolling mean smoothing cell-level population ratios: smoothing window adapts time period granularity:","code":"For each (cell, period):   1. Calculate cell population: pop_cell_period = sum(weights)   2. Apply rolling mean across periods within cell:      pop_smoothed = frollmean(pop_cell_period, window, align=\"center\")   3. Calculate smoothing factor: factor = pop_smoothed / pop_cell_period   4. Adjust individual weights: weight_new = weight_old * factor"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"when-to-disable-smoothing","dir":"Articles","previous_headings":"Weight Smoothing","what":"When to Disable Smoothing","title":"How PNADCperiods Works","text":"default, smooth = TRUE recommended analyses. However, may want disable smoothing (smooth = FALSE) certain situations: Disable smoothing : Analyzing rapid shocks: studying events genuine month--month discontinuities (e.g., COVID-19 lockdown effects March 2020, sudden policy changes), smoothing may blur true timing effect. Studying short-term dynamics: research question focuses immediate month--month changes rather trends. Comparing specific months: comparing month across different years (e.g., December 2022 vs December 2023), smoothing may introduce bias adjacent months. Keep smoothing enabled : Computing time series publication visualization Analyzing gradual trends (employment growth, demographic shifts) underlying phenomenon expected change smoothly time Note: Smoothing applied microdata weights calibration. still observe quarterly artifacts final aggregated estimates, may indicate genuine sampling variation rather calibration artifacts.","code":"# With smoothing (default) - recommended for most analyses result <- pnadc_apply_periods(   pnadc_data, crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   smooth = TRUE  # default )  # Without smoothing - for shock analysis result_unsmoothed <- pnadc_apply_periods(   pnadc_data, crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   smooth = FALSE )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"applying-the-crosswalk","dir":"Articles","previous_headings":"","what":"Applying the Crosswalk","title":"How PNADCperiods Works","text":"package uses two-step workflow convert PNADC data sub-quarterly time series: pnadc_identify_periods(): Build crosswalk identifies reference periods (months, fortnights, weeks) household-quarter observation pnadc_apply_periods(): Merge crosswalk PNADC data optionally calibrate weights separation deliberate: crosswalk built stacked quarterly data (contains birthday variables), applied either quarterly annual datasets analysis.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"the-two-step-workflow","dir":"Articles","previous_headings":"Applying the Crosswalk","what":"The Two-Step Workflow","title":"How PNADCperiods Works","text":"","code":"┌─────────────────────────────────────────────────────────────────────────────┐ │                        TWO-STEP WORKFLOW                                     │ └─────────────────────────────────────────────────────────────────────────────┘  STEP 1: Build Crosswalk (run once, from quarterly data) ┌───────────────────────────────────────────────────────────────────────┐ │ pnadc_identify_periods(quarterly_stacked)                             │ │                                                                       │ │ Input:  Stacked quarterly PNADC (needs birthday variables)            │ │ Output: Crosswalk with ref_month, ref_fortnight, ref_week per         │ │         (UPA, V1014) household-panel group                            │ └───────────────────────────────────────────────────────────────────────┘                                     │                                     ▼ STEP 2: Apply to Target Data (run for each analysis) ┌───────────────────────────────────────────────────────────────────────┐ │ pnadc_apply_periods(target_data, crosswalk, ...)                      │ │                                                                       │ │ Input:  Any PNADC data (quarterly OR annual) + crosswalk              │ │ Output: Data with reference periods + calibrated weights              │ │                                                                       │ │ Key parameters:                                                       │ │   - weight_var: \"V1028\" (quarterly) or \"V1032\" (annual)               │ │   - anchor: \"quarter\" (quarterly) or \"year\" (annual)                  │ │   - calibration_unit: \"month\", \"fortnight\", or \"week\"                 │ └───────────────────────────────────────────────────────────────────────┘"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"quarterly-vs--annual-pnadc-data","dir":"Articles","previous_headings":"Applying the Crosswalk","what":"Quarterly vs. Annual PNADC Data","title":"How PNADCperiods Works","text":"PNADC two main data releases require different approaches: Key insight: Reference period identification works identically data types (birthday constraints don’t depend weight variables). difference weight calibration: quarterly weights distribute quarterly totals across 3 months, annual weights distribute yearly totals across 12 months.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"applying-to-quarterly-data","dir":"Articles","previous_headings":"Applying the Crosswalk","what":"Applying to Quarterly Data","title":"How PNADCperiods Works","text":"Use anchor = \"quarter\" quarterly PNADC data (V1028 weights):","code":"# Build crosswalk from stacked quarterly data crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Apply to quarterly data with monthly weights result_monthly <- pnadc_apply_periods(   pnadc_quarterly, crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibration_unit = \"month\",   calibrate = TRUE )  # Apply with fortnight weights (for short-term analysis) result_fortnight <- pnadc_apply_periods(   pnadc_quarterly, crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibration_unit = \"fortnight\",   calibrate = TRUE )  # Apply with weekly weights (for high-frequency monitoring) result_weekly <- pnadc_apply_periods(   pnadc_quarterly, crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibration_unit = \"week\",   calibrate = TRUE )"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"applying-to-annual-data","dir":"Articles","previous_headings":"Applying the Crosswalk","what":"Applying to Annual Data","title":"How PNADCperiods Works","text":"Use anchor = \"year\" annual PNADC data (V1032 weights). Note crosswalk still built quarterly data (contains birthday variables needed period identification). Annual data can also calibrated fortnight week level changing calibration_unit.","code":"# Step 1: Build crosswalk from quarterly data quarterly_data <- read_fst(\"pnadc_quarterly_stacked.fst\", as.data.table = TRUE) crosswalk <- pnadc_identify_periods(quarterly_data)  # Step 2: Load annual data with income variables annual_data <- read_fst(\"pnadc_2023_visita1.fst\", as.data.table = TRUE)  # Step 3: Apply crosswalk with annual calibration result <- pnadc_apply_periods(   annual_data, crosswalk,   weight_var = \"V1032\",   anchor = \"year\",   calibration_unit = \"month\",   calibrate = TRUE )  # Use for monthly income/poverty analysis monthly_income <- result[!is.na(ref_month_in_quarter), .(   mean_income = weighted.mean(VD5008, weight_monthly, na.rm = TRUE) ), by = ref_month_yyyymm]"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"covid-era-visit-selection","dir":"Articles","previous_headings":"Applying the Crosswalk","what":"COVID-Era Visit Selection","title":"How PNADCperiods Works","text":"annual data, must choose panel visit use. COVID-19 (2020-2021), visit 1 often unavailable: complete example poverty analysis annual data, see Annual Poverty Analysis vignette.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"using-modular-functions","dir":"Articles","previous_headings":"Advanced Usage","what":"Using Modular Functions","title":"How PNADCperiods Works","text":"control, use individual identification functions: Output (sample 2023, using real PNADC data):","code":"# Identify reference months only months <- identify_reference_month(pnadc_stacked)  # Identify fortnights only fortnights <- identify_reference_fortnight(pnadc_stacked)  # Identify weeks only weeks <- identify_reference_week(pnadc_stacked)  # Check determination rates by quarter months[, .(   total = .N,   determined = sum(!is.na(ref_month_in_quarter)),   rate = round(mean(!is.na(ref_month_in_quarter)) * 100, 1) ), by = .(Ano, Trimestre)] Ano Trimestre  total determined  rate  <int>     <int>  <int>      <int> <num> 1: 2023         1 169879     162107  95.4 2: 2023         2 171776     164920  96.0 3: 2023         3 175418     169215  96.5 4: 2023         4 173676     168094  96.8"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"validation-and-population-data","dir":"Articles","previous_headings":"Advanced Usage","what":"Validation and Population Data","title":"How PNADCperiods Works","text":"Output (sample fetch_monthly_population):","code":"# Validate input data before processing validation <- validate_pnadc(pnadc_stacked, stop_on_error = FALSE)  # Fetch population data from SIDRA-IBGE manually (for inspection) pop_data <- fetch_monthly_population(verbose = TRUE) head(pop_data)  # Note: pnadc_apply_periods() fetches population data automatically # when calibrate = TRUE. Manual fetching is only needed for inspection # or custom calibration workflows. Fetching monthly population data from SIDRA (table 6022)...   Retrieved 159 rows for 2012-2025     year_month population_total         <int>            <num> 1:     201202        193146000 2:     201203        193470000 3:     201204        193804000 4:     201205        194138000 5:     201206        194469000 6:     201207        194788000"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"experimental-period-strategies","dir":"Articles","previous_headings":"Advanced Usage","what":"Experimental Period Strategies","title":"How PNADCperiods Works","text":"improved fortnight/week determination, use experimental strategies: Output: See Experimental Strategies section detailed documentation.","code":"# Build standard crosswalk first crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Apply experimental strategies for improved fortnight/week determination crosswalk_exp <- pnadc_experimental_periods(   crosswalk,   data = pnadc_stacked,   strategy = \"both\",  # Options: \"none\", \"probabilistic\", \"upa_aggregation\", \"both\"   upa_homogeneity_threshold = 0.80,   verbose = TRUE )  # Check improvement crosswalk_exp[, .(   strict_fortnight = mean(determined_fortnight),   with_prob = mean(determined_fortnight | !is.na(ref_fortnight_likely)),   with_upa = mean(determined_fortnight | !is.na(ref_fortnight_upa)),   total = mean(determined_fortnight |                !is.na(ref_fortnight_likely) |                !is.na(ref_fortnight_upa)) )] Applying probabilistic strategy...   Calculating date bounds for probabilistic assignment...   Calculating probabilistic assignments for narrow ranges...   Probabilistic fortnight: 572,939 assignments (6.5% of undetermined)   Probabilistic week: 26,878 assignments (0.3% of undetermined) Applying UPA aggregation strategy...   Calculating UPA homogeneity rate...   UPA homogeneity (fortnight): 100.0%   UPA homogeneity 100.0% >= threshold 80.0%. Applying UPA aggregation.   UPA-aggregated fortnight: 4,803,577 additional assignments (54.2% of undetermined)   UPA homogeneity (week): 100.0%     strict_fortnight with_prob  with_upa    total               <num>     <num>     <num>    <num> 1:           0.0764    0.1361    0.5769   0.6033"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"benchmarks","dir":"Articles","previous_headings":"Performance","what":"Benchmarks","title":"How PNADCperiods Works","text":"Period Identification (pnadc_identify_periods()): Key optimization: make_date() function uses pre-computed lookup tables instead ISOdate(), achieving 20x speedup date operations. Experimental Strategies (pnadc_experimental_periods()):","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"determination-rates-by-period","dir":"Articles","previous_headings":"Performance","what":"Determination Rates by Period","title":"How PNADCperiods Works","text":"Based real PNADC data (2012-2025, 55 quarters, 28.4M observations, 9.6M household-quarters): Overall rates (strict determination): Rates year (monthly): experimental strategies: boundary quarters lower rates: first 4 last 4 quarters consecutive quarterly dataset always include (UPA, V1014) groups fewer 5 visits data. makes mensalization efficiency suboptimal boundaries. dataset 9 consecutive quarters, example, 5th quarter full utilization – among people observed 5th quarter, visits data, 1st visit 5th quarter 5th visit 5th quarter. inherent consequence PNADC’s rotating panel design (5 visits 5 quarters).","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"optimization-tips","dir":"Articles","previous_headings":"Performance","what":"Optimization Tips","title":"How PNADCperiods Works","text":"Use data.table directly (automatic conversion data.frame adds overhead) Load required columns reading data Process multiple years together (cross-quarter aggregation improves accuracy)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"tips-and-best-practices","dir":"Articles","previous_headings":"","what":"Tips and Best Practices","title":"How PNADCperiods Works","text":"Process multiple quarters together: Processing 2012-2025 together gives ~97% determination vs ~73% single quarter. Start reference month identification: don’t always need monthly weights. Often just knowing reference month enough. Check determination rates year: Monthly rates 97-99% 2013-2019. Lower rates may indicate data issues. Example output (2019): Handle indeterminate observations: Decide whether exclude use quarterly-level analysis cases. Use weight_monthly general analysis: rake-weighted output appropriate purposes. Consider experimental strategies fortnights/weeks: need larger fortnight/week samples, use pnadc_experimental_periods() UPA aggregation (leveraging 100% homogeneity) achieve 60% fortnight 15% week determination. See Experimental Strategies.","code":"crosswalk[, .(rate = mean(!is.na(ref_month_in_quarter))), by = .(Ano, Trimestre)] Ano Trimestre   rate  <int>     <int>  <num> 1: 2019         1 0.973 2: 2019         2 0.976 3: 2019         3 0.979 4: 2019         4 0.978"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"complete-workflow-example","dir":"Articles","previous_headings":"","what":"Complete Workflow Example","title":"How PNADCperiods Works","text":"section demonstrates complete workflow raw PNADC data monthly time series, incorporating concepts vignette.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"scenario-monthly-unemployment-analysis-2019-2024","dir":"Articles","previous_headings":"Complete Workflow Example","what":"Scenario: Monthly Unemployment Analysis (2019-2024)","title":"How PNADCperiods Works","text":"Output: Output (real PNADC 2012-2025 data):","code":"library(PNADCperiods) library(data.table)  # ============================================================================= # STEP 1: Load and stack quarterly PNADC data # =============================================================================  # Load quarterly data (recommend 2+ years for good determination rates) # Real data should be loaded from your files, e.g.: # files <- list.files(\"path/to/data\", pattern = \"pnadc_.*\\\\.fst$\", full.names = TRUE) # pnadc_stacked <- rbindlist(lapply(files, fst::read_fst, as.data.table = TRUE))  # Required columns for identification: required_id <- c(\"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\",                  \"V2003\", \"V2008\", \"V20081\", \"V20082\", \"V2009\")  # Additional columns for calibration: required_weights <- c(\"V1028\", \"UF\", \"posest\", \"posest_sxi\")  # Additional columns for analysis (labor force variables): analysis_vars <- c(\"VD4001\", \"VD4002\")  # Labor force status, occupation status  # ============================================================================= # STEP 2: Validate input data # =============================================================================  validation <- validate_pnadc(pnadc_stacked, stop_on_error = FALSE) print(validation)  # Check data coverage pnadc_stacked[, .N, by = .(Ano, Trimestre)][order(Ano, Trimestre)]  # ============================================================================= # STEP 3: Build crosswalk (identify reference periods) # =============================================================================  # This identifies months, fortnights, and weeks for all observations crosswalk <- pnadc_identify_periods(pnadc_stacked, verbose = TRUE) Building reference period crosswalk...   Preprocessing data (shared computation)...   Converting date bounds to period positions...   Aggregating constraints and determining periods...   Applying exception rules...   Assigning reference periods...   Building crosswalk...  Crosswalk complete:   - 9,598,723 unique household-quarter observations   - Month determination: 96.69%   - Fortnight determination: 7.64%   - Week determination: 1.54% # Check determination rates by year crosswalk[, .(   n = .N,   det_month = round(mean(determined_month, na.rm = TRUE) * 100, 1),   det_fortnight = round(mean(determined_fortnight, na.rm = TRUE) * 100, 1),   det_week = round(mean(determined_week, na.rm = TRUE) * 100, 1) ), by = Ano] Ano       n det_month det_fortnight det_week     <int>   <int>     <num>         <num>    <num>  1:  2012  695083      96.3           8.5      1.7  2:  2013  719697      98.7           8.5      1.4  3:  2014  739655      98.4           8.1      1.3  4:  2015  745247      98.2           8.1      1.6  5:  2016  749631      97.2           7.7      2.1  6:  2017  752066      96.9           7.5      1.8  7:  2018  750274      97.1           7.6      1.5  8:  2019  746873      97.6           7.8      1.3  9:  2020  535970      96.3           7.6      1.3 10:  2021  544817      93.3           6.9      1.9 11:  2022  679389      95.0           7.1      1.7 12:  2023  690749      96.2           7.1      1.7 13:  2024  708340      97.3           7.3      1.3 14:  2025  540932      93.1           6.9      1.0 # ============================================================================= # STEP 4: Apply crosswalk and calibrate monthly weights # =============================================================================  result <- pnadc_apply_periods(   pnadc_stacked,   crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibration_unit = \"month\",   calibrate = TRUE,   keep_all = TRUE,  # Keep indeterminate observations (with NA weights)   verbose = TRUE )  # Verify population totals match SIDRA result[!is.na(weight_monthly), .(   pop_millions = sum(weight_monthly) / 1e6 ), by = ref_month_yyyymm][order(ref_month_yyyymm)]  # ============================================================================= # STEP 5: Compute monthly estimates # =============================================================================  # Calculate monthly unemployment rate monthly_labor <- result[!is.na(ref_month_in_quarter), .(   labor_force = sum(weight_monthly * (VD4001 == 1), na.rm = TRUE),   employed = sum(weight_monthly * (VD4002 == 1), na.rm = TRUE),   n_obs = .N ), by = .(ref_month_yyyymm, ref_month)]  monthly_labor[, unemployment_rate := (labor_force - employed) / labor_force * 100]  # Check sample sizes summary(monthly_labor$n_obs)  # Should be ~65,000+ per month  # ============================================================================= # STEP 6: Visualize results # =============================================================================  # Basic plot (requires ggplot2) # library(ggplot2) # ggplot(monthly_labor, aes(x = ref_month, y = unemployment_rate)) + #   geom_line() + #   geom_point(size = 1) + #   labs(title = \"Monthly Unemployment Rate - Brazil\", #        subtitle = \"From PNADC quarterly data using PNADCperiods\", #        x = NULL, y = \"Unemployment Rate (%)\") + #   theme_minimal()"},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"key-takeaways","dir":"Articles","previous_headings":"Complete Workflow Example","what":"Key Takeaways","title":"How PNADCperiods Works","text":"Stack data first: Load 2+ years calling pnadc_identify_periods() maximize determination rate. Validate inputs: Use validate_pnadc() catch missing columns early. Check determination rates: Rates ~96-99% stable years. Lower rates suggest data issues boundary effects. Use keep_all = TRUE: Preserves observations; indeterminate ones get NA weights. Weight smoothing (smooth = TRUE default): Keep enabled trend analysis; disable shock/event analysis. Verify population totals: Monthly weighted sums approximate Brazil’s population (~206 million 2024).","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/articles/how-it-works.html","id":"further-reading","dir":"Articles","previous_headings":"","what":"Further Reading","title":"How PNADCperiods Works","text":"Applied Examples - See algorithm action COVID, recession, minimum wage validation Annual Poverty Analysis - Monthly poverty analysis annual PNADC income data IBGE PNADC Documentation Package function reference: ?pnadc_identify_periods, ?pnadc_apply_periods Source code: GitHub repository","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Marcos Hecksher. Author. Rogerio Barbosa. Author, maintainer. Claude AI. Contributor.           R package implementation","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Hecksher M, Barbosa R (2026). PNADCperiods: Identify Reference Periods Brazil's PNADC Survey Data. R package version 2.0.0, https://antrologos.github.io/mensalizePNADC/.","code":"@Manual{,   title = {PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data},   author = {Marcos Hecksher and Rogerio Barbosa},   year = {2026},   note = {R package version 2.0.0},   url = {https://antrologos.github.io/mensalizePNADC/}, }"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"project-overview","dir":"","previous_headings":"","what":"Project Overview","title":"CLAUDE.md","text":"R package (PNADCperiods) converts Brazil’s quarterly PNADC survey data sub-quarterly time series (monthly, fortnightly, weekly) optional weight calibration. Authors: Marcos Hecksher (methodology) | Rogerio Barbosa (R package) Repository: https://github.com/antrologos/mensalizePNADC","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"quick-reference","dir":"","previous_headings":"","what":"Quick Reference","title":"CLAUDE.md","text":"","code":"library(PNADCperiods) crosswalk <- pnadc_identify_periods(pnadc_stacked) result <- pnadc_apply_periods(pnadc_2023, crosswalk, weight_var = \"V1028\", anchor = \"quarter\")"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"required-variables","dir":"","previous_headings":"Quick Reference","what":"Required Variables","title":"CLAUDE.md","text":"Identification: Ano, Trimestre, UPA, V1008, V1014, V2008, V20081, V20082, V2009 Calibration: add V1028/V1032, UF, posest, posest_sxi","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"determination-rates","dir":"","previous_headings":"Quick Reference","what":"Determination Rates","title":"CLAUDE.md","text":"Always use stacked multi-quarter data best month determination rate.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"development-workflow","dir":"","previous_headings":"","what":"Development Workflow","title":"CLAUDE.md","text":"pkgdown site rebuilds automatically via GitHub Actions push master: https://antrologos.github.io/mensalizePNADC/","code":"devtools::document(\"mensalizePNADC\")  # Update NAMESPACE and man/ devtools::check(\"mensalizePNADC\")     # R CMD check devtools::test(\"mensalizePNADC\")      # Run tests devtools::install(\"mensalizePNADC\", dependencies = FALSE)  # Install locally pkgdown::build_site(\"mensalizePNADC\")  # Rebuild docs locally"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"algorithm-summary","dir":"","previous_headings":"","what":"Algorithm Summary","title":"CLAUDE.md","text":"Calculate valid interview Saturdays (IBGE timing rules) Apply birthday constraints narrow date range Convert dates month/fortnight/week positions Aggregate constraints UPA-panel level across quarters (months ) Dynamic exception detection edge cases Final determination: min == max → determined Critical: Months aggregate .(UPA, V1014) across quarters. Fortnights/weeks aggregate .(Ano, Trimestre, UPA, V1008) within quarter .","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"weight-calibration","dir":"","previous_headings":"Algorithm Summary","what":"Weight Calibration","title":"CLAUDE.md","text":"time periods calibrate FULL Brazilian population (divided). Hierarchical raking simplified sparse data:","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"running-r-scripts-on-windows","dir":"","previous_headings":"Important Notes for Claude Code","what":"Running R Scripts on Windows","title":"CLAUDE.md","text":"R location: C:\\Program Files\\R\\R-4.5.0\\bin\\Rscript.exe run R scripts command line: NEVER use -e flag complex R code - causes segfaults.","code":"\"C:\\\\Program Files\\\\R\\\\R-4.5.0\\\\bin\\\\Rscript.exe\" script.R # WRONG Rscript -e \"complex code...\"  # CORRECT - write to file first # 1. Write script to temp.R # 2. Run: \"C:\\\\Program Files\\\\R\\\\R-4.5.0\\\\bin\\\\Rscript.exe\" temp.R"},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"data-quality-rules","dir":"","previous_headings":"Important Notes for Claude Code","what":"Data Quality Rules","title":"CLAUDE.md","text":"NEVER use simulated placeholder data vignettes, figures, examples. figures analyses must use real PNADC data real official statistics. external validation data needed (e.g., IBGE official poverty estimates), fetch official sources clearly state validation requires user-provided data. NEVER use “Expected output” sections vignettes documentation. code examples either: 1. Show actual outputs pre-computed real data (eval=FALSE chunks), 2. executable real data (eval=TRUE chunks) output shown (e.g., depends user’s data), omit output section entirely rather showing hypothetical results.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"git-repository-location","dir":"","previous_headings":"Important Notes for Claude Code","what":"Git Repository Location","title":"CLAUDE.md","text":"CRITICAL: git repository inside package directory, project root. Always use package directory git commands: Common git errors using wrong directory: - Exit code 128: fatal: git repository - Exit code 129: warning: git repository","code":"D:\\Dropbox\\Artigos\\mensalizacao_pnad\\          # Project root (NOT a git repo) └── mensalizePNADC\\                            # Git repository is HERE     ├── .git\\     ├── R\\     ├── tests\\     └── ... # WRONG - causes exit codes 128/129 cd \"D:\\Dropbox\\Artigos\\mensalizacao_pnad\" && git status  # CORRECT cd \"D:\\Dropbox\\Artigos\\mensalizacao_pnad\\mensalizePNADC\" && git status"},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"common-issues","dir":"","previous_headings":"Important Notes for Claude Code","what":"Common Issues","title":"CLAUDE.md","text":"Low determination rate → Stack 2+ years data Missing columns → Use validate_pnadc() check SIDRA API errors → Check internet; API rate limits Git errors (exit 128/129) → Use mensalizePNADC/ directory, project root","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/CLAUDE.html","id":"local-data-paths-rogerios-machine","dir":"","previous_headings":"Important Notes for Claude Code","what":"Local Data Paths (Rogerio’s machine)","title":"CLAUDE.md","text":"File naming conventions: - Quarterly: pnadc_2019-1q.fst, pnadc_2019-2q.fst, etc. - Annual: pnadc_2019_visita1.fst, pnadc_2020_visita5.fst, etc. Visit selection annual data: - 2015-2019: Visit 1 - 2020-2021: Visit 5 (COVID period - visit 1 available) - 2022-2024: Visit 1","code":"D:/Dropbox/Bancos_Dados/PNADC/ ├── Trimestral/Dados/           # Quarterly data (pnadc_YYYY-Nq.fst) └── Anual/visitas/              # Annual visit data (pnadc_YYYY_visitaN.fst)"},{"path":"https://antrologos.github.io/mensalizePNADC/index.html","id":"pnadcperiods","dir":"","previous_headings":"","what":"Identify Reference Periods in Brazil's PNADC Survey Data","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"Convert Brazil’s quarterly PNADC survey data sub-quarterly time series (monthly, fortnightly, weekly).","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/index.html","id":"overview","dir":"","previous_headings":"","what":"Overview","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"PNADCperiods package identifies reference periods (months, fortnights, weeks) Brazil’s quarterly PNADC (Pesquisa Nacional por Amostra de Domicilios Continua) microdata optionally computes calibrated survey weights. sub-quarterly analysis? PNADC quarterly statistics actually moving averages three months. package recovers specific period observation refers , enabling true monthly (finer) labor market analysis. ~97% monthly determination rate using stacked multi-quarter data ~8% strict fortnightly rate (within-quarter constraints ) ~2% strict weekly rate (within-quarter constraints ) Experimental strategies can boost fortnight ~58% week ~14% (UPA aggregation) Validated methodology based Hecksher (2024) Fast: ~1 minute 28M rows","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"","code":"# Requires R >= 4.0.0  # Install from GitHub devtools::install_github(\"antrologos/mensalizePNADC\")  # For SIDRA API integration (optional): install.packages(\"sidrar\")"},{"path":"https://antrologos.github.io/mensalizePNADC/index.html","id":"quick-example","dir":"","previous_headings":"","what":"Quick Example","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"Key parameters pnadc_apply_periods(): - weight_var: weight column use (\"V1028\" quarterly, \"V1032\" annual) - anchor: Calibration anchor (\"quarter\" \"year\") - calibrate = TRUE: Compute calibrated weights (default: TRUE) - calibration_unit: Granularity calibration (\"month\", \"fortnight\", \"week\") Calibration strategy: - time periods (month, fortnight, week) calibrate full Brazilian population SIDRA - Hierarchical raking automatically simplified finer granularities: - Monthly: 4 cell levels (full demographic/geographic hierarchy) - Fortnight: 2 cell levels (age + region) - Weekly: 1 cell level (age groups ) Crosswalk output columns: - ref_month, ref_month_in_quarter, ref_month_yyyymm, determined_month - ref_fortnight, ref_fortnight_in_quarter, ref_fortnight_yyyyff, determined_fortnight - ref_week, ref_week_in_quarter, ref_week_yyyyww, determined_week Required input columns: - identification: Ano, Trimestre, UPA, V1008, V1014, V2008, V20081, V20082, V2009 - weights: add V1028 (V1032), UF, posest, posest_sxi complete examples, see Get Started guide.","code":"library(PNADCperiods) library(data.table)  # Load stacked PNADC data (2+ years recommended for best determination rate) pnadc <- fread(\"pnadc_stacked.csv\")  # Step 1: Build crosswalk (identify reference periods) crosswalk <- pnadc_identify_periods(pnadc)  # Step 2: Apply to data (with optional weight calibration) result <- pnadc_apply_periods(pnadc, crosswalk,                                weight_var = \"V1028\",                                anchor = \"quarter\")  # Use in analysis result[, .(n = .N), by = ref_month_yyyymm]"},{"path":"https://antrologos.github.io/mensalizePNADC/index.html","id":"experimental-features","dir":"","previous_headings":"","what":"Experimental Features","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"pnadc_experimental_periods() function provides experimental strategies improve fortnight week determination rates: Key finding: UPA homogeneity rate = 100% fortnights weeks. means household UPA determined period, households determined periods UPA period. features marked experimental may change future versions. See Benchmark Report detailed results.","code":"# Apply experimental strategies crosswalk_exp <- pnadc_experimental_periods(   crosswalk,   pnadc_stacked,   strategy = \"upa_aggregation\"  # or \"probabilistic\" or \"both\" )"},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/index.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"use package research, please cite: Hecksher, M. & Barbosa, R. (2024). PNADCperiods: Identify Reference Periods Brazil’s PNADC Survey Data. R package. https://github.com/antrologos/mensalizePNADC","code":"citation(\"PNADCperiods\")"},{"path":"https://antrologos.github.io/mensalizePNADC/index.html","id":"getting-help","dir":"","previous_headings":"","what":"Getting Help","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"Bug reports: GitHub Issues Questions: Open GitHub issue “question” label","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/index.html","id":"authors","dir":"","previous_headings":"","what":"Authors","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"Marcos Hecksher - Original methodology (ORCID) Rogerio Barbosa - R package maintainer (ORCID)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/index.html","id":"references","dir":"","previous_headings":"","what":"References","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"IBGE PNADC Documentation Hecksher, M. (2024). Mensalizacao da PNADC. Working paper.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/index.html","id":"license","dir":"","previous_headings":"","what":"License","title":"Identify Reference Periods in Brazil's PNADC Survey Data","text":"MIT","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/calibrate_monthly_weights.html","id":null,"dir":"Reference","previous_headings":"","what":"Calibrate Monthly Weights — calibrate_monthly_weights","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"original PNADC survey weights (V1028) designed quarterly estimates. function creates monthly weights : Grouping observations nested demographic/geographic cells Iteratively adjusting weights monthly totals match quarterly totals within cell Calibrating final weights external monthly population totals","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/calibrate_monthly_weights.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"","code":"calibrate_monthly_weights(   data,   monthly_totals,   n_cells = 4L,   keep_all = TRUE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/calibrate_monthly_weights.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"data data.frame data.table PNADC microdata including reference month information (output identify_reference_month). Required columns include: Reference month columns: ref_month_yyyymm, ref_month_in_quarter Survey design: V1028, UF, posest, posest_sxi Demographics: V2009 (age) Time: Ano, Trimestre monthly_totals data.frame monthly population totals. Required columns: ref_month_yyyymm anomesexato: YYYYMM integer m_populacao: Monthly population thousands n_cells Integer. Number hierarchical cell levels use (1-4). Default 4 (full hierarchy). Lower values faster less precise. keep_all Logical. TRUE (default), return rows including indeterminate reference months (weight_calibrated = NA). FALSE, return observations determined reference months. verbose Logical. Print progress messages? Default TRUE.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/calibrate_monthly_weights.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"data.table input data plus: weight_calibrated: Calibrated monthly weight celula1 celula4: Cell identifiers (computed)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/calibrate_monthly_weights.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"Redistributes quarterly survey weights monthly weights using hierarchical calibration across demographic geographic cells. hierarchical calibration cells : celula1 Age groups: 0-13, 14-29, 30-59, 60+ celula2 Post-stratum group + age group celula3 State (UF) + celula2 celula4 Post-stratum (posest) + celula2 level, weights adjusted : sum(weight_new) (cell, month) / sum(weight_old) (cell, month) equals sum(V1028) (cell, quarter) / sum(weight_old) (cell, month) preserves quarterly totals redistributing months.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/calibrate_monthly_weights.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"Important: function designed quarterly PNADC data 5 panel visits present. annual PNADC analysis (visit-specific data), use pnadc_apply_periods anchor = \"year\" instead.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/calibrate_monthly_weights.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Calibrate Monthly Weights — calibrate_monthly_weights","text":"","code":"if (FALSE) { # \\dontrun{ # Recommended workflow using main API: crosswalk <- pnadc_identify_periods(pnadc_stacked) result <- pnadc_apply_periods(pnadc_2023, crosswalk,                               weight_var = \"V1028\",                               anchor = \"quarter\")  # Alternative: manual workflow with this function crosswalk <- pnadc_identify_periods(pnadc_stacked) merged <- merge(pnadc_data, crosswalk, by = c(\"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\")) monthly_pop <- fetch_monthly_population() result <- calibrate_monthly_weights(merged, monthly_pop) } # }"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/fetch-sidra-population.html","id":null,"dir":"Reference","previous_headings":"","what":"Fetch Monthly Population from SIDRA — fetch-sidra-population","title":"Fetch Monthly Population from SIDRA — fetch-sidra-population","text":"Functions download transform IBGE's population estimates SIDRA API use monthly weight calibration.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/fetch_monthly_population.html","id":null,"dir":"Reference","previous_headings":"","what":"Fetch Monthly Population from SIDRA — fetch_monthly_population","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"Downloads population estimates IBGE SIDRA API (table 6022) transforms moving-quarter exact monthly values.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/fetch_monthly_population.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"","code":"fetch_monthly_population(   start_yyyymm = NULL,   end_yyyymm = NULL,   verbose = TRUE )"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/fetch_monthly_population.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"start_yyyymm Integer. First month include (YYYYMM format). NULL, returns available months. end_yyyymm Integer. Last month include (YYYYMM format). NULL, returns available months. verbose Logical. Print progress messages? Default TRUE.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/fetch_monthly_population.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"data.table columns: ref_month_yyyymm: Integer YYYYMM format m_populacao: Monthly population thousands","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/fetch_monthly_population.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"SIDRA table 6022 provides moving-quarter population estimates. value represents 3-month average centered middle month. example, value code 201203 (quarter ending March 2012) represents population February 2012. function: Fetches raw moving-quarter data SIDRA Transforms exact monthly values aligning middle months Extrapolates boundary months (first last) using quadratic regression extrapolation follows methodology Hecksher (2024), using quadratic regression population differences estimate first month (Jan 2012) recent month.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/fetch_monthly_population.html","id":"dependencies","dir":"Reference","previous_headings":"","what":"Dependencies","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"function requires sidrar package API access. Install : install.packages(\"sidrar\")","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/fetch_monthly_population.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Fetch Monthly Population from SIDRA — fetch_monthly_population","text":"","code":"if (FALSE) { # \\dontrun{ # Fetch all available months pop <- fetch_monthly_population()  # Fetch specific date range pop <- fetch_monthly_population(201301, 201912) } # }"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_fortnight.html","id":null,"dir":"Reference","previous_headings":"","what":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"PNADC quarterly survey interview occurs specific fortnight within quarter. function identifies fortnight (1-6 per quarter, 1-24 per year) observation belongs , enabling bi-weekly time series analysis. algorithm uses: IBGE's reference week timing rules (first Saturday sufficient days month) Respondent birthdates constrain possible interview dates UPA-panel level aggregation (everyone sampling unit interviewed together) Dynamic exception detection (identifies quarters needing relaxed rules)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_fortnight.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"","code":"identify_reference_fortnight(data, verbose = TRUE, .pb = NULL, .pb_offset = 0L)"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_fortnight.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"data data.frame data.table PNADC microdata. Required columns: Ano: Survey year Trimestre: Quarter (1-4) UPA: Primary Sampling Unit V1008: Household sequence within UPA V1014: Panel identifier V2008: Birth day (1-31) V20081: Birth month (1-12) V20082: Birth year V2009: Age verbose Logical. TRUE (default), display progress information. .pb Optional progress bar object. .pb_offset Integer. Offset progress bar updates.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_fortnight.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"data.table original key columns plus: ref_fortnight: Reference fortnight Date (1st 16th month) ref_fortnight_in_quarter: Position quarter (1-6) NA ref_fortnight_yyyyff: Integer YYYYFF format (1-24 per year)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_fortnight.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"Determines fortnight (quinzena - 15-day period) within quarter corresponds survey observation based IBGE's interview timing rules.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_fortnight.html","id":"fortnight-definition","dir":"Reference","previous_headings":"","what":"Fortnight Definition","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"year 24 fortnights (2 per month): Fortnight 01: Jan 1-15 Fortnight 02: Jan 16-31 Fortnight 03: Feb 1-15 Fortnight 04: Feb 16-28/29 ... fortnight 24 (Dec 16-31) quarter 6 fortnights (e.g., Q1 = fortnights 01-06).","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_fortnight.html","id":"expected-determination-rate","dir":"Reference","previous_headings":"","what":"Expected Determination Rate","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"Fortnight determination rate typically low (~2-5%) : Unlike months, fortnights aggregate across quarters Birthday constraints typically narrow date range weeks 15-day fortnight window difficult pinpoint without cross-quarter data algorithm determines fortnight interview date range falls entirely within single 15-day period. Note: month algorithm achieves ~97% determination aggregating UPA-V1014 level across quarters (leveraging panel design units interviewed consistent relative positions). Fortnights weeks use cross-quarter aggregation positions consistent across panel visits.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_fortnight.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Identify Reference Fortnight in PNADC Data — identify_reference_fortnight","text":"","code":"if (FALSE) { # \\dontrun{ # Identify reference fortnights result <- identify_reference_fortnight(pnadc_data)  # Check determination rate by quarter result[, .(   total = .N,   determined = sum(!is.na(ref_fortnight_in_quarter)),   rate = mean(!is.na(ref_fortnight_in_quarter)) ), by = .(Ano, Trimestre)]  # Note: Fortnight determination rate is typically low (~2-5%) # because fortnights cannot aggregate across quarters like months can. } # }"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_month.html","id":null,"dir":"Reference","previous_headings":"","what":"Identify Reference Month in PNADC Data — identify_reference_month","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"PNADC quarterly survey, interview actually refers specific month within quarter. function identifies month observation belongs , enabling shorter term time series analysis. algorithm uses: IBGE's reference week timing rules (first Saturday sufficient days month) Respondent birthdates constrain possible interview dates UPA-panel level aggregation (everyone sampling unit interviewed together) Dynamic exception detection (identifies quarters needing relaxed rules data)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_month.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"","code":"identify_reference_month(data, verbose = TRUE, .pb = NULL, .pb_offset = 0L)"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_month.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"data data.frame data.table PNADC microdata. Required columns: Ano: Survey year Trimestre: Quarter (1-4) UPA: Primary Sampling Unit V1014: Panel identifier V2008: Birth day (1-31) V20081: Birth month (1-12) V20082: Birth year V2009: Age Optional recommended complete crosswalk: V1008: Household sequence within UPA V2003: Person sequence within household verbose Logical. TRUE (default), display progress bar step information. .pb Optional progress bar object created txtProgressBar. provided, function updates progress bar instead creating . Used internally pnadc_identify_periods() show unified progress across steps. .pb_offset Integer. Offset add progress bar updates using external progress bar. Default 0.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_month.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"data.table original key columns plus: ref_month: Reference month Date (first day month, e.g., \"2023-01-01\") ref_month_in_quarter: Position quarter (1, 2, 3) NA indeterminate ref_month_yyyymm: Integer YYYYMM format (e.g., 202301)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_month.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"Determines month within quarter corresponds survey observation based IBGE's \"Parada Tecnica\" (technical break) rules.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_month.html","id":"exception-detection","dir":"Reference","previous_headings":"","what":"Exception Detection","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"function detects quarters need relaxed timing rules based data . algorithm detects exceptions per-month level within quarter: Checks standard rules produce impossible results (min > max) Checks relaxed rules resolve issue Applies exception rules entire quarter UPA requires ","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_month.html","id":"cross-quarter-aggregation-important-","dir":"Reference","previous_headings":"","what":"Cross-Quarter Aggregation (Important!)","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"optimal determination rates (~97%), input data stacked across multiple quarters (ideally 4+ years). algorithm leverages PNADC's rotating panel design UPA-V1014 interviewed relative week across quarterly visits. Per-quarter processing: ~65-75% determination rate Multi-quarter stacked: ~97% determination rate","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_month.html","id":"processing-steps","dir":"Reference","previous_headings":"","what":"Processing Steps","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"function processes data following steps: Calculate first valid interview Saturday month quarter (standard rule) person, calculate possible interview date range based birthday constraints Convert date ranges month--quarter positions Aggregate UPA-panel level (persons must agree) Calculate alternative (exception) date ranges positions Dynamically detect quarters/months need exception rules Apply exception rules recalculate final month positions","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_month.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Identify Reference Month in PNADC Data — identify_reference_month","text":"","code":"if (FALSE) { # \\dontrun{ # Identify reference months result <- identify_reference_month(pnadc_data)  # Check determination rate result[, .(   total = .N,   determined = sum(!is.na(ref_month_in_quarter)),   rate = mean(!is.na(ref_month_in_quarter)) ), by = .(Ano, Trimestre)] } # }"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_week.html","id":null,"dir":"Reference","previous_headings":"","what":"Identify Reference Week in PNADC Data — identify_reference_week","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"PNADC quarterly survey interview occurs specific week within quarter. function identifies ISO 8601 week observation belongs , enabling weekly time series analysis. algorithm uses: IBGE's reference week timing rules (first Saturday sufficient days month) Respondent birthdates constrain possible interview dates Household-level aggregation (persons household interviewed day) Dynamic exception detection (identifies quarters needing relaxed rules data) Key difference monthly identification: function aggregates household level WITHIN quarter, UPA-V1014 level across quarters. households interviewed month position across quarterly visits, week position.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_week.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"","code":"identify_reference_week(data, verbose = TRUE, .pb = NULL, .pb_offset = 0L)"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_week.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"data data.frame data.table PNADC microdata. Required columns: Ano: Survey year Trimestre: Quarter (1-4) UPA: Primary Sampling Unit V1008: Household sequence within UPA V1014: Panel identifier V2008: Birth day (1-31) V20081: Birth month (1-12) V20082: Birth year V2009: Age Optional recommended complete crosswalk: V2003: Person sequence within household verbose Logical. TRUE (default), display progress bar step information. .pb Optional progress bar object created txtProgressBar. provided, function updates progress bar instead creating . .pb_offset Integer. Offset add progress bar updates using external progress bar. Default 0.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_week.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"data.table original key columns plus: ref_week: Reference week Date (Monday week) ref_week_in_quarter: Position quarter (1-14) NA indeterminate ref_week_yyyyww: Integer YYYYWW format (e.g., 202301)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_week.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"Determines ISO week survey observation corresponds based IBGE's interview timing rules birthday constraints.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_week.html","id":"household-aggregation","dir":"Reference","previous_headings":"","what":"Household Aggregation","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"persons household (UPA + V1008) interviewed day. algorithm aggregates birthday constraints across household members narrow possible interview week: person weeks 2-4 possibilities person B weeks 3-5 possibilities household's interview week must 3-4 (intersection) Aggregation done (Ano, Trimestre, UPA, V1008) - within quarter , households interviewed week across quarterly visits.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_week.html","id":"expected-determination-rate","dir":"Reference","previous_headings":"","what":"Expected Determination Rate","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"weekly determination rate (~1-2%) much lower monthly (~97%) : aggregate across quarters (consistent week position panel design) Finer granularity (13-14 weeks vs 3 months per quarter) Birthday constraints rarely narrow interview window single 7-day period","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_week.html","id":"iso-weeks","dir":"Reference","previous_headings":"","what":"ISO 8601 Weeks","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"Weeks follow ISO 8601 standard: Week 1 week containing January 4th Weeks start Monday Dec 31 may week 1 following year","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/identify_reference_week.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Identify Reference Week in PNADC Data — identify_reference_week","text":"","code":"if (FALSE) { # \\dontrun{ # Identify reference weeks result <- identify_reference_week(pnadc_data)  # Check determination rate result[, .(   total = .N,   determined = sum(!is.na(ref_week_in_quarter)),   rate = mean(!is.na(ref_week_in_quarter)) ), by = .(Ano, Trimestre)] } # }"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC-package.html","id":null,"dir":"Reference","previous_headings":"","what":"mensalizePNADC: Convert Quarterly PNADC Survey Data to Monthly Time Series — mensalizePNADC-package","title":"mensalizePNADC: Convert Quarterly PNADC Survey Data to Monthly Time Series — mensalizePNADC-package","text":"mensalizePNADC package provides tools identify exact month Brazil's quarterly official household survey, PNADC (Pesquisa Nacional por Amostra de Domicilios Continua - IBGE), allowing analyzing survey data monthly time series.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC-package.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"mensalizePNADC: Convert Quarterly PNADC Survey Data to Monthly Time Series — mensalizePNADC-package","text":"package offers two main capabilities: Reference month identification: Determines month within quarter survey observation refers , using IBGE's \"Parada Tecnica\" rules respondent birthdates Monthly weight computation: Adjusts survey weights monthly (instead quarterly) estimates using hierarchical rake weighting package highly optimized large datasets: approximately 1 minute process 28.4 million rows (450,000 rows/sec), 97.0 percent determination rate. Uses pre-computed lookup tables 20x faster date creation. main function mensalizePNADC, processes stacked quarterly PNADC data returns crosswalk joining original data.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC-package.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"mensalizePNADC: Convert Quarterly PNADC Survey Data to Monthly Time Series — mensalizePNADC-package","text":"IBGE Manual Basico da Entrevista PNADC (methodology \"Parada Tecnica\")","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"mensalizePNADC: Convert Quarterly PNADC Survey Data to Monthly Time Series — mensalizePNADC-package","text":"Marcos Hecksher mdhecksher@gmail.com Rogerio Barbosa rogerio.barbosa@iesp.uerj.br","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC.html","id":null,"dir":"Reference","previous_headings":"","what":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"function processes stacked quarterly PNADC microdata : Identify month within quarter observation refers Optionally compute monthly adjusted survey weights (compute_weights = TRUE) output crosswalk table can joined original (stacked unstacked) PNADC data files add monthly time information.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"","code":"mensalizePNADC(   data,   compute_weights = FALSE,   keep_all = TRUE,   output = c(\"crosswalk\", \"microdata\", \"aggregates\"),   verbose = TRUE )"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"data data.frame data.table stacked quarterly PNADC microdata. reference month identification (compute_weights = FALSE), minimum required columns : Ano, Trimestre: Year quarter UPA, V1014: Primary sampling unit panel V2008, V20081, V20082: Birth day, month, year V2009: Age monthly weight computation (compute_weights = TRUE), additional columns required. See Details. compute_weights Logical. TRUE, compute monthly adjusted survey weights addition identifying reference months. Default FALSE. Requires sidrar package fetch population data IBGE SIDRA API. makes monthly weights sum population results https://sidra.ibge.gov.br/tabela/6022. keep_all Logical. TRUE (default), return rows input data, weight_monthly = NA observations reference month determined. FALSE, return observations determined reference months (smaller output). applies compute_weights = TRUE. output Character. return: \"crosswalk\" (default): Minimal crosswalk joining \"microdata\": Full microdata computed columns \"aggregates\": Monthly aggregated indicators verbose Logical. Print progress messages? Default TRUE.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"Depends output parameter: output = \"crosswalk\" (default): data.table join keys new time variables: Join keys: Ano, Trimestre, UPA, V1008, V1014, V2003 ref_month: Reference month Date ref_month_in_quarter: Position quarter (1, 2, 3) NA ref_month_yyyymm: Integer YYYYMM format weight_monthly: Monthly weight (compute_weights = TRUE) output = \"microdata\": Full input data computed columns added. output = \"aggregates\": data.table monthly aggregated indicators containing: ref_month_yyyymm: Month identifier YYYYMM format n_obs: Number observations per month population: Total monthly population (sum weights) Requires compute_weights = TRUE.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"Main function convert quarterly PNADC survey data monthly time series. Returns crosswalk data.frame joining original data, adding reference month information optionally monthly survey weights.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC.html","id":"reference-month-identification","dir":"Reference","previous_headings":"","what":"Reference Month Identification","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"algorithm determines month survey response refers based : IBGE's \"Parada Tecnica\" rules reference week timing Respondent birthdates (constrains possible interview dates) UPA-panel grouping (everyone interviewed together)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC.html","id":"cross-quarter-aggregation-important-","dir":"Reference","previous_headings":"","what":"Cross-Quarter Aggregation (Important!)","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"optimal determination rates (~97%), input data stacked across multiple quarter datasets (ideally 4+ years). algorithm leverages PNADC's rotating panel design locations defined values variables UPA-V1014 always interviewed relative month within given quarter across quarterly visits. Per-quarter processing: ~65-75% determination rate Multi-quarter stacked: ~97% determination rate cross-quarter aggregation dramatically improves accuracy combining birthday constraints multiple interview rounds.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC.html","id":"monthly-weight-computation","dir":"Reference","previous_headings":"","what":"Monthly Weight Computation","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"compute_weights = TRUE, function: Fetches monthly population IBGE SIDRA API (table 6022) Redistributes quarterly weights months using hierarchical rake weighting Smooths monthly aggregates remove quarterly artifacts resulting weight_monthly adjusted weight general-purpose monthly analysis. Additional required columns weight computation: Survey design: V1028, V1008, V2003, UF, posest, posest_sxi","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC.html","id":"dependencies","dir":"Reference","previous_headings":"","what":"Dependencies","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"compute_weights = TRUE, sidrar package required fetch population data. Install : install.packages(\"sidrar\")","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalizePNADC.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Mensalize PNADC Quarterly Survey Data — mensalizePNADC","text":"","code":"if (FALSE) { # \\dontrun{ # Basic usage: identify reference months only library(mensalizePNADC)  # Load stacked quarterly data (minimum columns) pnadc <- data.table::fread(\"pnadc_stacked.csv\",   select = c(\"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\", \"V2003\",              \"V2008\", \"V20081\", \"V20082\", \"V2009\"))  # Get crosswalk crosswalk <- mensalizePNADC(pnadc)  # Join with original quarterly file original <- haven::read_dta(\"PNADC_2023T1.dta\") monthly <- dplyr::left_join(original, crosswalk,   by = c(\"Ano\", \"Trimestre\", \"UPA\", \"V1008\", \"V1014\", \"V2003\"))   # With monthly weights for general analysis # (requires sidrar package and internet connection) pnadc_full <- haven::read_dta(\"PNADCtrimestralempilhada.dta\")  result <- mensalizePNADC(pnadc_full, compute_weights = TRUE)  # Use weight_monthly for any monthly aggregate result[, .(pop = sum(weight_monthly)), by = ref_month_yyyymm] } # }"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalize_annual_pnadc.html","id":null,"dir":"Reference","previous_headings":"","what":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"function: Merges annual PNADC data crosswalk add reference month information Optionally calibrates V1032 weights using hierarchical rake weighting Final calibration SIDRA monthly population totals","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalize_annual_pnadc.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"","code":"mensalize_annual_pnadc(   annual_data,   crosswalk,   calibrate_weights = TRUE,   n_cells = 4L,   keep_all = TRUE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalize_annual_pnadc.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"annual_data data.frame/data.table annual PNADC data (stacked single year). Required columns (case-insensitive, converted lowercase internally): Join keys: ano, trimestre, upa, v1008, v1014, v2003 Weight: v1032 Demographics (calibration): v2009 (age), uf, posest, posest_sxi crosswalk Output mensalizePNADC() reference month information. calibrate_weights Logical. TRUE (default), calibrate V1032 weights monthly SIDRA population totals using hierarchical rake weighting. FALSE, just merge crosswalk without calibration. n_cells Integer (1-4). Number hierarchical cell levels raking. Default 4 (full hierarchy: age, posest_sxi, UF, posest). keep_all Logical. Keep observations without determined reference month? Default TRUE. verbose Logical. Print progress? Default TRUE.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalize_annual_pnadc.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"data.table annual data merged crosswalk plus: ref_month, ref_month_in_quarter, ref_month_yyyymm: crosswalk weight_monthly: Calibrated monthly weight (calibrate_weights = TRUE)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalize_annual_pnadc.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"Merges annual PNADC data mensalization crosswalk optionally calibrates annual weights (V1032) monthly population totals.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalize_annual_pnadc.html","id":"why-not-use-quarterly-crosswalk-weights-","dir":"Reference","previous_headings":"","what":"Why Not Use Quarterly Crosswalk Weights?","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"weight_monthly quarterly crosswalk calibrated assuming 5 panel visits present quarter. Annual data 1 visit per observation, weights inappropriate. function uses annual weight V1032 starting point applies: Hierarchical rake weighting within demographic cells (redistributing yearly totals months) Final calibration SIDRA monthly population totals","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/mensalize_annual_pnadc.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Mensalize Annual PNADC Data — mensalize_annual_pnadc","text":"","code":"if (FALSE) { # \\dontrun{ # Step 1: Create crosswalk from quarterly data crosswalk <- mensalizePNADC(quarterly_data, compute_weights = FALSE)  # Step 2: Load and merge annual data with calibration d <- mensalize_annual_pnadc(   annual_data = annual_data,   crosswalk = crosswalk,   calibrate_weights = TRUE )  # Use the calibrated weight d[, .(pop = sum(weight_monthly)), by = ref_month_yyyymm] } # }"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/PNADCperiods-package.html","id":null,"dir":"Reference","previous_headings":"","what":"PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data — PNADCperiods-package","title":"PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data — PNADCperiods-package","text":"PNADCperiods package provides tools identify exact reference period (month, fortnight, week) Brazil's quarterly official household survey, PNADC (Pesquisa Nacional por Amostra de Domicilios Continua - IBGE), allowing analyzing survey data sub-quarterly temporal granularity.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/PNADCperiods-package.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data — PNADCperiods-package","text":"package offers two main capabilities: Reference period identification: Determines temporal period (month, fortnight, week) within quarter survey observation refers , using IBGE's \"Parada Tecnica\" rules respondent birthdates Period-specific weight computation: Adjusts survey weights sub-quarterly estimates using hierarchical rake weighting package highly optimized large datasets: approximately 1 minute process 28.4 million rows (450,000 rows/sec), ~97 percent determination rate months, ~2-5 percent fortnights, ~1-2 percent weeks. Uses pre-computed lookup tables 20x faster date creation. Note: Fortnight week determination rates inherently low leverage cross-quarter aggregation like months can. birthday constraints within single quarter available narrow interview window. main functions : pnadc_identify_periods: Builds universal crosswalk containing month, fortnight, week reference periods pnadc_apply_periods: Applies crosswalk PNADC dataset optionally calibrates weights","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/PNADCperiods-package.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data — PNADCperiods-package","text":"IBGE Manual Basico da Entrevista PNADC (methodology \"Parada Tecnica\")","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/PNADCperiods-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"PNADCperiods: Identify Reference Periods in Brazil's PNADC Survey Data — PNADCperiods-package","text":"Marcos Hecksher mdhecksher@gmail.com Rogerio Barbosa rogerio.barbosa@iesp.uerj.br","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_apply_periods.html","id":null,"dir":"Reference","previous_headings":"","what":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"function takes crosswalk pnadc_identify_periods applies PNADC dataset (quarterly annual). can optionally calibrate survey weights match external population totals chosen temporal granularity (month, fortnight, week).","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_apply_periods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"","code":"pnadc_apply_periods(   data,   crosswalk,   weight_var,   anchor,   calibrate = TRUE,   calibration_unit = c(\"month\", \"fortnight\", \"week\"),   target_totals = NULL,   smooth = TRUE,   keep_all = TRUE,   verbose = TRUE )"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_apply_periods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"data data.frame data.table PNADC microdata. Must contain join keys UPA V1014 merge crosswalk. crosswalk data.table crosswalk pnadc_identify_periods. weight_var Character. Name survey weight column. Must specified: \"V1028\" quarterly PNADC data \"V1032\" annual PNADC data (visit-specific) anchor Character. anchor weight redistribution. Must specified: \"quarter\" quarterly data (preserves quarterly totals) \"year\" annual data (preserves yearly totals) calibrate Logical. TRUE (default), calibrate weights external population totals. FALSE, merge crosswalk without calibration. calibration_unit Character. Temporal unit weight calibration. One \"month\" (default), \"fortnight\", \"week\". target_totals Optional data.table population targets. NULL (default), fetches monthly population SIDRA derives targets fortnight/week. time period (month, fortnight, week) calibrated FULL Brazilian population SIDRA. smooth Logical. TRUE (default), smooth calibrated weights remove quarterly artifacts. Smoothing adapted per time period: monthly (3-period window), fortnight (7-period window), weekly (smoothing). keep_all Logical. TRUE (default), keep observations including undetermined reference periods. FALSE, drop undetermined rows. verbose Logical. TRUE (default), print progress messages.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_apply_periods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"data.table input data plus: ref_month, ref_fortnight, ref_week Reference period Date ref_month_in_quarter, etc. Position within quarter (1-3, 1-6, 1-14) ref_month_yyyymm, ref_fortnight_yyyyff, ref_week_yyyyww Integer period codes determined_month, determined_fortnight, determined_week Logical determination flags weight_monthly, weight_fortnight, weight_weekly Calibrated weights (calibrate=TRUE)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_apply_periods.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"Merges reference period crosswalk PNADC microdata optionally calibrates survey weights sub-quarterly analysis.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_apply_periods.html","id":"weight-calibration","dir":"Reference","previous_headings":"","what":"Weight Calibration","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"calibrate = TRUE, function performs hierarchical rake weighting: Groups observations nested demographic/geographic cells Iteratively adjusts weights sub-period totals match anchor-period totals Calibrates final weights external population totals (FULL Brazilian population) Optionally smooths weights remove quarterly artifacts","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_apply_periods.html","id":"population-targets","dir":"Reference","previous_headings":"","what":"Population Targets","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"time periods (months, fortnights, weeks) calibrated FULL Brazilian population SIDRA. means: Monthly weights sum Brazilian population month Fortnight weights sum Brazilian population containing month Weekly weights sum Brazilian population containing month","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_apply_periods.html","id":"hierarchical-raking-levels","dir":"Reference","previous_headings":"","what":"Hierarchical Raking Levels","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"number hierarchical cell levels automatically adjusted based calibration unit avoid sparse cell issues: \"month\": 4 levels (age, region, state, post-stratum) - full hierarchy \"fortnight\": 2 levels (age, region) - simplified lower sample size \"week\": 1 level (age groups ) - minimal hierarchy sparse data","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_apply_periods.html","id":"anchor-period","dir":"Reference","previous_headings":"","what":"Anchor Period","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"anchor parameter determines weights redistributed: \"quarter\": Quarterly totals preserved redistributed months/fortnights/weeks \"year\": Yearly totals preserved redistributed months/fortnights/weeks Use anchor = \"quarter\" quarterly V1028 weights, anchor = \"year\" annual V1032 weights.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_apply_periods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Apply Reference Period Crosswalk to PNADC Data — pnadc_apply_periods","text":"","code":"if (FALSE) { # \\dontrun{ # Build crosswalk crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Apply to quarterly data with monthly calibration result <- pnadc_apply_periods(   pnadc_2023,   crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\" )  # Apply to annual data result <- pnadc_apply_periods(   pnadc_annual,   crosswalk,   weight_var = \"V1032\",   anchor = \"year\" )  # Weekly calibration result <- pnadc_apply_periods(   pnadc_2023,   crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibration_unit = \"week\" )  # No calibration (just merge crosswalk) result <- pnadc_apply_periods(   pnadc_2023,   crosswalk,   weight_var = \"V1028\",   anchor = \"quarter\",   calibrate = FALSE ) } # }"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_experimental_periods.html","id":null,"dir":"Reference","previous_headings":"","what":"Experimental Period Identification Strategies — pnadc_experimental_periods","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"Two experimental strategies available: probabilistic: narrow ranges (2 possible fortnights/weeks), calculates probability-weighted best guess based date position upa_aggregation: Aggregates constraints UPA level (experimental - IBGE interview UPAs together)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_experimental_periods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"","code":"pnadc_experimental_periods(   crosswalk,   data = NULL,   strategy = c(\"none\", \"probabilistic\", \"upa_aggregation\", \"both\"),   upa_homogeneity_threshold = 0.8,   verbose = TRUE )"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_experimental_periods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"crosswalk crosswalk data.table pnadc_identify_periods() data original PNADC data.table used build crosswalk (required probabilistic strategy access date bounds) strategy Character vector specifying strategies apply. Options: \"none\", \"probabilistic\", \"upa_aggregation\", \"\" upa_homogeneity_threshold Numeric. apply UPA aggregation measured UPA homogeneity rate exceeds threshold. Default 0.80. verbose Logical. TRUE, print progress information.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_experimental_periods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"modified crosswalk additional columns: ref_fortnight_likely: Probabilistic best guess (NA range > 2) ref_fortnight_confidence: Probability correct (0.5-1.0) ref_week_likely: Probabilistic best guess (NA range > 2) ref_week_confidence: Probability correct (0.5-1.0) ref_fortnight_upa: UPA-aggregated fortnight (strategy enabled) ref_week_upa: UPA-aggregated week (strategy enabled)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_experimental_periods.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"Provides experimental strategies improving fortnight week identification rates beyond standard algorithm. strategies research testing purposes replace main identification logic.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_experimental_periods.html","id":"probabilistic-strategy","dir":"Reference","previous_headings":"","what":"Probabilistic Strategy","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"interview date range spans exactly 2 fortnights weeks, can calculate probability interview occurred earlier vs later period based relative position date range boundaries. example, date_min day 10 date_max day 20, fortnight boundary day 15, : Days 10-15 (6 days) fall fortnight 1 Days 16-20 (5 days) fall fortnight 2 Probability fortnight 1: 6/11 ≈ 55%","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_experimental_periods.html","id":"upa-aggregation-strategy","dir":"Reference","previous_headings":"","what":"UPA Aggregation Strategy","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"strategy tests whether aggregating constraints UPA level (across households UPA) improves determination rates. EXPERIMENTAL IBGE interview entire UPAs day - interviews spread across quarter. UPA homogeneity rate (percentage UPAs determined households fortnight/week) calculated first. exceeds threshold UPA aggregation applied.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_experimental_periods.html","id":"note","dir":"Reference","previous_headings":"","what":"Note","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"strategies produce \"likely\" assignments, definitive determinations. standard pnadc_identify_periods() function used rigorous analysis. experimental outputs useful : Sensitivity analysis Robustness checks Research identification algorithm improvements","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_experimental_periods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Experimental Period Identification Strategies — pnadc_experimental_periods","text":"","code":"if (FALSE) { # \\dontrun{ # Build standard crosswalk crosswalk <- pnadc_identify_periods(pnadc_data)  # Apply experimental strategies crosswalk_exp <- pnadc_experimental_periods(   crosswalk,   pnadc_data,   strategy = \"probabilistic\" )  # Check how many additional \"likely\" assignments we get crosswalk_exp[, .(   determined = sum(!is.na(ref_fortnight_in_quarter)),   likely = sum(!is.na(ref_fortnight_likely)),   high_confidence = sum(ref_fortnight_confidence >= 0.7, na.rm = TRUE) )] } # }"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_identify_periods.html","id":null,"dir":"Reference","previous_headings":"","what":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"PNADC quarterly survey, interview actually refers specific temporal period within quarter. function identifies month, fortnight (quinzena), week observation belongs , enabling sub-quarterly time series analysis. algorithm uses: IBGE's reference week timing rules (first Saturday sufficient days month) Respondent birthdates constrain possible interview dates UPA-panel level aggregation months (across quarters - panel design) Household-level aggregation fortnights weeks (within quarter ) Dynamic exception detection (identifies quarters needing relaxed rules)","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_identify_periods.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"","code":"pnadc_identify_periods(data, verbose = TRUE)"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_identify_periods.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"data data.frame data.table PNADC microdata. Required columns: Ano: Survey year Trimestre: Quarter (1-4) UPA: Primary Sampling Unit V1008: Household sequence within UPA V1014: Panel identifier V2008: Birth day (1-31) V20081: Birth month (1-12) V20082: Birth year V2009: Age Optional recommended: V2003: Person sequence within household verbose Logical. TRUE (default), display progress information.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_identify_periods.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"data.table crosswalk columns: Ano, Trimestre, UPA, V1008, V1014 Join keys (year, quarter, UPA, household, panel) ref_month Reference month Date (1st month) ref_month_in_quarter Position quarter (1, 2, 3) NA ref_month_yyyymm Integer YYYYMM format (e.g., 202301) determined_month Logical: TRUE month determined ref_fortnight Reference fortnight Date (1st 16th) ref_fortnight_in_quarter Position quarter (1-6) NA ref_fortnight_yyyyff Integer YYYYFF format (1-24 per year) determined_fortnight Logical: TRUE fortnight determined ref_week Reference week Date (Monday week) ref_week_in_quarter Position quarter (1-14) NA ref_week_yyyyww Integer ISO YYYYWW format determined_week Logical: TRUE week determined","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_identify_periods.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"Builds universal crosswalk containing reference periods (month, fortnight, week) PNADC survey data based IBGE's interview timing rules.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_identify_periods.html","id":"temporal-granularity","dir":"Reference","previous_headings":"","what":"Temporal Granularity","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"crosswalk contains three levels temporal granularity: Month: 3 per quarter, ~97% determination rate (aggregates across quarters) Fortnight (quinzena): 6 per quarter, ~2-5% determination rate (within-quarter ) Week: 13-14 per quarter, ~1-2% determination rate (within-quarter ) fortnight/week rates low? months can aggregate UPA-V1014 level across quarters (leveraging panel design units interviewed consistent relative positions). Fortnights weeks determined birthday constraints within single quarter, rarely narrows interview window single 15-day 7-day period.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_identify_periods.html","id":"cross-quarter-aggregation-important-","dir":"Reference","previous_headings":"","what":"Cross-Quarter Aggregation (Important!)","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"optimal month determination rates, input data stacked across multiple quarters (ideally 4+ years). algorithm leverages PNADC's rotating panel design UPA-V1014 interviewed relative position across quarterly visits. cross-quarter aggregation applies months - fortnight week determination based within-quarter constraints .","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_identify_periods.html","id":"fortnight-definition","dir":"Reference","previous_headings":"","what":"Fortnight Definition","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"Fortnights numbered 1-24 per year (2 per month): Fortnight 01: Jan 1-15 Fortnight 02: Jan 16-31 Fortnight 03: Feb 1-15 ... ","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_identify_periods.html","id":"important-note","dir":"Reference","previous_headings":"","what":"Important Note","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"function returns crosswalk (identification keys + reference periods). apply crosswalk dataset optionally calibrate weights, use pnadc_apply_periods.","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_identify_periods.html","id":"aggregation-levels","dir":"Reference","previous_headings":"","what":"Aggregation Levels","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"crosswalk aggregates different levels: Months: Can aggregate across quarters UPA-V1014 level (PNADC panel design ensures month position) Fortnights: Household level within quarter (consistent position across quarterly visits) Weeks: Household level within quarter (consistent position across quarterly visits)","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/pnadc_identify_periods.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Identify Reference Periods in PNADC Data — pnadc_identify_periods","text":"","code":"if (FALSE) { # \\dontrun{ # Build crosswalk from stacked quarterly data crosswalk <- pnadc_identify_periods(pnadc_stacked)  # Check determination rates crosswalk[, .(   month_rate = mean(determined_month),   fortnight_rate = mean(determined_fortnight),   week_rate = mean(determined_week) )]  # Apply to a specific dataset result <- pnadc_apply_periods(pnadc_2023, crosswalk,                               weight_var = \"V1028\",                               anchor = \"quarter\") } # }"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/smooth_monthly_aggregates.html","id":null,"dir":"Reference","previous_headings":"","what":"Smooth Monthly Aggregates — smooth_monthly_aggregates","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"quarterly survey data converted monthly estimates, resulting time series often shows artificial quarterly patterns. function applies smoothing algorithm : Computes 3-month differences capture trends Stratifies month position within quarter (1st, 2nd, 3rd) Accumulates changes via cumulative sums Calibrates reference period Produces smooth monthly series preserve genuine variation","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/smooth_monthly_aggregates.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"","code":"smooth_monthly_aggregates(   monthly_aggregates,   calibration_start = 201301L,   calibration_end = 201912L )"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/smooth_monthly_aggregates.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"monthly_aggregates data.table monthly aggregated indicators. Required columns: ref_month_yyyymm: Month identifier YYYYMM format z_*: Indicator columns monthly totals (e.g., z_popocup) calibration_start Integer YYYYMM. Start calibration period. Default 201301. calibration_end Integer YYYYMM. End calibration period. Default 201912.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/smooth_monthly_aggregates.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"data.table original data plus smoothed estimates. Contains: ref_month_yyyymm: Month identifier (preserved input) Original z_* columns (unchanged) m_varname: Smoothed monthly estimate input z_varname","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/smooth_monthly_aggregates.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"Applies moving average methodology remove quarterly artifacts monthly estimates derived quarterly survey data. smoothing algorithm works follows: indicator variable: Compute 3-month difference: d3 = 3 * (value[t] - value[t-1]) Split month position (1, 2, 3 within quarter) Compute cumulative sum within position Calculate residual intermediate series calibration period Apply position-specific adjustment Final smoothed value uses moving average quarterly reference","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/smooth_monthly_aggregates.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Smooth Monthly Aggregates — smooth_monthly_aggregates","text":"","code":"if (FALSE) { # \\dontrun{ # After calibrating weights, aggregate to monthly totals monthly_agg <- calibrated_data[, .(z_populacao = sum(weight_calibrated)), by = ref_month_yyyymm] smoothed <- smooth_monthly_aggregates(monthly_agg) } # }"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/utils-dates.html","id":null,"dir":"Reference","previous_headings":"","what":"Date Utility Functions — utils-dates","title":"Date Utility Functions — utils-dates","text":"Internal helper functions date calculations. Optimized pre-computed lookup tables fast date creation (~20x faster ISOdate).","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/utils-validation.html","id":null,"dir":"Reference","previous_headings":"","what":"Input Validation Utilities — utils-validation","title":"Input Validation Utilities — utils-validation","text":"Internal helper functions validating PNADC input data.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/validate_pnadc.html","id":null,"dir":"Reference","previous_headings":"","what":"Validate PNADC Input Data — validate_pnadc","title":"Validate PNADC Input Data — validate_pnadc","text":"Checks input data required columns specified processing.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/validate_pnadc.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Validate PNADC Input Data — validate_pnadc","text":"","code":"validate_pnadc(data, check_weights = FALSE, stop_on_error = TRUE)"},{"path":"https://antrologos.github.io/mensalizePNADC/reference/validate_pnadc.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Validate PNADC Input Data — validate_pnadc","text":"data data.frame data.table PNADC microdata check_weights Logical. TRUE, also check weight-related variables. stop_on_error Logical. TRUE, stops error. FALSE, returns validation report list.","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/validate_pnadc.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Validate PNADC Input Data — validate_pnadc","text":"stop_on_error = TRUE, returns invisibly valid stops error. stop_on_error = FALSE, returns list : valid: Logical indicating data passed validations issues: Named list validation issues found (empty none) n_rows: Number rows input data n_cols: Number columns input data join_keys_available: Character vector available join key columns","code":""},{"path":"https://antrologos.github.io/mensalizePNADC/reference/validate_pnadc.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Validate PNADC Input Data — validate_pnadc","text":"function performs following validations: Checks required columns reference period identification: Ano, Trimestre, UPA, V1008, V1014, V2008, V20081, V20082, V2009 Validates year range (2012-2100 PNADC coverage) Validates quarter values (must 1-4) Validates birth day values (must 1-31 99 unknown) Validates birth month values (must 1-12 99 unknown) Warns unusual ages (outside 0-130 range) check_weights = TRUE, also validates weight-related columns: V1028, UF, posest, posest_sxi","code":""},{"path":[]},{"path":"https://antrologos.github.io/mensalizePNADC/reference/validate_pnadc.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Validate PNADC Input Data — validate_pnadc","text":"","code":"if (FALSE) { # \\dontrun{ validate_pnadc(my_data) validate_pnadc(my_data, check_weights = TRUE) } # }"}]
