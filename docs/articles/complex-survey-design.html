<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Complex Survey Design with Monthly Weights • mensalizePNADC</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Complex Survey Design with Monthly Weights">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mensalizePNADC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/download-and-prepare.html">Download and Prepare Data</a></li>
    <li><a class="dropdown-item" href="../articles/applied-examples.html">Applied Examples</a></li>
    <li><a class="dropdown-item" href="../articles/annual-poverty-analysis.html">Annual Poverty Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/complex-survey-design.html">Complex Survey Design</a></li>
    <li><a class="dropdown-item" href="../articles/how-it-works.html">How mensalizePNADC Works</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/antrologos/mensalizePNADC/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Complex Survey Design with Monthly Weights</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antrologos/mensalizePNADC/blob/HEAD/vignettes/complex-survey-design.Rmd" class="external-link"><code>vignettes/complex-survey-design.Rmd</code></a></small>
      <div class="d-none name"><code>complex-survey-design.Rmd</code></div>
    </div>

    
    
<!--
MAINTAINER NOTE:
The code chunks in this vignette must match the code in:
  mensalizacao_pnad/code/generate_complex_survey_figures.R

Look for comments like "# VIGNETTE CODE: chunk-name" in that script.
To regenerate figures, run that script. Changes to code here
must be mirrored in the generation script (and vice versa).
-->
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>When you compute a statistic from survey data—say, the unemployment
rate is 7.2%—that number alone doesn’t tell you much. Is 7.2%
meaningfully different from last month’s 7.0%? Could the true rate
plausibly be 6.5% or 8.0%? Without <strong>standard errors</strong> and
<strong>confidence intervals</strong>, you can’t answer these questions.
You’re flying blind.</p>
<p>This matters especially when tracking changes over time. Monthly data
from <code>mensalizePNADC</code> reveals dynamics hidden in quarterly
averages, but those sharp month-to-month movements could be real
economic changes or just sampling variability. Standard errors let you
distinguish signal from noise.</p>
<p>The challenge is that PNADC uses a <strong>complex sample
design</strong>. It’s not a simple random sample where standard formulas
apply. Instead, PNADC uses:</p>
<ul>
<li>
<strong>Stratification</strong>: Households are grouped into strata
(<code>Estrato</code>) before sampling</li>
<li>
<strong>Clustering</strong>: Within strata, census tracts
(<code>UPA</code>) are sampled, then all eligible households in selected
tracts are interviewed</li>
<li>
<strong>Unequal probabilities</strong>: Some groups are oversampled
for better precision</li>
</ul>
<p>Ignoring this design typically <strong>underestimates</strong>
standard errors, sometimes dramatically. A naive analysis might claim
statistically significant changes that are actually within the margin of
error.</p>
<p>This vignette shows two strategies for proper variance estimation
with the monthly weights from <code>mensalizePNADC</code>:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Linearization approach</strong>: Using design variables
directly—simple and fast</li>
<li>
<strong>Replication weights approach</strong>: Adjusting IBGE’s 200
bootstrap weights—more computationally intensive but exact</li>
</ol>
<p>We’ll demonstrate both using a compelling example: the <strong>gender
gap in labor force participation</strong>, which widened dramatically
during COVID-19.</p>
<hr>
</div>
<div class="section level2">
<h2 id="why-standard-errors-matter-a-visual-motivation">Why Standard Errors Matter: A Visual Motivation<a class="anchor" aria-label="anchor" href="#why-standard-errors-matter-a-visual-motivation"></a>
</h2>
<p>Before diving into methodology, let’s see why this matters. The
figure below shows labor force participation for men and women during
the COVID-19 period. The <strong>shaded bands</strong> show 95%
confidence intervals from proper complex survey analysis.</p>
<div class="float">
<img src="figures/complex-survey-design/fig-why-se-matter.png" style="width:100.0%" alt="Labor Force Participation with Confidence Bands"><div class="figcaption">Labor Force Participation with Confidence
Bands</div>
</div>
<p>Notice several things:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Women’s participation dropped more sharply</strong> than
men’s—but the confidence bands help us assess whether this difference is
statistically meaningful</p></li>
<li><p><strong>Some month-to-month changes look dramatic</strong> but
might be within sampling error. Without confidence intervals, we’d be
tempted to over-interpret random fluctuations</p></li>
<li><p><strong>The recovery path</strong> shows persistent gaps that
confidence bands confirm are real, not noise</p></li>
</ol>
<p>This is why you need standard errors: they transform raw numbers into
actionable knowledge.</p>
<hr>
</div>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<div class="section level3">
<h3 id="required-packages">Required Packages<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Core packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://antrologos.github.io/mensalizePNADC/">mensalizePNADC</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Survey analysis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span>       <span class="co"># For svydesign and linearization-based variance</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://gdfe.co/srvyr/" class="external-link">srvyr</a></span><span class="op">)</span>        <span class="co"># Tidyverse-friendly wrapper for survey</span></span>
<span></span>
<span><span class="co"># Visualization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="required-variables">Required Variables<a class="anchor" aria-label="anchor" href="#required-variables"></a>
</h3>
<p>To implement complex survey analysis, your PNADC data needs specific
design variables that are <strong>not included in the minimal stacked
data</strong> used for basic mensalization. You need the <strong>full
quarterly microdata</strong>:</p>
<table class="table">
<colgroup>
<col width="27%">
<col width="35%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th>Variable</th>
<th>Description</th>
<th>Required for</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>Estrato</code></td>
<td>Stratum identifier</td>
<td>Strategy 1</td>
</tr>
<tr class="even">
<td><code>UPA</code></td>
<td>Primary Sampling Unit (census tract)</td>
<td>Strategy 1</td>
</tr>
<tr class="odd">
<td><code>V1028</code></td>
<td>Original IBGE weight</td>
<td>Both strategies</td>
</tr>
<tr class="even">
<td>
<code>V1028001</code>-<code>V1028200</code>
</td>
<td>Bootstrap replication weights</td>
<td>Strategy 2</td>
</tr>
<tr class="odd">
<td><code>weight_monthly</code></td>
<td>Monthly weight from <code><a href="../reference/mensalizePNADC.html">mensalizePNADC()</a></code>
</td>
<td>Both strategies</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="loading-and-preparing-data">Loading and Preparing Data<a class="anchor" aria-label="anchor" href="#loading-and-preparing-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load stacked PNADC data with ALL required variables</span></span>
<span><span class="co"># This needs: Ano, Trimestre, UPA, V1008, V1014, V2003, V2008, V20081, V20082, V2009</span></span>
<span><span class="co">#             V1028, UF, posest, posest_sxi (for weight calibration)</span></span>
<span><span class="co">#             Estrato (for Strategy 1)</span></span>
<span><span class="co">#             V1028001-V1028200 (for Strategy 2)</span></span>
<span><span class="co">#             Plus any analysis variables (VD4001, VD4002, V2007, etc.)</span></span>
<span></span>
<span><span class="va">pnadc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"path/to/your/pnadc_full_stacked.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply mensalization with weight computation</span></span>
<span><span class="va">pnadc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mensalizePNADC.html">mensalizePNADC</a></span><span class="op">(</span><span class="va">pnadc</span>, compute_weights <span class="op">=</span> <span class="cn">TRUE</span>, keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter to determined observations (those with monthly weights)</span></span>
<span><span class="va">pnadc_monthly</span> <span class="op">&lt;-</span> <span class="va">pnadc</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">weight_monthly</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="strategy-1-linearization-with-strata-and-psu">Strategy 1: Linearization with Strata and PSU<a class="anchor" aria-label="anchor" href="#strategy-1-linearization-with-strata-and-psu"></a>
</h2>
<p>This approach uses <strong>Taylor series linearization</strong> to
estimate variances. It’s the standard method implemented in most survey
software, fast to compute, and works well for means, proportions,
totals, and ratios.</p>
<div class="section level3">
<h3 id="understanding-the-survey-design">Understanding the Survey Design<a class="anchor" aria-label="anchor" href="#understanding-the-survey-design"></a>
</h3>
<p>PNADC uses a two-stage stratified cluster sample:</p>
<ul>
<li>
<strong>Stage 1</strong>: Within each stratum
(<code>Estrato</code>), Primary Sampling Units (census tracts,
<code>UPA</code>) are selected with probability proportional to
size</li>
<li>
<strong>Stage 2</strong>: Within selected UPAs, households are
systematically selected</li>
</ul>
<p>The stratification improves precision by ensuring representation
across geographic and demographic groups. But the clustering introduces
correlation among observations within the same UPA, which typically
<em>increases</em> variance compared to simple random sampling.</p>
</div>
<div class="section level3">
<h3 id="setting-up-the-survey-design">Setting Up the Survey Design<a class="anchor" aria-label="anchor" href="#setting-up-the-survey-design"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create survey design object for a specific month</span></span>
<span><span class="co"># Let's analyze January 2020 (ref_month_yyyymm = 202001)</span></span>
<span></span>
<span><span class="va">pnadc_jan2020</span> <span class="op">&lt;-</span> <span class="va">pnadc_monthly</span><span class="op">[</span><span class="va">ref_month_yyyymm</span> <span class="op">==</span> <span class="fl">202001</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up the survey design</span></span>
<span><span class="va">design_jan2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span>
<span>  ids <span class="op">=</span> <span class="op">~</span><span class="va">UPA</span>,                    <span class="co"># PSU/cluster identifier</span></span>
<span>  strata <span class="op">=</span> <span class="op">~</span><span class="va">Estrato</span>,             <span class="co"># Stratification variable</span></span>
<span>  weights <span class="op">=</span> <span class="op">~</span><span class="va">weight_monthly</span>,     <span class="co"># Monthly-adjusted weight</span></span>
<span>  data <span class="op">=</span> <span class="va">pnadc_jan2020</span>,</span>
<span>  nest <span class="op">=</span> <span class="cn">TRUE</span>                    <span class="co"># UPAs are nested within strata</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the design</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">design_jan2020</span><span class="op">)</span></span></code></pre></div>
<p>The <code>nest = TRUE</code> argument is important: it tells the
survey package that UPA codes are only unique within strata, not across
the entire dataset.</p>
</div>
<div class="section level3">
<h3 id="computing-estimates-with-standard-errors">Computing Estimates with Standard Errors<a class="anchor" aria-label="anchor" href="#computing-estimates-with-standard-errors"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Labor force participation rate (VD4001 == 1 means in labor force)</span></span>
<span><span class="co"># Filter to working-age population (14+) first</span></span>
<span><span class="va">design_14plus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">design_jan2020</span>, <span class="va">V2009</span> <span class="op">&gt;=</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="va">participation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">VD4001</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">design_14plus</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">participation</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get confidence interval</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">participation</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Participation by sex (V2007: 1 = Male, 2 = Female)</span></span>
<span><span class="va">participation_by_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">VD4001</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="op">~</span><span class="va">V2007</span>,</span>
<span>  design <span class="op">=</span> <span class="va">design_14plus</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">svymean</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">participation_by_sex</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="monthly-time-series-with-confidence-intervals">Monthly Time Series with Confidence Intervals<a class="anchor" aria-label="anchor" href="#monthly-time-series-with-confidence-intervals"></a>
</h3>
<p>To create a full monthly series, we loop over months and collect
results:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to compute participation rate for one month</span></span>
<span><span class="va">compute_participation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">month_yyyymm</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">month_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">ref_month_yyyymm</span> <span class="op">==</span> <span class="va">month_yyyymm</span> <span class="op">&amp;</span> <span class="va">V2009</span> <span class="op">&gt;=</span> <span class="fl">14</span><span class="op">]</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">month_data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create survey design</span></span>
<span>  <span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span>
<span>    ids <span class="op">=</span> <span class="op">~</span><span class="va">UPA</span>,</span>
<span>    strata <span class="op">=</span> <span class="op">~</span><span class="va">Estrato</span>,</span>
<span>    weights <span class="op">=</span> <span class="op">~</span><span class="va">weight_monthly</span>,</span>
<span>    data <span class="op">=</span> <span class="va">month_data</span>,</span>
<span>    nest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Compute overall participation</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">VD4001</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">design</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>    ref_month_yyyymm <span class="op">=</span> <span class="va">month_yyyymm</span>,</span>
<span>    participation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>,</span>
<span>    se <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Get all unique months</span></span>
<span><span class="va">months</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">pnadc_monthly</span><span class="op">$</span><span class="va">ref_month_yyyymm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute for all months (this may take a few minutes)</span></span>
<span><span class="va">results_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">months</span>, <span class="va">compute_participation</span>, data <span class="op">=</span> <span class="va">pnadc_monthly</span><span class="op">)</span></span>
<span><span class="va">monthly_participation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">results_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add confidence intervals</span></span>
<span><span class="va">monthly_participation</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span></span>
<span>  ci_lower <span class="op">=</span> <span class="va">participation</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span>,</span>
<span>  ci_upper <span class="op">=</span> <span class="va">participation</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span>,</span>
<span>  period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ref_month_yyyymm</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">100</span>, <span class="st">"-"</span>,</span>
<span>                          <span class="va">ref_month_yyyymm</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">100</span>, <span class="st">"-15"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="strategy-2-adjusted-replication-weights">Strategy 2: Adjusted Replication Weights<a class="anchor" aria-label="anchor" href="#strategy-2-adjusted-replication-weights"></a>
</h2>
<p>IBGE provides 200 <strong>bootstrap replication weights</strong>
(<code>V1028001</code> to <code>V1028200</code>) with each quarterly
release. These weights are generated by resampling the original sample
design and recalculating weights, capturing the full complexity of the
survey design.</p>
<p>This approach is more computationally intensive (you compute your
statistic 201 times: once with main weights, 200 times with replication
weights), but it handles complex statistics like quantiles, Gini
coefficients, and regression coefficients without requiring special
variance formulas.</p>
<div class="section level3">
<h3 id="the-adjustment-logic">The Adjustment Logic<a class="anchor" aria-label="anchor" href="#the-adjustment-logic"></a>
</h3>
<p>The key insight is that <code>weight_monthly</code> is the product of
the original weight <code>V1028</code> and adjustment factors from
mensalization calibration. We apply the <strong>same ratio</strong> to
each replication weight:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mtext mathvariant="normal">V1028</mtext><mi>k</mi><mtext mathvariant="normal">monthly</mtext></msubsup><mo>=</mo><msub><mtext mathvariant="normal">V1028</mtext><mi>k</mi></msub><mo>×</mo><mfrac><mtext mathvariant="normal">weight_monthly</mtext><mtext mathvariant="normal">V1028</mtext></mfrac></mrow><annotation encoding="application/x-tex">
\text{V1028}_k^{\text{monthly}} = \text{V1028}_k \times \frac{\text{weight\_monthly}}{\text{V1028}}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>001</mn><mo>,</mo><mn>002</mn><mo>,</mo><mi>…</mi><mo>,</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">k = 001, 002, \ldots, 200</annotation></semantics></math>
indexes the replication weights.</p>
<p>This preserves the variance properties of the replication weights
while incorporating the mensalization adjustments.</p>
</div>
<div class="section level3">
<h3 id="creating-adjusted-replication-weights">Creating Adjusted Replication Weights<a class="anchor" aria-label="anchor" href="#creating-adjusted-replication-weights"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the adjustment ratio</span></span>
<span><span class="va">pnadc_monthly</span><span class="op">[</span>, <span class="va">weight_ratio</span> <span class="op">:=</span> <span class="va">weight_monthly</span> <span class="op">/</span> <span class="va">V1028</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Get names of replication weight columns</span></span>
<span><span class="va">rep_weight_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"V1028"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%03d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create adjusted replication weight columns</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">col</span> <span class="kw">in</span> <span class="va">rep_weight_cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">new_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">col</span>, <span class="st">"_monthly"</span><span class="op">)</span></span>
<span>  <span class="va">pnadc_monthly</span><span class="op">[</span>, <span class="op">(</span><span class="va">new_col</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="op">*</span> <span class="va">weight_ratio</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Verify the adjustment (the ratio should be constant within each observation)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Ratio range:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">pnadc_monthly</span><span class="op">$</span><span class="va">weight_ratio</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="setting-up-the-replicate-design">Setting Up the Replicate Design<a class="anchor" aria-label="anchor" href="#setting-up-the-replicate-design"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create survey design with replication weights for January 2020</span></span>
<span><span class="va">pnadc_jan2020_rep</span> <span class="op">&lt;-</span> <span class="va">pnadc_monthly</span><span class="op">[</span><span class="va">ref_month_yyyymm</span> <span class="op">==</span> <span class="fl">202001</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Get adjusted replication weight column names</span></span>
<span><span class="va">rep_weight_cols_monthly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"V1028"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%03d"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">200</span><span class="op">)</span>, <span class="st">"_monthly"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create replicate weights design</span></span>
<span><span class="co"># type = "bootstrap" matches IBGE's methodology</span></span>
<span><span class="va">design_rep_jan2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svrepdesign.html" class="external-link">svrepdesign</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pnadc_jan2020_rep</span>,</span>
<span>  weights <span class="op">=</span> <span class="op">~</span><span class="va">weight_monthly</span>,</span>
<span>  repweights <span class="op">=</span> <span class="va">rep_weight_cols_monthly</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"bootstrap"</span>,</span>
<span>  combined.weights <span class="op">=</span> <span class="cn">TRUE</span>     <span class="co"># The replication weights already include the base weight</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">design_rep_jan2020</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="computing-estimates-with-replication-variance">Computing Estimates with Replication Variance<a class="anchor" aria-label="anchor" href="#computing-estimates-with-replication-variance"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Labor force participation rate</span></span>
<span><span class="va">design_rep_14plus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">design_rep_jan2020</span>, <span class="va">V2009</span> <span class="op">&gt;=</span> <span class="fl">14</span><span class="op">)</span></span>
<span></span>
<span><span class="va">participation_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">VD4001</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">design_rep_14plus</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">participation_rep</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare with linearization estimate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nLinearization SE:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="va">participation</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Replication SE:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="va">participation_rep</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Participation by sex</span></span>
<span><span class="va">participation_by_sex_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">VD4001</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="op">~</span><span class="va">V2007</span>,</span>
<span>  design <span class="op">=</span> <span class="va">design_rep_14plus</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">svymean</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">participation_by_sex_rep</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="practical-example-gender-gap-in-labor-force-participation">Practical Example: Gender Gap in Labor Force Participation<a class="anchor" aria-label="anchor" href="#practical-example-gender-gap-in-labor-force-participation"></a>
</h2>
<p>Brazil has one of the <strong>largest gender gaps in labor force
participation</strong> among major economies. While about 73% of
working-age men participate in the labor force, only about 53% of women
do—a gap of roughly 20 percentage points that has persisted for
decades.</p>
<p>This gap represents millions of potential workers who are not in the
labor market, with profound implications for economic growth, household
income inequality, and women’s economic autonomy. Understanding how this
gap evolves—and whether changes are statistically significant—is crucial
for policy evaluation.</p>
<p>The COVID-19 pandemic provides a natural experiment. School closures
and increased caregiving demands fell disproportionately on women. Did
this widen the participation gap? Monthly data lets us track these
dynamics precisely.</p>
<div class="section level3">
<h3 id="computing-monthly-series-by-sex">Computing Monthly Series by Sex<a class="anchor" aria-label="anchor" href="#computing-monthly-series-by-sex"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare analysis data</span></span>
<span><span class="va">pnadc_analysis</span> <span class="op">&lt;-</span> <span class="va">pnadc_monthly</span><span class="op">[</span><span class="va">V2009</span> <span class="op">&gt;=</span> <span class="fl">14</span><span class="op">]</span></span>
<span><span class="va">pnadc_analysis</span><span class="op">[</span>, <span class="va">in_labor_force</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">fifelse</a></span><span class="op">(</span><span class="va">VD4001</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1L</span>, <span class="fl">0L</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">pnadc_analysis</span><span class="op">[</span>, <span class="va">sex</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">fifelse</a></span><span class="op">(</span><span class="va">V2007</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"Men"</span>, <span class="st">"Women"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Function to compute participation by sex for one month</span></span>
<span><span class="va">compute_participation_by_sex</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">month_yyyymm</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">month_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">ref_month_yyyymm</span> <span class="op">==</span> <span class="va">month_yyyymm</span><span class="op">]</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">month_data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create survey design</span></span>
<span>  <span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span>
<span>    ids <span class="op">=</span> <span class="op">~</span><span class="va">UPA</span>,</span>
<span>    strata <span class="op">=</span> <span class="op">~</span><span class="va">Estrato</span>,</span>
<span>    weights <span class="op">=</span> <span class="op">~</span><span class="va">weight_monthly</span>,</span>
<span>    data <span class="op">=</span> <span class="va">month_data</span>,</span>
<span>    nest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Compute participation by sex</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">in_labor_force</span>,</span>
<span>    by <span class="op">=</span> <span class="op">~</span><span class="va">sex</span>,</span>
<span>    design <span class="op">=</span> <span class="va">design</span>,</span>
<span>    FUN <span class="op">=</span> <span class="va">svymean</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    vartype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"se"</span>, <span class="st">"ci"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span>  <span class="va">result</span><span class="op">[</span>, <span class="va">ref_month_yyyymm</span> <span class="op">:=</span> <span class="va">month_yyyymm</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">result</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compute for all months</span></span>
<span><span class="va">months</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">pnadc_analysis</span><span class="op">$</span><span class="va">ref_month_yyyymm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">results_by_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">months</span>, <span class="va">compute_participation_by_sex</span>, data <span class="op">=</span> <span class="va">pnadc_analysis</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename columns for clarity</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">results_by_sex</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"in_labor_force"</span>, <span class="st">"se"</span>, <span class="st">"ci_l"</span>, <span class="st">"ci_u"</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"participation"</span>, <span class="st">"se"</span>, <span class="st">"ci_lower"</span>, <span class="st">"ci_upper"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add date column for plotting</span></span>
<span><span class="va">results_by_sex</span><span class="op">[</span>, <span class="va">period</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>  <span class="va">ref_month_yyyymm</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">100</span>, <span class="st">"-"</span>,</span>
<span>  <span class="va">ref_month_yyyymm</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">100</span>, <span class="st">"-15"</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-the-gender-gap-with-confidence-bands">Visualizing the Gender Gap with Confidence Bands<a class="anchor" aria-label="anchor" href="#visualizing-the-gender-gap-with-confidence-bands"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results_by_sex</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">period</span>, y <span class="op">=</span> <span class="va">participation</span>, color <span class="op">=</span> <span class="va">sex</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Confidence bands</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci_lower</span>, ymax <span class="op">=</span> <span class="va">ci_upper</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Point estimates</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Highlight COVID period</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>,</span>
<span>           xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>, xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-12-31"</span><span class="op">)</span>,</span>
<span>           ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           fill <span class="op">=</span> <span class="st">"gray80"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,</span>
<span>           x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-01-01"</span><span class="op">)</span>, y <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>           label <span class="op">=</span> <span class="st">"COVID-19"</span>, fontface <span class="op">=</span> <span class="st">"italic"</span>, size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"gray40"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Scales and labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent_format</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.45</span>, <span class="fl">0.85</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.45</span>, <span class="fl">0.85</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 year"</span>, date_labels <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Men"</span> <span class="op">=</span> <span class="st">"#0074D9"</span>, <span class="st">"Women"</span> <span class="op">=</span> <span class="st">"#FF4136"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Men"</span> <span class="op">=</span> <span class="st">"#0074D9"</span>, <span class="st">"Women"</span> <span class="op">=</span> <span class="st">"#FF4136"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Labor Force Participation by Sex: Monthly Series with 95% Confidence Intervals"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Brazil, 2012-2024. Shaded regions show 95% confidence bands from complex survey design."</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Labor Force Participation Rate"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Sex"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"Sex"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Source: PNADC/IBGE. Monthly weights from mensalizePNADC. Variance estimated via Taylor linearization."</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/complex-survey-design/fig-gender-participation-ci.png" style="width:100.0%" alt="Labor Force Participation by Sex with Confidence Intervals"><div class="figcaption">Labor Force Participation by Sex with Confidence
Intervals</div>
</div>
<p>The figure reveals several important patterns:</p>
<ol style="list-style-type: decimal">
<li><p><strong>The gender gap is persistent and large</strong>: Men’s
participation hovers around 73%, women’s around 53%—a 20
percentage-point gap</p></li>
<li><p><strong>COVID-19 hit women harder</strong>: Women’s participation
dropped from ~53% to below 47% during the pandemic, while men’s dropped
from ~73% to ~66%</p></li>
<li><p><strong>The confidence bands confirm these are real
differences</strong>: The bands for men and women never overlap, meaning
the gender gap is statistically significant in every single
month</p></li>
<li><p><strong>Recovery was uneven</strong>: Both series recovered by
late 2021, but examining the gap itself tells a more nuanced
story</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="computing-the-gender-gap-with-standard-errors">Computing the Gender Gap with Standard Errors<a class="anchor" aria-label="anchor" href="#computing-the-gender-gap-with-standard-errors"></a>
</h3>
<p>The gender gap is a derived statistic: the difference between two
survey estimates. We need the standard error of this difference:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Function to compute the gender gap for one month</span></span>
<span><span class="va">compute_gender_gap</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">month_yyyymm</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">month_data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">ref_month_yyyymm</span> <span class="op">==</span> <span class="va">month_yyyymm</span><span class="op">]</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">month_data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span>
<span>    ids <span class="op">=</span> <span class="op">~</span><span class="va">UPA</span>,</span>
<span>    strata <span class="op">=</span> <span class="op">~</span><span class="va">Estrato</span>,</span>
<span>    weights <span class="op">=</span> <span class="op">~</span><span class="va">weight_monthly</span>,</span>
<span>    data <span class="op">=</span> <span class="va">month_data</span>,</span>
<span>    nest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Compute participation by sex</span></span>
<span>  <span class="va">by_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html" class="external-link">svyby</a></span><span class="op">(</span><span class="op">~</span><span class="va">in_labor_force</span>, <span class="op">~</span><span class="va">sex</span>, <span class="va">design</span>, <span class="va">svymean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Extract values</span></span>
<span>  <span class="va">men_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">by_sex</span><span class="op">)</span><span class="op">[</span><span class="st">"Men"</span><span class="op">]</span></span>
<span>  <span class="va">women_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">by_sex</span><span class="op">)</span><span class="op">[</span><span class="st">"Women"</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># The variance of (Men - Women) = Var(Men) + Var(Women) - 2*Cov(Men, Women)</span></span>
<span>  <span class="co"># For independent samples, Cov ≈ 0, so SE(gap) ≈ sqrt(SE_men^2 + SE_women^2)</span></span>
<span>  <span class="va">se_men</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="va">by_sex</span><span class="op">)</span><span class="op">[</span><span class="st">"Men"</span><span class="op">]</span></span>
<span>  <span class="va">se_women</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/SE.html" class="external-link">SE</a></span><span class="op">(</span><span class="va">by_sex</span><span class="op">)</span><span class="op">[</span><span class="st">"Women"</span><span class="op">]</span></span>
<span>  <span class="va">se_gap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">se_men</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">se_women</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>    ref_month_yyyymm <span class="op">=</span> <span class="va">month_yyyymm</span>,</span>
<span>    gap <span class="op">=</span> <span class="va">men_rate</span> <span class="op">-</span> <span class="va">women_rate</span>,</span>
<span>    se <span class="op">=</span> <span class="va">se_gap</span>,</span>
<span>    men_rate <span class="op">=</span> <span class="va">men_rate</span>,</span>
<span>    women_rate <span class="op">=</span> <span class="va">women_rate</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compute for all months</span></span>
<span><span class="va">gap_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">months</span>, <span class="va">compute_gender_gap</span>, data <span class="op">=</span> <span class="va">pnadc_analysis</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add confidence intervals and date</span></span>
<span><span class="va">gap_results</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span></span>
<span>  ci_lower <span class="op">=</span> <span class="va">gap</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span>,</span>
<span>  ci_upper <span class="op">=</span> <span class="va">gap</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span>,</span>
<span>  period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ref_month_yyyymm</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">100</span>, <span class="st">"-"</span>, <span class="va">ref_month_yyyymm</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">100</span>, <span class="st">"-15"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-the-gender-gap-over-time">Visualizing the Gender Gap Over Time<a class="anchor" aria-label="anchor" href="#visualizing-the-gender-gap-over-time"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">gap_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">period</span>, y <span class="op">=</span> <span class="va">gap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Confidence band</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ci_lower</span>, ymax <span class="op">=</span> <span class="va">ci_upper</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="st">"#7b3294"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Point estimate</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#7b3294"</span>, linewidth <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Reference line at pre-COVID average</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span></span>
<span>    yintercept <span class="op">=</span> <span class="va">gap_results</span><span class="op">[</span><span class="va">period</span> <span class="op">&lt;</span> <span class="st">"2020-03-01"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">gap</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"gray50"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Highlight COVID period</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"rect"</span>,</span>
<span>           xmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-03-01"</span><span class="op">)</span>, xmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-12-31"</span><span class="op">)</span>,</span>
<span>           ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>           fill <span class="op">=</span> <span class="st">"gray80"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="co"># Scales and labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent_format</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.30</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 year"</span>, date_labels <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Gender Gap in Labor Force Participation (Men - Women)"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Monthly series with 95% CI. Dashed line = pre-COVID average. Gap widened during pandemic."</span>,</span>
<span>    x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Participation Gap (percentage points)"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Source: PNADC/IBGE. Monthly weights from mensalizePNADC."</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="figures/complex-survey-design/fig-gender-gap-difference.png" style="width:100.0%" alt="Gender Gap in Labor Force Participation"><div class="figcaption">Gender Gap in Labor Force Participation</div>
</div>
<p>This figure tells a clear story:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Pre-COVID</strong>: The gap was stable around 20
percentage points (dashed line)</p></li>
<li><p><strong>During COVID</strong>: The gap <strong>widened
significantly</strong> to about 22-23 percentage points—and the
confidence bands confirm this widening was statistically significant,
not sampling noise</p></li>
<li><p><strong>Post-COVID</strong>: The gap returned to approximately
pre-pandemic levels by 2022</p></li>
</ol>
<p>The confidence bands are crucial here. Without them, we might dismiss
the 2-3 percentage point increase during COVID as noise. With them, we
can confidently say the pandemic disproportionately pushed women out of
the labor force.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="comparing-the-two-strategies">Comparing the Two Strategies<a class="anchor" aria-label="anchor" href="#comparing-the-two-strategies"></a>
</h2>
<p>Both strategies produce similar standard error estimates for simple
statistics like means and proportions. Here’s when to use each:</p>
<table class="table">
<colgroup>
<col width="13%">
<col width="45%">
<col width="41%">
</colgroup>
<thead><tr class="header">
<th>Aspect</th>
<th>Strategy 1 (Linearization)</th>
<th>Strategy 2 (Replication)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Setup complexity</strong></td>
<td>Simpler</td>
<td>More complex</td>
</tr>
<tr class="even">
<td><strong>Computation time</strong></td>
<td>Faster</td>
<td>Slower (200× calculations)</td>
</tr>
<tr class="odd">
<td><strong>Memory usage</strong></td>
<td>Lower</td>
<td>Higher (200 extra columns)</td>
</tr>
<tr class="even">
<td><strong>Complex statistics</strong></td>
<td>May need special formulas</td>
<td>Handles automatically</td>
</tr>
<tr class="odd">
<td><strong>Consistency with IBGE</strong></td>
<td>Approximate</td>
<td>Exact match</td>
</tr>
<tr class="even">
<td><strong>Best for</strong></td>
<td>Routine analysis</td>
<td>Publication-quality results</td>
</tr>
</tbody>
</table>
<p><strong>Recommendation</strong>: Use Strategy 1 for exploratory
analysis and most routine work. Use Strategy 2 when:</p>
<ul>
<li>You need exact consistency with IBGE’s official standard errors</li>
<li>You’re computing complex statistics (quantiles, Gini, regression
coefficients)</li>
<li>You’re preparing results for publication or official reports</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="important-considerations">Important Considerations<a class="anchor" aria-label="anchor" href="#important-considerations"></a>
</h2>
<div class="section level3">
<h3 id="design-effects-and-effective-sample-size">Design Effects and Effective Sample Size<a class="anchor" aria-label="anchor" href="#design-effects-and-effective-sample-size"></a>
</h3>
<p>The complex sample design affects precision. You can examine the
<strong>design effect</strong> (deff), which measures how much larger
the variance is compared to a simple random sample:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute design effect for participation rate</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">deff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">VD4001</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">design_14plus</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Design effect &gt; 1 means clustering/stratification increased variance</span></span>
<span><span class="co"># Design effect &lt; 1 means stratification improved precision</span></span></code></pre></div>
<p>For PNADC, design effects typically range from 1.5 to 3.0 for
national estimates, meaning you’d need 1.5-3x as many observations in a
simple random sample to achieve the same precision.</p>
</div>
<div class="section level3">
<h3 id="handling-singleton-strata">Handling Singleton Strata<a class="anchor" aria-label="anchor" href="#handling-singleton-strata"></a>
</h3>
<p>Some months may have strata with only one PSU (singleton strata),
which causes problems for variance estimation. The <code>survey</code>
package handles this with several options:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set option for handling singleton strata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>survey.lonely.psu <span class="op">=</span> <span class="st">"adjust"</span><span class="op">)</span>  <span class="co"># Recommended: conservative adjustment</span></span>
<span></span>
<span><span class="co"># Other options:</span></span>
<span><span class="co"># "remove" - drop singleton strata from variance calculation</span></span>
<span><span class="co"># "average" - use average variance contribution</span></span>
<span><span class="co"># "certainty" - treat as certainty selections (SE = 0)</span></span></code></pre></div>
<p>The <code>"adjust"</code> option is recommended as it provides
conservative (larger) standard errors.</p>
</div>
<div class="section level3">
<h3 id="subpopulation-analysis">Subpopulation Analysis<a class="anchor" aria-label="anchor" href="#subpopulation-analysis"></a>
</h3>
<p>When analyzing subgroups, <strong>always subset the design
object</strong>, not the raw data:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CORRECT: Subset the design</span></span>
<span><span class="va">design_women</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">design_14plus</span>, <span class="va">V2007</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html" class="external-link">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">VD4001</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">design_women</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># INCORRECT: Don't do this - loses design information</span></span>
<span><span class="co"># bad_design &lt;- svydesign(..., data = pnadc[V2007 == 2])</span></span></code></pre></div>
<p>Subsetting the data before creating the design object loses
information about the full sample structure, leading to incorrect
variance estimates.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="using-srvyr-for-tidyverse-style-analysis">Using srvyr for Tidyverse-Style Analysis<a class="anchor" aria-label="anchor" href="#using-srvyr-for-tidyverse-style-analysis"></a>
</h2>
<p>If you prefer tidyverse syntax, the <code>srvyr</code> package wraps
the <code>survey</code> package with dplyr verbs:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://gdfe.co/srvyr/" class="external-link">srvyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to srvyr design</span></span>
<span><span class="va">design_srvyr</span> <span class="op">&lt;-</span> <span class="va">pnadc_jan2020</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">V2009</span> <span class="op">&gt;=</span> <span class="fl">14</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="http://gdfe.co/srvyr/reference/as_survey_design.html" class="external-link">as_survey_design</a></span><span class="op">(</span></span>
<span>    ids <span class="op">=</span> <span class="va">UPA</span>,</span>
<span>    strata <span class="op">=</span> <span class="va">Estrato</span>,</span>
<span>    weights <span class="op">=</span> <span class="va">weight_monthly</span>,</span>
<span>    nest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute participation by sex using dplyr verbs</span></span>
<span><span class="va">participation_srvyr</span> <span class="op">&lt;-</span> <span class="va">design_srvyr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">V2007</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"Men"</span>, <span class="st">"Women"</span><span class="op">)</span>,</span>
<span>         in_lf <span class="op">=</span> <span class="va">VD4001</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    participation <span class="op">=</span> <span class="fu"><a href="http://gdfe.co/srvyr/reference/survey_mean.html" class="external-link">survey_mean</a></span><span class="op">(</span><span class="va">in_lf</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">participation_srvyr</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette demonstrated two approaches for computing standard
errors with monthly PNADC weights:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Strategy 1 (Linearization)</strong>: Use
<code>Estrato</code> as strata, <code>UPA</code> as PSU, and
<code>weight_monthly</code> as the weight in a standard survey design.
Fast, simple, works for most statistics.</p></li>
<li><p><strong>Strategy 2 (Replication)</strong>: Multiply each of the
200 bootstrap replication weights by <code>weight_monthly / V1028</code>
to create adjusted replication weights. More intensive but
exact.</p></li>
</ol>
<p>The practical example demonstrated that the <strong>gender gap in
labor force participation widened significantly during
COVID-19</strong>—a finding that would be impossible to assess properly
without standard errors. The confidence bands transformed a claim like
“the gap looks bigger” into “the gap increased by 2-3 percentage points,
and we’re 95% confident it’s real.”</p>
<p>Monthly data without standard errors is like a dashboard with all the
warning lights burned out. You can see the numbers, but you can’t tell
which changes matter.</p>
<hr>
</div>
<div class="section level2">
<h2 id="further-reading">Further Reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<ul>
<li>
<a href="getting-started.html">Get Started</a> - Basic mensalization
workflow</li>
<li>
<a href="how-it-works.html">How It Works</a> - Algorithm details and
weight calibration methodology</li>
<li>
<a href="applied-examples.html">Applied Examples</a> - More
applications of monthly data</li>
<li>Thomas Lumley (2010). <em>Complex Surveys: A Guide to Analysis Using
R</em>. Wiley.</li>
<li>IBGE. <em>Notas Metodologicas da PNAD Continua</em>.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://orcid.org/0000-0002-5449-6787" class="external-link">Marcos Hecksher</a>, <a href="https://orcid.org/0000-0002-6796-4547" class="external-link">Rogerio Barbosa</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
