<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Get Started with PNADCperiods • PNADCperiods</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get Started with PNADCperiods">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PNADCperiods</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/download-and-prepare.html">Download and Prepare Data</a></li>
    <li><a class="dropdown-item" href="../articles/applied-examples.html">Applied Examples</a></li>
    <li><a class="dropdown-item" href="../articles/annual-poverty-analysis.html">Annual Poverty Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/complex-survey-design.html">Complex Survey Design</a></li>
    <li><a class="dropdown-item" href="../articles/how-it-works.html">How PNADCperiods Works</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/determination-rates-benchmark.html">Benchmark Report</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/antrologos/PNADCperiods/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Get Started with PNADCperiods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/antrologos/PNADCperiods/blob/HEAD/vignettes/getting-started.Rmd" class="external-link"><code>vignettes/getting-started.Rmd</code></a></small>
      <div class="d-none name"><code>getting-started.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>PNADCperiods</code> package converts Brazil’s quarterly
PNADC (Pesquisa Nacional por Amostra de Domicilios Continua) survey data
into sub-quarterly time series. It identifies which specific
<strong>month</strong>, <strong>fortnight</strong> (quinzena), or
<strong>week</strong> each survey observation refers to, achieving a
<strong>~97% determination rate</strong> for months when using stacked
multi-quarter data.</p>
<p><strong>Why does this matter?</strong> PNADC quarterly statistics are
actually moving averages of three months, which obscures:</p>
<ul>
<li>The true timing of economic shocks (when did unemployment
peak?)</li>
<li>The actual magnitude of changes (how high was the peak?)</li>
<li>Turning points in trends (when did recovery begin?)</li>
</ul>
<p>PNADCperiods recovers the specific reference period, enabling true
monthly (or finer) labor market analysis.</p>
<p><strong>Key feature:</strong> The identification follows a
<strong>nested hierarchy enforced by construction</strong>: fortnights
can only be determined if months are determined, and weeks can only be
determined if fortnights are determined.</p>
<p>For a detailed explanation of the algorithm, see the <a href="how-it-works.html">How PNADCperiods Works</a> vignette.</p>
<hr>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install from GitHub</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"antrologos/PNADCperiods"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://antrologos.github.io/PNADCperiods/">PNADCperiods</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>Dependencies:</strong></p>
<ul>
<li>
<strong>Required</strong>: <code>data.table</code>,
<code>checkmate</code>
</li>
<li>
<strong>For weight calibration</strong>: <code>sidrar</code>
(fetches population data from IBGE’s SIDRA API)</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="two-step-workflow">Two-Step Workflow<a class="anchor" aria-label="anchor" href="#two-step-workflow"></a>
</h2>
<p>The package uses a <strong>two-function workflow</strong>:</p>
<ol style="list-style-type: decimal">
<li>
<strong><code><a href="../reference/pnadc_identify_periods.html">pnadc_identify_periods()</a></code></strong> - Builds a
crosswalk with reference periods (months, fortnights, weeks)</li>
<li>
<strong><code><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods()</a></code></strong> - Applies
crosswalk to data and optionally calibrates weights</li>
</ol>
<p>This separation allows you to: - Build the crosswalk once from
stacked data (which contains birthday variables) - Apply it to any
quarterly or annual dataset - Choose your calibration approach
flexibly</p>
<hr>
</div>
<div class="section level2">
<h2 id="your-first-analysis">Your First Analysis<a class="anchor" aria-label="anchor" href="#your-first-analysis"></a>
</h2>
<div class="section level3">
<h3 id="required-input-columns">Required Input Columns<a class="anchor" aria-label="anchor" href="#required-input-columns"></a>
</h3>
<p>The algorithm needs these columns from your PNADC data:</p>
<table class="table">
<thead><tr class="header">
<th>Column</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>Ano</code></td>
<td>Survey year</td>
</tr>
<tr class="even">
<td><code>Trimestre</code></td>
<td>Quarter (1-4)</td>
</tr>
<tr class="odd">
<td><code>UPA</code></td>
<td>Primary Sampling Unit</td>
</tr>
<tr class="even">
<td><code>V1008</code></td>
<td>Household identifier</td>
</tr>
<tr class="odd">
<td><code>V1014</code></td>
<td>Panel identifier (rotation group 1-8)</td>
</tr>
<tr class="even">
<td><code>V2003</code></td>
<td>Person identifier</td>
</tr>
<tr class="odd">
<td><code>V2008</code></td>
<td>Birth day (1-31, or 99 for unknown)</td>
</tr>
<tr class="even">
<td><code>V20081</code></td>
<td>Birth month (1-12, or 99 for unknown)</td>
</tr>
<tr class="odd">
<td><code>V20082</code></td>
<td>Birth year (or 9999 for unknown)</td>
</tr>
<tr class="even">
<td><code>V2009</code></td>
<td>Age</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="step-1-load-your-data">Step 1: Load Your Data<a class="anchor" aria-label="anchor" href="#step-1-load-your-data"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load your stacked quarterly PNADC data</span></span>
<span><span class="va">pnadc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"pnadc_stacked.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check data dimensions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Rows:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pnadc</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Quarters:"</span>, <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">uniqueN</a></span><span class="op">(</span><span class="va">pnadc</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">Ano</span>, <span class="va">Trimestre</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Important:</strong> The algorithm works best with
<strong>stacked multi-quarter data</strong>. Processing a single quarter
yields only ~73% determination rate, while stacking 2+ years achieves
~97%.</p>
</div>
<div class="section level3">
<h3 id="step-2-build-the-crosswalk">Step 2: Build the Crosswalk<a class="anchor" aria-label="anchor" href="#step-2-build-the-crosswalk"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Identify reference periods (month, fortnight, week)</span></span>
<span><span class="va">crosswalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_identify_periods.html">pnadc_identify_periods</a></span><span class="op">(</span><span class="va">pnadc</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Output (from real PNADC 2012-2025 data):</p>
<pre><code>Building reference period crosswalk (nested identification)...

Phase 1: Identifying MONTHS (all observations)...
  Step 1.1: Preprocessing data...
  Step 1.2: Computing valid interview Saturdays...
  Step 1.3: Applying birthday constraints...
  Step 1.5: Converting to month positions...
  Step 1.6: Aggregating at UPA-panel level (cross-quarter)...
  Step 1.7: Detecting exception cases...
  Step 1.8: Determining reference months...
  -&gt; Month determination: 96.7% (9,281,135 of 9,598,723 households)

Phase 2: Identifying FORTNIGHTS (within determined months)...
  Processing 27,536,744 observations with determined months...
  Step 2.2: Aggregating at household level (within quarter)...
  Step 2.4: Determining reference fortnights...
  -&gt; Fortnight determination: 7.4% (705,580 of 9,598,723 households)

Phase 3: Identifying WEEKS (within determined fortnights)...
  Processing 2,582,636 observations with determined fortnights...
  Step 3.2: Aggregating at household level (within quarter)...
  Step 3.4: Determining reference weeks...
  -&gt; Week determination: 1.6% (152,764 of 9,598,723 households)

Phase 4: Building crosswalk...

========================================
Crosswalk complete (nested identification):
  - 9,598,723 unique household-quarter observations
  - Month determination:     96.69%
  - Fortnight determination:   7.35% (nested within months)
  - Week determination:        1.59% (nested within fortnights)
========================================</code></pre>
</div>
<div class="section level3">
<h3 id="step-3-understand-the-crosswalk">Step 3: Understand the Crosswalk<a class="anchor" aria-label="anchor" href="#step-3-understand-the-crosswalk"></a>
</h3>
<p>The crosswalk contains one row per <strong>household-quarter</strong>
combination (keyed by <code>Ano</code>, <code>Trimestre</code>,
<code>UPA</code>, <code>V1008</code>, <code>V1014</code>) with IBGE
calendar-based output columns:</p>
<table class="table">
<colgroup>
<col width="44%">
<col width="17%">
<col width="38%">
</colgroup>
<thead><tr class="header">
<th>Output Column</th>
<th>Type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Keys</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>Ano</code></td>
<td>Integer</td>
<td>Survey year</td>
</tr>
<tr class="odd">
<td><code>Trimestre</code></td>
<td>Integer</td>
<td>Quarter (1-4)</td>
</tr>
<tr class="even">
<td><code>UPA</code></td>
<td>Integer</td>
<td>Primary sampling unit</td>
</tr>
<tr class="odd">
<td><code>V1008</code></td>
<td>Integer</td>
<td>Household identifier</td>
</tr>
<tr class="even">
<td><code>V1014</code></td>
<td>Integer</td>
<td>Panel group (1-8)</td>
</tr>
<tr class="odd">
<td><strong>Month</strong></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>ref_month_start</code></td>
<td>Date</td>
<td>First day (Sunday) of the IBGE reference month</td>
</tr>
<tr class="odd">
<td><code>ref_month_end</code></td>
<td>Date</td>
<td>Last day (Saturday) of the IBGE reference month</td>
</tr>
<tr class="even">
<td><code>ref_month_weeks</code></td>
<td>Integer</td>
<td>Number of weeks in the reference month (4 or 5)</td>
</tr>
<tr class="odd">
<td><code>ref_month_in_quarter</code></td>
<td>Integer</td>
<td>Position in quarter: 1, 2, 3, or NA</td>
</tr>
<tr class="even">
<td><code>ref_month_yyyymm</code></td>
<td>Integer</td>
<td>YYYYMM format (e.g., 202301)</td>
</tr>
<tr class="odd">
<td><code>determined_month</code></td>
<td>Logical</td>
<td>TRUE if month was determined</td>
</tr>
<tr class="even">
<td><strong>Fortnight</strong></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>ref_fortnight_start</code></td>
<td>Date</td>
<td>First day (Sunday) of the reference fortnight</td>
</tr>
<tr class="even">
<td><code>ref_fortnight_end</code></td>
<td>Date</td>
<td>Last day (Saturday) of the reference fortnight</td>
</tr>
<tr class="odd">
<td><code>ref_fortnight_in_quarter</code></td>
<td>Integer</td>
<td>Position 1-6, or NA</td>
</tr>
<tr class="even">
<td><code>ref_fortnight_yyyyff</code></td>
<td>Integer</td>
<td>YYYYFF format (e.g., 202303 = 3rd fortnight of 2023)</td>
</tr>
<tr class="odd">
<td><code>determined_fortnight</code></td>
<td>Logical</td>
<td>TRUE if fortnight was determined</td>
</tr>
<tr class="even">
<td><strong>Week</strong></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>ref_week_start</code></td>
<td>Date</td>
<td>First day (Sunday) of the reference week</td>
</tr>
<tr class="even">
<td><code>ref_week_end</code></td>
<td>Date</td>
<td>Last day (Saturday) of the reference week</td>
</tr>
<tr class="odd">
<td><code>ref_week_in_quarter</code></td>
<td>Integer</td>
<td>Position 1-13, or NA</td>
</tr>
<tr class="even">
<td><code>ref_week_yyyyww</code></td>
<td>Integer</td>
<td>YYYYWW format (e.g., 202315)</td>
</tr>
<tr class="odd">
<td><code>determined_week</code></td>
<td>Logical</td>
<td>TRUE if week was determined</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View the crosswalk</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">crosswalk</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check determination rates (stored as attribute)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">crosswalk</span>, <span class="st">"determination_rates"</span><span class="op">)</span></span></code></pre></div>
<p>The determination rates attribute returns a list with rates for each
period type. See the “Understanding Determination Rates” section below
for expected values.</p>
</div>
<div class="section level3">
<h3 id="step-4-apply-to-your-data">Step 4: Apply to Your Data<a class="anchor" aria-label="anchor" href="#step-4-apply-to-your-data"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Apply crosswalk to a specific quarterly dataset</span></span>
<span><span class="co"># For quarterly data, use anchor = "quarter" and weight_var = "V1028"</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods</a></span><span class="op">(</span></span>
<span>  <span class="va">pnadc_2023q1</span>,</span>
<span>  <span class="va">crosswalk</span>,</span>
<span>  weight_var <span class="op">=</span> <span class="st">"V1028"</span>,</span>
<span>  anchor <span class="op">=</span> <span class="st">"quarter"</span>,</span>
<span>  calibrate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  calibration_unit <span class="op">=</span> <span class="st">"month"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The result includes all original columns plus reference periods and
calibrated weights.</p>
<div class="section level4">
<h4 id="understanding-the-key-arguments">Understanding the Key Arguments<a class="anchor" aria-label="anchor" href="#understanding-the-key-arguments"></a>
</h4>
<p><strong><code>weight_var</code></strong> (required): The name of the
original PNADC weight variable to use as the starting point for
calibration.</p>
<table class="table">
<thead><tr class="header">
<th>Value</th>
<th>Use When</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"V1028"</code></td>
<td>Quarterly PNADC data (trimestral)</td>
</tr>
<tr class="even">
<td><code>"V1032"</code></td>
<td>Annual PNADC data (anual)</td>
</tr>
</tbody>
</table>
<p>These weights come from IBGE’s original calibration and reflect the
survey design. The package uses them as input for the sub-quarterly
calibration process.</p>
<p><strong><code>anchor</code></strong> (required): Specifies whether
the data contains all rotation groups for a quarter or a year.</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="38%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th>Value</th>
<th>Use When</th>
<th>Meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"quarter"</code></td>
<td>Quarterly PNADC releases</td>
<td>Each quarter contains all 8 rotation groups interviewed during that
quarter</td>
</tr>
<tr class="even">
<td><code>"year"</code></td>
<td>Annual PNADC releases</td>
<td>Each year contains specific visits (e.g., visit 1 or visit 5) from
households across rotation groups</td>
</tr>
</tbody>
</table>
<p>This affects how the calibration targets are computed: quarterly data
calibrates within each quarter, while annual data calibrates within each
year.</p>
<p><strong><code>calibration_unit</code></strong>: The time period
granularity for weight calibration.</p>
<table class="table">
<colgroup>
<col width="21%">
<col width="46%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th>Value</th>
<th>Calibrates to</th>
<th>Best for</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<code>"month"</code> (default)</td>
<td>Monthly population totals</td>
<td>Most analyses; highest determination rate (~97%)</td>
</tr>
<tr class="even">
<td><code>"fortnight"</code></td>
<td>Fortnightly totals</td>
<td>Short-term analysis (strict rate ~7%, up to ~60% with
experimental)</td>
</tr>
<tr class="odd">
<td><code>"week"</code></td>
<td>Weekly totals</td>
<td>High-frequency monitoring (strict rate ~1.5%, up to ~15% with
experimental)</td>
</tr>
</tbody>
</table>
<p><strong>What is calibration?</strong> Weight calibration adjusts the
survey weights so that weighted totals match known population benchmarks
(from IBGE’s SIDRA API). This ensures your monthly estimates sum to the
correct population totals. The package uses adaptive hierarchical raking
with 4/2/1 cell levels for month/fortnight/week respectively.</p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="understanding-the-workflow">Understanding the Workflow<a class="anchor" aria-label="anchor" href="#understanding-the-workflow"></a>
</h2>
<div class="section level3">
<h3 id="building-vs--applying">Building vs. Applying<a class="anchor" aria-label="anchor" href="#building-vs--applying"></a>
</h3>
<p><strong>Build the crosswalk once</strong> from stacked data (2+ years
recommended):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Stack multiple years of quarterly data</span></span>
<span><span class="va">pnadc_stacked</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">pnadc_2020</span>, <span class="va">pnadc_2021</span>, <span class="va">pnadc_2022</span>, <span class="va">pnadc_2023</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build crosswalk (only needs the identification columns)</span></span>
<span><span class="va">crosswalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_identify_periods.html">pnadc_identify_periods</a></span><span class="op">(</span><span class="va">pnadc_stacked</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save for reuse</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">crosswalk</span>, <span class="st">"crosswalk_2020_2023.rds"</span><span class="op">)</span></span></code></pre></div>
<p><strong>Apply to any dataset</strong> as needed:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load saved crosswalk</span></span>
<span><span class="va">crosswalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"crosswalk_2020_2023.rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply to quarterly data</span></span>
<span><span class="va">monthly_q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods</a></span><span class="op">(</span><span class="va">pnadc_2023q1</span>, <span class="va">crosswalk</span>,</span>
<span>                                   weight_var <span class="op">=</span> <span class="st">"V1028"</span>,</span>
<span>                                   anchor <span class="op">=</span> <span class="st">"quarter"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply to annual data (with V1032 weights)</span></span>
<span><span class="va">monthly_annual</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods</a></span><span class="op">(</span><span class="va">pnadc_annual_2023</span>, <span class="va">crosswalk</span>,</span>
<span>                                       weight_var <span class="op">=</span> <span class="st">"V1032"</span>,</span>
<span>                                       anchor <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calibration-options">Calibration Options<a class="anchor" aria-label="anchor" href="#calibration-options"></a>
</h3>
<p>The <code>calibration_unit</code> parameter controls the granularity
of weight calibration:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Monthly calibration (default)</span></span>
<span><span class="va">result_month</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods</a></span><span class="op">(</span><span class="va">pnadc</span>, <span class="va">crosswalk</span>,</span>
<span>                                     weight_var <span class="op">=</span> <span class="st">"V1028"</span>,</span>
<span>                                     anchor <span class="op">=</span> <span class="st">"quarter"</span>,</span>
<span>                                     calibration_unit <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span></span>
<span><span class="co"># -&gt; Adds weight_monthly column</span></span>
<span></span>
<span><span class="co"># Fortnight calibration</span></span>
<span><span class="va">result_fortnight</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods</a></span><span class="op">(</span><span class="va">pnadc</span>, <span class="va">crosswalk</span>,</span>
<span>                                         weight_var <span class="op">=</span> <span class="st">"V1028"</span>,</span>
<span>                                         anchor <span class="op">=</span> <span class="st">"quarter"</span>,</span>
<span>                                         calibration_unit <span class="op">=</span> <span class="st">"fortnight"</span><span class="op">)</span></span>
<span><span class="co"># -&gt; Adds weight_fortnight column</span></span>
<span></span>
<span><span class="co"># Weekly calibration</span></span>
<span><span class="va">result_week</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods</a></span><span class="op">(</span><span class="va">pnadc</span>, <span class="va">crosswalk</span>,</span>
<span>                                    weight_var <span class="op">=</span> <span class="st">"V1028"</span>,</span>
<span>                                    anchor <span class="op">=</span> <span class="st">"quarter"</span>,</span>
<span>                                    calibration_unit <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></span>
<span><span class="co"># -&gt; Adds weight_weekly column</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="no-calibration-option">No Calibration Option<a class="anchor" aria-label="anchor" href="#no-calibration-option"></a>
</h3>
<p>If you only need reference periods without calibrated weights:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods</a></span><span class="op">(</span><span class="va">pnadc</span>, <span class="va">crosswalk</span>,</span>
<span>                               weight_var <span class="op">=</span> <span class="st">"V1028"</span>,</span>
<span>                               anchor <span class="op">=</span> <span class="st">"quarter"</span>,</span>
<span>                               calibrate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># Result has ref_month_start/end, ref_fortnight_start/end, ref_week_start/end</span></span>
<span><span class="co"># but no weight_monthly column</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="using-for-monthly-analysis">Using for Monthly Analysis<a class="anchor" aria-label="anchor" href="#using-for-monthly-analysis"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute monthly unemployment rate</span></span>
<span><span class="va">monthly_unemployment</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span><span class="va">determined_month</span> <span class="op">==</span> <span class="cn">TRUE</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  unemployment_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">VD4002</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">weight_monthly</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span></span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">VD4001</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">weight_monthly</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">ref_month_yyyymm</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Compute monthly population</span></span>
<span><span class="va">monthly_pop</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight_monthly</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">ref_month_yyyymm</span><span class="op">]</span></span></code></pre></div>
<p><strong>Note:</strong> Use <code>determined_month == TRUE</code> to
filter to observations with determined months.</p>
<hr>
</div>
<div class="section level2">
<h2 id="understanding-determination-rates">Understanding Determination Rates<a class="anchor" aria-label="anchor" href="#understanding-determination-rates"></a>
</h2>
<div class="section level3">
<h3 id="why-stack-multiple-quarters">Why Stack Multiple Quarters?<a class="anchor" aria-label="anchor" href="#why-stack-multiple-quarters"></a>
</h3>
<p>PNADC uses a <strong>rotating panel</strong> where each household
(identified by UPA + V1014) is interviewed in 5 consecutive quarters.
Crucially, the same household is always interviewed in the <strong>same
relative month position</strong> within each quarter.</p>
<p>This means birthday constraints from <strong>any</strong> quarter can
determine the month for <strong>all</strong> quarters:</p>
<pre><code>UPA=123456, V1014=1 appears in 5 quarters:

  2023-Q1: could be Jan or Feb (ambiguous)
  2023-Q2: could be Apr, May, or Jun (ambiguous)
  2023-Q3: must be August (birthday constraint pins it down!)
  2023-Q4: could be Oct or Nov (ambiguous)
  2024-Q1: could be Feb or Mar (ambiguous)

Cross-quarter aggregation:
  Since 2023-Q3 must be month 2, ALL quarters must be month 2.
  Result: ALL 5 quarters are determined!</code></pre>
<table class="table">
<thead><tr class="header">
<th>Processing Mode</th>
<th>Month Rate</th>
<th>Fortnight Rate</th>
<th>Week Rate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Single quarter</td>
<td>~73%</td>
<td>~6%</td>
<td>~1.5%</td>
</tr>
<tr class="even">
<td>Stacked (2+ years)</td>
<td><strong>~97%</strong></td>
<td>~6%</td>
<td>~1.5%</td>
</tr>
</tbody>
</table>
<p><strong>Important:</strong> Strict fortnight and week determination
rates remain at ~6% and ~1.5% regardless of stacking because their
constraints cannot aggregate across quarters - each quarter’s interview
timing is independent at the sub-monthly level. Only month determination
benefits from cross-quarter aggregation through the rotating panel
design.</p>
</div>
<div class="section level3">
<h3 id="what-makes-observations-indeterminate">What Makes Observations Indeterminate?<a class="anchor" aria-label="anchor" href="#what-makes-observations-indeterminate"></a>
</h3>
<p>About 3% of observations remain indeterminate for months because:</p>
<ul>
<li>
<strong>Incomplete panel coverage</strong>: First/last 4 quarters in
your data have fewer panel visits</li>
<li>
<strong>Missing birth dates</strong>: Some respondents don’t report
birth date (V2008=99, etc.)</li>
<li>
<strong>Small households</strong>: Fewer people means fewer birthday
constraints</li>
<li>
<strong>Unit non-response</strong>: Some households don’t respond in
all quarters</li>
</ul>
<p>For the full algorithm explanation, see <a href="how-it-works.html">How PNADCperiods Works</a>.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="experimental-strategies-for-improved-rates">Experimental Strategies for Improved Rates<a class="anchor" aria-label="anchor" href="#experimental-strategies-for-improved-rates"></a>
</h2>
<p>For fortnight and week analysis, experimental strategies can
significantly improve determination rates by leveraging a key empirical
finding: <strong>100% UPA homogeneity</strong> - when any household in a
UPA has a strictly determined period, ALL households with determined
periods in that UPA have the SAME period.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build standard crosswalk first</span></span>
<span><span class="va">crosswalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_identify_periods.html">pnadc_identify_periods</a></span><span class="op">(</span><span class="va">pnadc_stacked</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply experimental strategies</span></span>
<span><span class="va">crosswalk_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pnadc_experimental_periods.html">pnadc_experimental_periods</a></span><span class="op">(</span></span>
<span>  <span class="va">crosswalk</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pnadc_stacked</span>,</span>
<span>  strategy <span class="op">=</span> <span class="st">"both"</span>  <span class="co"># or "probabilistic" or "upa_aggregation"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check improvement</span></span>
<span><span class="va">crosswalk_exp</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  fortnight_strict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">determined_fortnight</span><span class="op">)</span>,</span>
<span>  fortnight_with_exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">determined_fortnight</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ref_fortnight_exp</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  week_strict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">determined_week</span><span class="op">)</span>,</span>
<span>  week_with_exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">determined_week</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ref_week_exp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th>Strategy</th>
<th>Fortnight %</th>
<th>Week %</th>
<th>Notes</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Strict only</td>
<td>~6%</td>
<td>~1.5%</td>
<td>Definitive determinations only</td>
</tr>
<tr class="even">
<td>+ Probabilistic</td>
<td>~21%</td>
<td>~0.6%</td>
<td>Adds confidence scores</td>
</tr>
<tr class="odd">
<td>+ UPA aggregation</td>
<td>~22%</td>
<td>~0.6%</td>
<td>Leverages 100% UPA homogeneity</td>
</tr>
<tr class="even">
<td>+ Both</td>
<td><strong>~27-28%</strong></td>
<td><strong>~2%</strong></td>
<td>Maximum coverage</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> Experimental strategies are intended for
sensitivity analysis and research purposes. For rigorous causal
analysis, strict determination should be preferred.</p>
<p>See the <a href="how-it-works.html">How PNADCperiods Works</a>
vignette for detailed documentation on experimental strategies.</p>
<hr>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li><p><strong>Download PNADC data</strong>: See <a href="download-and-prepare.html">Download and Prepare Data</a> for a
complete workflow to download and stack quarterly microdata from
IBGE.</p></li>
<li><p><strong>Analysis examples</strong>: See <a href="applied-examples.html">Applied Examples</a> for real-world labor
market analysis comparing monthly vs quarterly data, including COVID
unemployment and minimum wage validation.</p></li>
<li><p><strong>Annual PNADC data</strong>: Working with annual income
data? See <a href="annual-poverty-analysis.html">Monthly Poverty
Analysis with Annual PNADC Data</a> for the workflow using annual
data.</p></li>
<li><p><strong>Algorithm details</strong>: See <a href="how-it-works.html">How PNADCperiods Works</a> for the complete
methodology, including experimental strategies and weight
calibration.</p></li>
<li><p><strong>Function reference</strong>: Browse the <a href="../reference/index.html">Reference</a> for documentation of all
exported functions.</p></li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="quick-reference">Quick Reference<a class="anchor" aria-label="anchor" href="#quick-reference"></a>
</h2>
<div class="section level3">
<h3 id="main-functions">Main Functions<a class="anchor" aria-label="anchor" href="#main-functions"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Step 1: Build crosswalk from stacked data</span></span>
<span><span class="fu"><a href="../reference/pnadc_identify_periods.html">pnadc_identify_periods</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,              <span class="co"># Stacked PNADC data</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>     <span class="co"># Show progress?</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Apply crosswalk and optionally calibrate weights</span></span>
<span><span class="fu"><a href="../reference/pnadc_apply_periods.html">pnadc_apply_periods</a></span><span class="op">(</span></span>
<span>  <span class="va">data</span>,              <span class="co"># PNADC data to augment</span></span>
<span>  <span class="va">crosswalk</span>,         <span class="co"># Crosswalk from pnadc_identify_periods()</span></span>
<span>  <span class="va">weight_var</span>,        <span class="co"># REQUIRED: "V1028" (quarterly) or "V1032" (annual)</span></span>
<span>  <span class="va">anchor</span>,            <span class="co"># REQUIRED: "quarter" or "year"</span></span>
<span>  calibrate <span class="op">=</span> <span class="cn">TRUE</span>,  <span class="co"># Calibrate weights to SIDRA population?</span></span>
<span>  calibration_unit <span class="op">=</span> <span class="st">"month"</span>,  <span class="co"># "month", "fortnight", or "week"</span></span>
<span>  target_totals <span class="op">=</span> <span class="cn">NULL</span>,        <span class="co"># Custom targets (NULL = auto-fetch)</span></span>
<span>  smooth <span class="op">=</span> <span class="cn">TRUE</span>,     <span class="co"># Apply smoothing to weights?</span></span>
<span>  keep_all <span class="op">=</span> <span class="cn">TRUE</span>,   <span class="co"># Return all rows (including undetermined)?</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>     <span class="co"># Show progress?</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional: Experimental strategies for improved fortnight/week rates</span></span>
<span><span class="fu"><a href="../reference/pnadc_experimental_periods.html">pnadc_experimental_periods</a></span><span class="op">(</span></span>
<span>  <span class="va">crosswalk</span>,         <span class="co"># Crosswalk from pnadc_identify_periods()</span></span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,       <span class="co"># Original data (required for probabilistic strategy)</span></span>
<span>  strategy <span class="op">=</span> <span class="st">"both"</span>, <span class="co"># "none", "probabilistic", "upa_aggregation", or "both"</span></span>
<span>  upa_proportion_threshold <span class="op">=</span> <span class="fl">0.9</span>,  <span class="co"># Threshold for UPA aggregation</span></span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="performance">Performance<a class="anchor" aria-label="anchor" href="#performance"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Metric</th>
<th>Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Month determination rate</td>
<td>
<strong>~97%</strong> (on stacked data)</td>
</tr>
<tr class="even">
<td>Fortnight determination rate (strict)</td>
<td>~6%</td>
</tr>
<tr class="odd">
<td>Week determination rate (strict)</td>
<td>~1.5%</td>
</tr>
<tr class="even">
<td>Fortnight rate (+ experimental)</td>
<td><strong>~27-28%</strong></td>
</tr>
<tr class="odd">
<td>Week rate (+ experimental)</td>
<td><strong>~2%</strong></td>
</tr>
<tr class="even">
<td>Processing time (identification)</td>
<td>~2.5 minutes for 28M rows</td>
</tr>
<tr class="odd">
<td>Processing time (with calibration)</td>
<td>~5 minutes for 28M rows</td>
</tr>
</tbody>
</table>
<p>See the <a href="how-it-works.html">How PNADCperiods Works</a>
vignette for comprehensive benchmarks on 2012-2025 data.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://orcid.org/0000-0002-6796-4547" class="external-link">Rogerio Barbosa</a>, <a href="https://orcid.org/0000-0002-5449-6787" class="external-link">Marcos Hecksher</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
