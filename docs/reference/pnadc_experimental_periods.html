<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Experimental Period Identification Strategies — pnadc_experimental_periods • PNADCperiods</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Experimental Period Identification Strategies — pnadc_experimental_periods"><meta name="description" content="Three experimental strategies are available, all properly nested by period:
probabilistic: For narrow ranges (2 possible periods),
classifies based on where most of the date interval falls. Assigns only
when confidence exceeds threshold.
upa_aggregation: Extends strictly identified periods to other
observations in the same UPA-V1014 within the quarter, if a sufficient
proportion already have strict identification.
both: Sequentially applies probabilistic strategy first, then
UPA aggregation on top. Guarantees identification rate &amp;gt;= max of individual strategies.

"><meta property="og:description" content="Three experimental strategies are available, all properly nested by period:
probabilistic: For narrow ranges (2 possible periods),
classifies based on where most of the date interval falls. Assigns only
when confidence exceeds threshold.
upa_aggregation: Extends strictly identified periods to other
observations in the same UPA-V1014 within the quarter, if a sufficient
proportion already have strict identification.
both: Sequentially applies probabilistic strategy first, then
UPA aggregation on top. Guarantees identification rate &amp;gt;= max of individual strategies.

"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PNADCperiods</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/download-and-prepare.html">Download and Prepare Data</a></li>
    <li><a class="dropdown-item" href="../articles/applied-examples.html">Applied Examples</a></li>
    <li><a class="dropdown-item" href="../articles/annual-poverty-analysis.html">Annual Poverty Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/complex-survey-design.html">Complex Survey Design</a></li>
    <li><a class="dropdown-item" href="../articles/how-it-works.html">How PNADCperiods Works</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/determination-rates-benchmark.html">Benchmark Report</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/antrologos/PNADCperiods/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Experimental Period Identification Strategies</h1>
      <small class="dont-index">Source: <a href="https://github.com/antrologos/PNADCperiods/blob/HEAD/R/experimental-period-identification.R" class="external-link"><code>R/experimental-period-identification.R</code></a></small>
      <div class="d-none name"><code>pnadc_experimental_periods.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Three experimental strategies are available, all properly nested by period:</p><ul><li><p><strong>probabilistic</strong>: For narrow ranges (2 possible periods),
classifies based on where most of the date interval falls. Assigns only
when confidence exceeds threshold.</p></li>
<li><p><strong>upa_aggregation</strong>: Extends strictly identified periods to other
observations in the same UPA-V1014 within the quarter, if a sufficient
proportion already have strict identification.</p></li>
<li><p><strong>both</strong>: Sequentially applies probabilistic strategy first, then
UPA aggregation on top. Guarantees identification rate &gt;= max of individual strategies.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pnadc_experimental_periods</span><span class="op">(</span></span>
<span>  <span class="va">crosswalk</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"probabilistic"</span>, <span class="st">"upa_aggregation"</span>, <span class="st">"both"</span><span class="op">)</span>,</span>
<span>  confidence_threshold <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  upa_proportion_threshold <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  include_derived <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-crosswalk">crosswalk<a class="anchor" aria-label="anchor" href="#arg-crosswalk"></a></dt>
<dd><p>A crosswalk data.table from <code><a href="pnadc_identify_periods.html">pnadc_identify_periods()</a></code></p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The original PNADC data.table used to build the crosswalk
(required for probabilistic strategy to access date bounds)</p></dd>


<dt id="arg-strategy">strategy<a class="anchor" aria-label="anchor" href="#arg-strategy"></a></dt>
<dd><p>Character specifying which strategy to apply.
Options: "none", "probabilistic", "upa_aggregation", "both"</p></dd>


<dt id="arg-confidence-threshold">confidence_threshold<a class="anchor" aria-label="anchor" href="#arg-confidence-threshold"></a></dt>
<dd><p>Numeric (0-1). Minimum confidence required to
assign a probabilistic period. Used by probabilistic and combined strategies.
Default 0.9.</p></dd>


<dt id="arg-upa-proportion-threshold">upa_proportion_threshold<a class="anchor" aria-label="anchor" href="#arg-upa-proportion-threshold"></a></dt>
<dd><p>Numeric (0-1). Minimum proportion of UPA
observations (within quarter) that must have strict identification with consensus
for extending to unidentified observations. Default 0.5.</p></dd>


<dt id="arg-include-derived">include_derived<a class="anchor" aria-label="anchor" href="#arg-include-derived"></a></dt>
<dd><p>Logical. If TRUE (default), output includes derived columns
compatible with <code><a href="pnadc_apply_periods.html">pnadc_apply_periods()</a></code>: ref_month_start, ref_month_end,
ref_month_yyyymm, ref_month_weeks, determined_month, etc. This allows
experimental output to be used directly for weight calibration.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If TRUE, print progress information.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A modified crosswalk with additional columns. When <code>include_derived = TRUE</code>
(default), output is directly compatible with <code><a href="pnadc_apply_periods.html">pnadc_apply_periods()</a></code>:</p><ul><li><p><strong>Experimental columns</strong> (always included):</p><ul><li><p><code>ref_month_exp</code>: Experimentally assigned month position in quarter (1-3, or NA)</p></li>
<li><p><code>ref_month_exp_confidence</code>: Confidence of month assignment (0-1, proportion
of date interval in assigned period; values below threshold are removed)</p></li>
<li><p><code>ref_fortnight_exp</code>: Experimentally assigned fortnight position in quarter (1-6, or NA)</p></li>
<li><p><code>ref_fortnight_exp_confidence</code>: Confidence of fortnight assignment (0-1)</p></li>
<li><p><code>ref_week_exp</code>: Experimentally assigned week position in quarter (1-14, or NA)</p></li>
<li><p><code>ref_week_exp_confidence</code>: Confidence of week assignment (0-1)</p></li>
</ul></li>
<li><p><strong>Derived columns</strong> (when <code>include_derived = TRUE</code>):</p><ul><li><p><code>ref_month_start</code>, <code>ref_month_end</code>, <code>ref_month_in_quarter</code>,
<code>ref_month_yyyymm</code>, <code>ref_month_weeks</code>: Combined strict + experimental month
(strict takes priority). Start/end are Sunday/Saturday of IBGE month boundaries.</p></li>
<li><p><code>determined_month</code>: TRUE if month is assigned (strictly or experimentally)</p></li>
<li><p><code>ref_fortnight_start</code>, <code>ref_fortnight_end</code>, <code>ref_fortnight_in_quarter</code>,
<code>ref_fortnight_yyyyff</code>: Combined strict + experimental fortnight.
Start/end are Sunday/Saturday of IBGE fortnight boundaries.</p></li>
<li><p><code>determined_fortnight</code>: TRUE if fortnight is assigned</p></li>
<li><p><code>ref_week_start</code>, <code>ref_week_end</code>, <code>ref_week_in_quarter</code>,
<code>ref_week_yyyyww</code>: Combined strict + experimental week.
Start/end are Sunday/Saturday of IBGE week boundaries.</p></li>
<li><p><code>determined_week</code>: TRUE if week is assigned</p></li>
<li><p><code>probabilistic_assignment</code>: TRUE if any period was assigned experimentally
(vs strictly deterministic)</p></li>
</ul></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Provides experimental strategies for improving period identification rates
beyond the standard deterministic algorithm. All strategies respect the nested
identification hierarchy: weeks require fortnights, fortnights require months.</p><div class="section">
<h3 id="nesting-enforcement">Nesting Enforcement<a class="anchor" aria-label="anchor" href="#nesting-enforcement"></a></h3>


<p>All strategies enforce proper nesting:</p><ul><li><p>Fortnights can only be assigned if month is identified (strictly OR experimentally)</p></li>
<li><p>Weeks can only be assigned if fortnight is identified (strictly OR experimentally)</p></li>
</ul></div>

<div class="section">
<h3 id="probabilistic-strategy">Probabilistic Strategy<a class="anchor" aria-label="anchor" href="#probabilistic-strategy"></a></h3>


<p>For each period type (processed in order: months, then fortnights, then weeks):</p><ol><li><p>Check that the required parent period is identified</p></li>
<li><p>If bounds are narrowed to exactly 2 sequential periods, calculate
which period contains most of the date interval</p></li>
<li><p>Calculate confidence based on the proportion of interval in the likely period (0-1)</p></li>
<li><p>Only assign if confidence &gt;= <code>confidence_threshold</code></p></li>
</ol><p>For months: aggregates at UPA-V1014 level (but within-quarter, unlike strict algorithm)
For fortnights and weeks: works at household level</p>
</div>

<div class="section">
<h3 id="upa-aggregation-strategy">UPA Aggregation Strategy<a class="anchor" aria-label="anchor" href="#upa-aggregation-strategy"></a></h3>


<p>Extends strictly identified periods based on consensus within geographic groups:</p><ul><li><p><strong>Months</strong>: Uses UPA-V1014 level (panel design ensures same month)</p></li>
<li><p><strong>Fortnights/Weeks</strong>: Uses UPA level (all households in same UPA
are interviewed in same fortnight/week within a quarter)</p></li>
</ul><ol><li><p>Calculate proportion of observations with strictly identified period</p></li>
<li><p>If proportion &gt;= <code>upa_proportion_threshold</code> AND consensus exists, extend</p></li>
<li><p>Apply in nested order: months first, then fortnights, then weeks</p></li>
</ol></div>

<div class="section">
<h3 id="combined-strategy-both-">Combined Strategy ("both")<a class="anchor" aria-label="anchor" href="#combined-strategy-both-"></a></h3>


<p>Sequentially applies both strategies to maximize identification:</p><ol><li><p>First, apply the probabilistic strategy (captures observations with
narrow date ranges and high confidence)</p></li>
<li><p>Then, apply UPA aggregation (extends based on strict consensus
within UPA/UPA-V1014 groups)</p></li>
</ol><p>This guarantees that "both" identifies at least as many observations as
either individual strategy alone. The strategies operate independently
(UPA aggregation considers only strict identifications), so the result
is the union of both strategies.</p>
</div>

<div class="section">
<h3 id="integration-with-weight-calibration">Integration with Weight Calibration<a class="anchor" aria-label="anchor" href="#integration-with-weight-calibration"></a></h3>


<p>With <code>include_derived = TRUE</code> (default), the output can be passed directly to
<code><a href="pnadc_apply_periods.html">pnadc_apply_periods()</a></code> for weight calibration. The derived columns combine
strict and experimental assignments, with strict taking priority. Use the
<code>probabilistic_assignment</code> flag to filter if you only want strict determinations.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>These strategies produce "experimental" assignments, not strict determinations.
The standard <code><a href="pnadc_identify_periods.html">pnadc_identify_periods()</a></code> function should be used for
rigorous analysis. Experimental outputs are useful for:</p><ul><li><p>Sensitivity analysis</p></li>
<li><p>Robustness checks</p></li>
<li><p>Research into identification algorithm improvements</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="pnadc_identify_periods.html">pnadc_identify_periods</a></code> to build the crosswalk that this function modifies.
<code><a href="pnadc_apply_periods.html">pnadc_apply_periods</a></code> to apply period crosswalk and calibrate weights.
<code><a href="combine_period_crosswalks.html">combine_period_crosswalks</a></code> to merge strict and experimental crosswalks.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Build standard crosswalk</span></span></span>
<span class="r-in"><span><span class="va">crosswalk</span> <span class="op">&lt;-</span> <span class="fu"><a href="pnadc_identify_periods.html">pnadc_identify_periods</a></span><span class="op">(</span><span class="va">pnadc_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Apply experimental strategies</span></span></span>
<span class="r-in"><span><span class="va">crosswalk_exp</span> <span class="op">&lt;-</span> <span class="fu">pnadc_experimental_periods</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">crosswalk</span>,</span></span>
<span class="r-in"><span>  <span class="va">pnadc_data</span>,</span></span>
<span class="r-in"><span>  strategy <span class="op">=</span> <span class="st">"probabilistic"</span>,</span></span>
<span class="r-in"><span>  confidence_threshold <span class="op">=</span> <span class="fl">0.9</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check how many additional assignments we get</span></span></span>
<span class="r-in"><span><span class="va">crosswalk_exp</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span></span>
<span class="r-in"><span>  strict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ref_month_in_quarter</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">probabilistic_assignment</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  experimental <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">probabilistic_assignment</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">determined_month</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use directly with calibration (experimental output is compatible)</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="pnadc_apply_periods.html">pnadc_apply_periods</a></span><span class="op">(</span><span class="va">pnadc_data</span>, <span class="va">crosswalk_exp</span>,</span></span>
<span class="r-in"><span>                              period <span class="op">=</span> <span class="st">"month"</span>, calibrate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Or filter to only strict determinations</span></span></span>
<span class="r-in"><span><span class="va">strict_only</span> <span class="op">&lt;-</span> <span class="va">crosswalk_exp</span><span class="op">[</span><span class="va">probabilistic_assignment</span> <span class="op">==</span> <span class="cn">FALSE</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">probabilistic_assignment</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://orcid.org/0000-0002-6796-4547" class="external-link">Rogerio Barbosa</a>, <a href="https://orcid.org/0000-0002-5449-6787" class="external-link">Marcos Hecksher</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

